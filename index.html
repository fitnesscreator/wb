<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Responsive Builder (About & Contact Included)</title>
  <style>
    /* Basic builder layout */
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background: #f4f4f4;
      text-align: center;
    }
    h1 {
      margin-top: 20px;
    }
    .container {
      max-width: 1200px;
      margin: 20px auto;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      display: flex;
      flex-wrap: wrap;
      padding: 20px;
    }
    .forms-section {
      width: 100%;
      max-width: 500px;
      margin-right: 20px;
    }
    .forms-section h2 {
      text-align: center;
      margin-top: 0;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    input, textarea, select {
      width: 100%;
      max-width: 450px;
      margin-top: 5px;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
      font-size: 14px;
    }
    button {
      background: #2196f3;
      color: #fff;
      border: none;
      border-radius: 5px;
      padding: 10px 20px;
      margin-top: 15px;
      margin-right: 10px;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background: #0b7dda;
    }
    hr {
      margin: 20px 0;
      border: none;
      border-top: 1px solid #ccc;
    }

    /* New card styling for sections */
    .section-card {
      border: 1px solid blue;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }

    /* Buttons */
    #downloadBtn {
      background: #4caf50;
      font-weight: bold;
    }
    #downloadBtn:hover {
      background: #45a049;
    }
    #showCodeBtn {
      background: #ff9800;
    }
    #showCodeBtn:hover {
      background: #e68a00;
    }

    /* Right side: live preview in an iframe */
    .preview-section {
      flex: 1;
      min-width: 320px;
      padding: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .preview-section h2 {
      margin-top: 0;
    }
    #previewFrame {
      width: 100%;
      min-height: 600px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      background: #fff;
    }

    /* Product & Reviews listing beneath the preview */
    #productListing, #reviewListing {
      margin-top: 20px;
      text-align: left;
      width: 100%;
      max-width: 600px;
    }
    .product-list-item, .review-list-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #f9f9f9;
      border: 1px solid #ccc;
      border-radius: 5px;
      padding: 5px 10px;
      margin: 5px 0;
    }
    .delete-btn {
      background: #f44336;
      border: none;
      color: #fff;
      border-radius: 4px;
      padding: 5px 10px;
      cursor: pointer;
      font-size: 12px;
    }
    .delete-btn:hover {
      background: #d32f2f;
    }

    /* Show/hide code output */
    #output {
      display: none;
      width: 80%;
      height: 200px;
      margin: 20px auto;
    }
  </style>
</head>
<body>

  <h1>Responsive Builder (About & Contact Included)</h1>
  <p>Fill out all sections. The preview updates live. Hide “X Sold” if zero, shipping “FREE” if 0, etc. We have About Us + Contact. Enjoy!</p>

  <div class="container">
    <!-- Left side forms -->
    <div class="forms-section">
      
      <div class="section-card">
        <h2>Hero & Logo Section</h2>
        <form>
          <label>Logo Image URL</label>
          <input id="logo" type="text" placeholder="https://example.com/logo.png" required>

          <label>Hero Banner Image URL</label>
          <input id="banner" type="text" placeholder="https://example.com/hero.jpg" required>

          <label>Hero Title</label>
          <textarea id="heroText" rows="2" placeholder="Your amazing headline" required></textarea>

          <label>CTA Button Text</label>
          <input id="ctaText" type="text" placeholder="Shop Now!" required>
        </form>
      </div>

      <div class="section-card">
        <h2>Payment Integration</h2>
        <form>
          <label>Your Paypal currency</label>
          <input id="paypalCurrency" type="text" placeholder="e.g. $" required>

          <label>Select Payment Method</label>
          <select id="paymentMethod" required>
            <option value="paypalEmail">Paypal Email</option>
            <option value="paypalEmbed">Paypal Button Embed Code</option>
            <option value="paypalLink">Paypal Button Link</option>
          </select>

          <div id="paypalEmailField">
            <label>Paypal Email</label>
            <input id="paypalEmail" type="email" placeholder="Email..." required>
          </div>
        </form>
      </div>

      <div class="section-card">
        <h2>Add Products</h2>
        <form>
          <label>Product Title</label>
          <input id="productTitle" type="text" placeholder="Awesome Gadget" required>

          <label>1st Image URL (required)</label>
          <input id="image1" type="text" placeholder="https://example.com/product1.jpg" required>

          <label>2nd Image URL (optional)</label>
          <input id="image2" type="text" placeholder="https://example.com/product2.jpg">

          <label>3rd Image URL (optional)</label>
          <input id="image3" type="text" placeholder="https://example.com/product3.jpg">

          <label>Number Sold</label>
          <input id="sold" type="text" placeholder="e.g. 500 (blank or 0 to hide)" required>

          <label>Price</label>
          <input id="price" type="text" placeholder="12.99" required>

          <label>Shipping Cost (set 0 for FREE)</label>
          <input id="shipping" type="text" placeholder="e.g. 3.99 or 0" required>

          <label>Returns</label>
          <select id="returns" required>
            <option value="Accepted">Accepted</option>
            <option value="Not Accepted">Not Accepted</option>
          </select>

          <label>Color Options (comma-separated)</label>
          <input id="colorOptions" type="text" placeholder="Black, Cream, Green..." required>

          <label>Size Options (comma-separated)</label>
          <input id="sizeOptions" type="text" placeholder="S, M, L, XL..." required>

          <label>Description</label>
          <textarea id="description" rows="3" placeholder="Describe the product here" required></textarea>

          <div id="productEmbedField" style="display:none;">
            <label>Paypal Button Embed Code (for this product)</label>
            <textarea id="productEmbed" rows="2" placeholder="Embed code..." required></textarea>
          </div>

          <div id="productLinkField" style="display:none;">
            <label>Paypal Button Link (for this product)</label>
            <textarea id="productLink" rows="2" placeholder="Button link..." required></textarea>
          </div>

          <button type="button" onclick="addProduct()">Add Product</button>
        </form>
      </div>

      <div class="section-card">
        <h2>Add Reviews (max 3)</h2>
        <form>
          <label>Reviewer Name</label>
          <input id="reviewerName" type="text" placeholder="John Doe" required>

          <label>Stars (1–5)</label>
          <select id="reviewStars" required>
            <option value="1">1 star</option>
            <option value="2">2 stars</option>
            <option value="3" selected>3 stars</option>
            <option value="4">4 stars</option>
            <option value="5">5 stars</option>
          </select>

          <label>Review Text</label>
          <textarea id="reviewText" rows="2" placeholder="What do you think?" required></textarea>

          <button type="button" onclick="addReview()">Add Review</button>
        </form>
      </div>

      <div class="section-card">
        <h2>About Us Section</h2>
        <form>
          <label>About Title</label>
          <input id="aboutTitle" type="text" placeholder="Who We Are" required>

          <label>About Paragraph</label>
          <textarea id="aboutParagraph" rows="3" placeholder="Our story..." required></textarea>

          <label>About Image URL (right side)</label>
          <input id="aboutImage" type="text" placeholder="https://example.com/about.jpg" required>
        </form>
      </div>

      <div class="section-card">
        <h2>Contact Us Section</h2>
        <form>
          <label>Instagram Link</label>
          <input id="contactInstagram" type="text" placeholder="https://instagram.com/..." required>

          <label>TikTok Link</label>
          <input id="contactTiktok" type="text" placeholder="https://tiktok.com/@..." required>

          <label>Facebook Link</label>
          <input id="contactFacebook" type="text" placeholder="https://facebook.com/..." required>

          <label>Email Address</label>
          <input id="contactEmail" type="text" placeholder="info@example.com" required>
        </form>
      </div>

      <button id="downloadBtn" onclick="downloadSite()">Generate & Download</button>
      <button id="showCodeBtn" onclick="toggleCode()">Show Generated Code</button>
    </div>

    <!-- Right side: live preview + product listing + review listing -->
    <div class="preview-section">
      <h2>Live Preview</h2>
      <iframe id="previewFrame"></iframe>

      <div id="productListing"></div>
      <div id="reviewListing"></div>
    </div>
  </div>

  <textarea id="output" readonly></textarea>

<script>
var heroData    = { logo:'', banner:'', heroText:'', ctaText:'' };
var products    = [];
var reviews     = [];
var aboutData   = { title:'', paragraph:'', image:'' };
var contactData = { instagram:'', tiktok:'', facebook:'', email:'' };
var paymentIntegration = { method:'paypalEmail', paypalEmail:'', paypalEmbed:'', paypalLink:'', currency:'' };
var finalHTML   = '';

window.onload=function(){
  document.getElementById('logo').oninput     = updatePreview;
  document.getElementById('banner').oninput   = updatePreview;
  document.getElementById('heroText').oninput = updatePreview;
  document.getElementById('ctaText').oninput  = updatePreview;

  // About
  document.getElementById('aboutTitle').oninput     = updatePreview;
  document.getElementById('aboutParagraph').oninput = updatePreview;
  document.getElementById('aboutImage').oninput     = updatePreview;

  // Contact
  document.getElementById('contactInstagram').oninput = updatePreview;
  document.getElementById('contactTiktok').oninput    = updatePreview;
  document.getElementById('contactFacebook').oninput  = updatePreview;
  document.getElementById('contactEmail').oninput     = updatePreview;

  // Payment Integration events
  document.getElementById('paypalCurrency').oninput = updatePreview;
  document.getElementById('paymentMethod').onchange = function(){
    var method = this.value;
    paymentIntegration.method = method;
    document.getElementById('paypalEmailField').style.display = method==='paypalEmail'?'block':'none';
    updateAddProductFormFields();
    updatePreview();
  };
  document.getElementById('paypalEmail').oninput = updatePreview;
  updateAddProductFormFields();

  document.getElementById('productEmbed').oninput = updatePreview;
  document.getElementById('productLink').oninput = updatePreview;
};

function updateAddProductFormFields() {
  var method = document.getElementById('paymentMethod').value;
  if(method === 'paypalEmbed') {
     document.getElementById('productEmbedField').style.display='block';
     document.getElementById('productLinkField').style.display='none';
  } else if(method === 'paypalLink') {
     document.getElementById('productEmbedField').style.display='none';
     document.getElementById('productLinkField').style.display='block';
  } else {
     document.getElementById('productEmbedField').style.display='none';
     document.getElementById('productLinkField').style.display='none';
  }
}

/* --- PRODUCTS --- */
function addProduct(){
  var title        = document.getElementById('productTitle').value.trim();
  var img1         = document.getElementById('image1').value.trim();
  var img2         = document.getElementById('image2').value.trim();
  var img3         = document.getElementById('image3').value.trim();
  var sold         = document.getElementById('sold').value.trim();
  var price        = document.getElementById('price').value.trim();
  var curr         = paymentIntegration.currency || document.getElementById('paypalCurrency').value.trim();
  var shipping     = document.getElementById('shipping').value.trim();
  var returns      = document.getElementById('returns').value;
  var coloroptions = document.getElementById('colorOptions').value.trim();
  var sizeoptions  = document.getElementById('sizeOptions').value.trim();
  var desc         = document.getElementById('description').value.trim();

  var productEmbed = "";
  var productLink = "";
  if(paymentIntegration.method === 'paypalEmbed') {
    productEmbed = document.getElementById('productEmbed').value.trim();
  }
  if(paymentIntegration.method === 'paypalLink') {
    productLink = document.getElementById('productLink').value.trim();
  }

  if(!img1 || !price || !desc){
    alert("Please fill out at least: 1st Image, Price, and Description.");
    return;
  }
  var imgs=[img1];
  if(img2) imgs.push(img2);
  if(img3) imgs.push(img3);

  var shippingVal="FREE";
  if(shipping && shipping!=="0"){
    shippingVal=shipping; 
  }
  var soldVal="";
  if(sold && sold!=="0"){
    soldVal=sold;
  }
  var product = {
    title:title,
    images:imgs,
    sold:soldVal,
    price:price,
    currency:curr,
    shipping:shippingVal,
    returns:returns,
    coloroptions:coloroptions,
    sizeoptions:sizeoptions,
    description:desc
  };
  if(paymentIntegration.method === 'paypalEmbed') {
    product.paypalEmbed = productEmbed;
  }
  if(paymentIntegration.method === 'paypalLink') {
    product.paypalLink = productLink;
  }

  products.push(product);

  document.getElementById('productTitle').value='';
  document.getElementById('image1').value='';
  document.getElementById('image2').value='';
  document.getElementById('image3').value='';
  document.getElementById('sold').value='';
  document.getElementById('price').value='';
  document.getElementById('shipping').value='';
  document.getElementById('description').value='';
  document.getElementById('colorOptions').value='';
  document.getElementById('sizeOptions').value='';
  if(paymentIntegration.method === 'paypalEmbed') {
    document.getElementById('productEmbed').value='';
  }
  if(paymentIntegration.method === 'paypalLink') {
    document.getElementById('productLink').value='';
  }

  updatePreview();
  showProductList();
}
function showProductList(){
  var listing=document.getElementById('productListing');
  listing.innerHTML='<h3 style="margin-top:20px;">Products in Builder</h3>';
  for(var i=0;i<products.length;i++){
    var p=products[i];
    var div=document.createElement('div');
    div.className='product-list-item';
    var label=p.title||'(Untitled Product)';
    div.innerHTML='<span>'+label+'</span>';
    var btn=document.createElement('button');
    btn.className='delete-btn';
    btn.innerText='Delete';
    btn.onclick=(function(idx){
      return function(){
        products.splice(idx,1);
        updatePreview();
        showProductList();
      };
    })(i);
    div.appendChild(btn);
    listing.appendChild(div);
  }
}

/* --- REVIEWS --- */
function addReview(){
  if(reviews.length>=3){
    alert("You can only add up to 3 reviews!");
    return;
  }
  var name=document.getElementById('reviewerName').value.trim();
  var s=document.getElementById('reviewStars').value;
  var txt=document.getElementById('reviewText').value.trim();
  if(!name||!txt){
    alert("Please fill out reviewer's name and text!");
    return;
  }
  reviews.push({ name:name, stars:s, text:txt });
  document.getElementById('reviewerName').value='';
  document.getElementById('reviewText').value='';
  document.getElementById('reviewStars').value='3';

  updatePreview();
  showReviewList();
}
function showReviewList(){
  var rlist=document.getElementById('reviewListing');
  rlist.innerHTML='<h3 style="margin-top:20px;">Reviews in Builder</h3>';
  for(var i=0;i<reviews.length;i++){
    var rv=reviews[i];
    var d=document.createElement('div');
    d.className='review-list-item';
    d.innerHTML='<span>'+ (rv.name||'(Unnamed Review)') +'</span>';
    var btn=document.createElement('button');
    btn.className='delete-btn';
    btn.innerText='Delete';
    btn.onclick=(function(index){
      return function(){
        reviews.splice(index,1);
        updatePreview();
        showReviewList();
      };
    })(i);
    d.appendChild(btn);
    rlist.appendChild(d);
  }
}

/* On each update, we read about, contact, and payment integration data, build final code, push to preview. */
function updatePreview(){
  // hero
  heroData.logo     = document.getElementById('logo').value.trim();
  heroData.banner   = document.getElementById('banner').value.trim();
  heroData.heroText = document.getElementById('heroText').value.trim();
  heroData.ctaText  = document.getElementById('ctaText').value.trim();

  // about
  aboutData.title     = document.getElementById('aboutTitle').value.trim();
  aboutData.paragraph = document.getElementById('aboutParagraph').value.trim();
  aboutData.image     = document.getElementById('aboutImage').value.trim();

  // contact
  contactData.instagram=document.getElementById('contactInstagram').value.trim();
  contactData.tiktok   =document.getElementById('contactTiktok').value.trim();
  contactData.facebook =document.getElementById('contactFacebook').value.trim();
  contactData.email    =document.getElementById('contactEmail').value.trim();

  // payment integration
  paymentIntegration.currency = document.getElementById('paypalCurrency').value.trim();
  paymentIntegration.method = document.getElementById('paymentMethod').value;
  paymentIntegration.paypalEmail = document.getElementById('paypalEmail').value.trim();

  finalHTML=buildFinalHTML();
  var iframe=document.getElementById('previewFrame');
  var doc=iframe.contentDocument||iframe.contentWindow.document;
  doc.open();
  doc.write(finalHTML);
  doc.close();

  showReviewList();
}

/* Build final site with modern styling & smooth scrolling. */
function buildFinalHTML(){
  var top="";
  top+="<!DOCTYPE html><html><head><meta charset='UTF-8'><title>My Product Site (Static Version)</title>";
  top+="<meta name='viewport' content='width=device-width, initial-scale=1.0'>";
  top+="<link href='https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap' rel='stylesheet'>";
  top+=buildGlobalCSS();
  top+="</head><body>";

  top+=buildTopHeader();
  top+=buildHero();
  top+=buildProductsSection();
  top+=buildReviewsSection();
  top+=buildAboutSection();
  top+=buildContactSection();
  top+=buildModal();

  top+="</body></html>";
  return top;
}

/* show/hide final code in <textarea> */
function toggleCode(){
  if(!finalHTML.trim()){
    finalHTML=buildFinalHTML();
  }
  var out=document.getElementById('output');
  if(out.style.display==='none'||!out.style.display){
    out.value=finalHTML;
    out.style.display='block';
  } else {
    out.style.display='none';
  }
}

/* Attempt to auto-download. If blocked, user can right-click fallback link. */
function downloadSite(){
  if(!finalHTML.trim()){
    finalHTML=buildFinalHTML();
  }
  var link=document.getElementById('manualDownloadLink');
  if(!link){
    link=document.createElement('a');
    link.id='manualDownloadLink';
    link.style.display='inline-block';
    link.style.marginTop='10px';
    link.style.padding='10px 20px';
    link.style.background='#4caf50';
    link.style.color='#fff';
    link.style.borderRadius='5px';
    link.style.textDecoration='none';
    link.style.fontWeight='bold';
    link.textContent='Right-click → “Save Link As…”';
    document.body.appendChild(link);
  }
  var dataUri="data:text/html;charset=utf-8,"+encodeURIComponent(finalHTML);
  link.href=dataUri;
  link.download="my_product_site.html";
  link.click();
  alert("If no file is downloaded automatically, right-click the green link and choose 'Save link as...' to download.");
}

/* Build the global CSS, enabling smooth scrolling. */
function buildGlobalCSS(){
  var s="<style>html{scroll-behavior:smooth;} *{box-sizing:border-box;transition:all 0.3s ease;} html,body{margin:0;padding:0;font-family:'Roboto',sans-serif;background:#f7f9fc;color:#333;line-height:1.6;} a{text-decoration:none;color:inherit} a:hover{opacity:0.8} img{max-width:100%;height:auto;display:block}";

  /* top header */
  s+=".top-header{background:#fff;box-shadow:0 2px 4px rgba(0,0,0,0.1);padding:20px 10px;text-align:center}";
  s+=".logo-wrapper{display:inline-block} .logo-wrapper img{max-width:200px}";
  s+=".nav-links{margin-top:15px} .nav-links a{display:inline-block;margin:0 15px;padding:10px 15px;color:#555;font-weight:500;border-radius:4px;transition:background 0.2s,color 0.2s}";

  /* hero banner */
  s+=".hero-banner{position:relative;min-height:60vh;display:flex;align-items:center;justify-content:center;overflow:hidden;background-size:cover;background-position:center}";
  s+=".hero-overlay{position:relative;z-index:1;text-align:center;color:#fff;padding:20px}";
  s+=".hero-title{font-size:3rem;margin:0 0 20px;text-shadow:2px 2px 5px rgba(0,0,0,0.3)}";
  s+=".hero-cta{display:inline-block;padding:15px 30px;background:#fff;color:#000;font-weight:bold;border-radius:5px;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:background 0.3s}";
  s+=".hero-cta:hover{background:#2196f3;color:#fff}";

  /* products grid */
  s+=".products-grid{display:grid;grid-gap:30px;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));padding:40px 20px;max-width:1200px;margin:0 auto}";
  s+=".product-item{background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,0.1);cursor:pointer;text-align:left;transition:transform 0.2s,box-shadow 0.2s}";
  s+=".product-item:hover{transform:translateY(-5px);box-shadow:0 4px 12px rgba(0,0,0,0.2)}";
  s+=".product-img{width:100%;padding-bottom:100%;background-size:cover;background-position:center}";
  s+=".product-content{padding:20px}";
  s+=".product-content h3{margin:0 0 10px;font-size:1.3rem;font-weight:700;color:#222}";
  s+=".product-content h2{margin:0 0 10px;font-size:1.1rem;font-weight:300;color:#109c15}";
  s+=".product-content p{margin:0 0 15px;color:#555}";
  s+=".buy-now{display:block;width:100%;padding:12px 0;background:#2196f3;color:#fff;text-align:center;border-radius:4px;font-weight:bold;transition:background 0.3s}";
  s+=".buy-now:hover{background:#1976d2}";

  /* reviews section */
  s+=".reviews-section{background:linear-gradient(135deg,#f4f4f4,#e2e2e2);padding:60px 20px;text-align:center}";
  s+=".reviews-section h2{margin-bottom:40px;font-size:2rem;color:#333}";
  s+=".review-container{display:flex;justify-content:center;flex-wrap:wrap;gap:30px}";
  s+=".review-item{background:#fff;border-radius:16px;padding:30px;box-shadow:0 4px 20px rgba(0,0,0,0.1);max-width:320px;transition:transform 0.3s ease,box-shadow 0.3s ease;text-align:left}";
  s+=".review-item:hover{transform:translateY(-5px);box-shadow:0 8px 30px rgba(0,0,0,0.15)}";
  s+=".review-item h4{margin:0 0 10px;font-weight:700;font-size:1.25rem}";
  s+=".review-stars{color:#fbc02d;font-size:1.5rem;margin-bottom:10px}";
  s+=".review-item p{margin:5px 0 0;color:#666}";

  /* about section */
  s+=".about-section{background:#fff;display:flex;flex-wrap:wrap;align-items:center;justify-content:center;padding:60px 20px;max-width:1200px;margin:0 auto}";
  s+=".about-left,.about-right{flex:1 1 300px;padding:20px}";
  s+=".about-left h2{margin-top:0;color:#333;font-size:2.5rem}";
  s+=".about-left p{color:#555;line-height:1.8;font-size:1.1rem}";
  s+=".about-right img{border-radius:16px;height:500px;box-shadow:0 4px 20px rgba(0,0,0,0.1);transition:transform 0.3s}";
  s+=".about-right img:hover{transform:scale(1.05)}";

  /* contact section */
  s+=".contact-section{background:linear-gradient(135deg,#f4f4f4,#e2e2e2);color:#333;text-align:center;padding:60px 20px;display:flex;flex-direction:column;align-items:center}";
  s+=".contact-logo{max-width:200px;margin-bottom:20px}";
  s+=".contact-section p{max-width:600px;margin-bottom:20px;font-size:1rem;color:#555}";
  s+=".contact-links{margin:20px 0;display:flex;gap:20px;justify-content:center}";
  s+=".contact-links img{width:40px;height:40px;cursor:pointer;transition:transform 0.3s;border-radius:50%}";
  s+=".contact-links img:hover{transform:scale(1.1)}";
  s+=".contact-email{margin-top:30px}";
  s+=".contact-email span{display:block;font-size:1rem;margin-bottom:10px;color:#333}";
  s+=".email-btn{display:inline-block;padding:12px 25px;background:#2196f3;color:#fff;font-weight:bold;border-radius:5px;text-transform:uppercase;letter-spacing:1px;box-shadow:0 2px 6px rgba(0,0,0,0.1);transition:background 0.3s}";
  s+=".email-btn:hover{background:#1976d2}";

  /* modal */
  s+=".modal{display:none;position:fixed;z-index:9999;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,0.6);justify-content:center;align-items:center;padding:20px}";
  s+=".modal-content{background:#fff;margin:auto;width:90%;max-width:1100px;border-radius:8px;position:relative;padding:20px}";
  s+=".modal-close{position:absolute;top:15px;right:20px;font-size:1.5rem;font-weight:bold;cursor:pointer;line-height:1}";
  s+=".modal-body{display:flex;flex-wrap:wrap;gap:20px}";
  s+=".modal-left{flex:1 1 50%;display:flex;flex-direction:column}";
  s+=".modal-main-image{width:85%;aspect-ratio:4/5;position:relative;overflow:hidden;border-radius:8px}";
  s+=".modal-main-image img{width:100%;height:100%;object-fit:cover}";
  s+=".arrow{position:absolute;top:50%;transform:translateY(-50%);background-color:rgba(255,255,255,0.8);color:#333;padding:0.3rem 0.6rem;border-radius:50%;cursor:pointer;user-select:none;font-weight:bold;box-shadow:0 2px 4px rgba(0,0,0,0.2)}";
  s+=".arrow-left{left:5px}.arrow-right{right:5px}.arrow:hover{background-color:rgba(255,255,255,1)}";
  s+=".modal-thumbs{display:flex;gap:10px;margin-top:10px}";
  s+=".modal-thumbs img{width:80px;height:80px;object-fit:cover;border-radius:4px;cursor:pointer;box-shadow:0 2px 4px rgba(0,0,0,0.1);border:2px solid transparent}";
  s+=".modal-thumbs img.selected{border:2px solid #2196f3}";
  s+=".modal-right{flex:1 1 45%;display:flex;flex-direction:column}";
  s+=".modal-product-price{font-size:1.6rem;color:#109c15;font-weight:700;margin-bottom:15px}";
  s+=".modal-product-sold{font-size:1rem;color:#333;margin-bottom:15px}";
  s+=".modal-product-title{font-size:1.8rem;margin:0 0 10px;font-weight:700;line-height:1.2}";
  s+=".modal-description{margin-bottom:20px;color:#555}";
  s+=".color-options,.size-options,.quantity-options{margin-bottom:15px}";
  s+=".color-options label,.size-options label,.quantity-options label{font-weight:600;margin-right:10px}";
  s+=".color-options span,.size-options span{display:inline-block;margin-right:5px;background:#f0f0f0;padding:5px 10px;border-radius:4px;cursor:pointer;font-size:0.9rem;border:1px solid transparent}";
  s+=".color-options span.selected,.size-options span.selected{background:#d0e8ff;border:1px solid #2196f3}";
  s+=".color-options span:hover,.size-options span:hover{background:#ddd}";
  s+=".qty-controls{display:inline-flex;align-items:center;gap:10px}";
  s+=".qty-btn{width:30px;height:30px;border:1px solid #ccc;background:#fff;cursor:pointer;font-size:1.2rem;line-height:1;border-radius:4px;display:flex;align-items:center;justify-content:center;transition:background 0.3s}";
  s+=".qty-btn:hover{background:#eee}";
  s+=".qty-display{min-width:25px;text-align:center;font-weight:600}";
  s+=".order-details-panel{border:1px solid #eee;padding:15px;border-radius:8px;background:#fafafa}";
  s+=".order-details-panel h3{margin-top:0;font-size:1.2rem;margin-bottom:15px}";
  s+=".order-item{display:flex;justify-content:space-between;margin-bottom:10px;font-size:0.95rem}";
  s+=".order-item label{color:#555;margin-right:5px}";
  s+=".order-item .value{font-weight:600}";
  s+=".shipping-info{background:#fff7de;border-left:4px solid#ffc107;padding:10px;font-size:0.9rem;margin-top:10px}";
  s+=".subtotal{margin-top:10px;font-size:1rem;text-align:right;font-weight:bold}";
  s+=".modal-actions{display:flex;gap:10px;margin-top:20px}";
  s+=".modal-actions button{flex:1;background:#2196f3;color:#fff;border:none;padding:12px;border-radius:4px;cursor:pointer;font-weight:600;font-size:1rem;height:50px;transition:background 0.3s}";
  s+=".modal-actions button:hover{background:#1976d2}";
  s+="</style>";
  return s;
}

function buildTopHeader(){
  var h="";
  h+="<header class='top-header'><div class='logo-wrapper'>";
  if(heroData.logo){
    h+="<img src='"+escapeHTML(heroData.logo)+"' alt='Logo'>";
  }
  h+="</div><div class='nav-links'>";
  h+="<a href='#products'>Shop</a>";
  h+="<a href='#reviews'>Reviews</a>";
  h+="<a href='#about'>About Us</a>";
  h+="<a href='#contact'>Contact Us</a>";
  h+="</div></header>";
  return h;
}

function buildHero(){
  if(!heroData.banner){
    var minimal="";
    minimal+="<section class='hero-banner' style='background:none; min-height:200px;'>";
    minimal+="<div class='hero-overlay'>";
    if(heroData.heroText){
      minimal+="<h1 class='hero-title'>"+escapeHTML(heroData.heroText)+"</h1>";
    }
    if(heroData.ctaText){
      minimal+="<a class='hero-cta' href='#products'>"+escapeHTML(heroData.ctaText)+"</a>";
    }
    minimal+="</div></section>";
    return minimal;
  }
  var bkg=escapeHTML(heroData.banner);
  var s="";
  s+="<section class='hero-banner' style=\"background-image:url('"+bkg+"');\">";
  s+="<div class='hero-overlay'>";
  if(heroData.heroText){
    s+="<h1 class='hero-title'>"+escapeHTML(heroData.heroText)+"</h1>";
  }
  if(heroData.ctaText){
    s+="<a class='hero-cta' href='#products'>"+escapeHTML(heroData.ctaText)+"</a>";
  }
  s+="</div></section>";
  return s;
}

function buildProductsSection(){
  if(products.length===0)return "<section id='products'><div class='products-grid'></div></section>";
  var html="";
  var currencySymbol = escapeHTML(paymentIntegration.currency || "$");
  for(var i=0;i<products.length;i++){
    var p=products[i];
    var mainImg=(p.images.length>0)?escapeHTML(p.images[0]):"";
    html+="<div class='product-item'"+
      " data-title='"+escapeHTML(p.title||"")+"'"+
      " data-img1='"+(p.images[0]||"")+"'"+
      " data-img2='"+(p.images[1]||"")+"'"+
      " data-img3='"+(p.images[2]||"")+"'"+
      " data-sold='"+(p.sold||"")+"'"+
      " data-price='"+escapeHTML(p.price||"0")+"'"+
      " data-coloroptions='"+escapeHTML(p.coloroptions||"")+"'"+
      " data-sizeoptions='"+escapeHTML(p.sizeoptions||"")+"'"+
      " data-description='"+escapeHTML(p.description||"")+"'"+
      " data-shipping='"+escapeHTML(p.shipping||"FREE")+"'"+
      " data-returns='"+escapeHTML(p.returns||"Accepted")+"'"+
      ">";
    html+="<div class='product-img' style=\"background-image:url('"+mainImg+"');\"></div>";
    html+="<div class='product-content'>";
    html+= p.title ? "<h3>"+escapeHTML(p.title)+"</h3>" : "<h3>Untitled Product</h3>";
    html+="<h2>"+currencySymbol+escapeHTML(p.price||"0")+"</h2>";
    html+="<a class='buy-now' href='#'>Buy Now</a>";
    html+="</div></div>";
  }
  return "<section id='products'><div class='products-grid'>"+html+"</div></section>";
}

/* Build reviews from reviews[] */
function buildReviewsSection(){
  if(reviews.length===0)return "";
  var r="<section class='reviews-section' id='reviews'><h2>Reviews</h2><div class='review-container'>";
  for(var i=0;i<reviews.length;i++){
    var rv=reviews[i];
    var starCount=parseInt(rv.stars,10)||3;
    var starSymbols="";
    for(var s=0;s<starCount;s++){starSymbols+="★";}
    for(var s2=starCount;s2<5;s2++){starSymbols+="☆";}
    r+="<div class='review-item'><h4>"+escapeHTML(rv.name)+"</h4><div class='review-stars'>"+starSymbols+"</div><p>"+escapeHTML(rv.text)+"</p></div>";
  }
  r+="</div></section>";
  return r;
}

/* Build about from aboutData */
function buildAboutSection(){
  if(!aboutData.title && !aboutData.paragraph && !aboutData.image)return "";
  var a="<section class='about-section' id='about'><div class='about-left'>";
  a+="<h2>"+escapeHTML(aboutData.title)||"Who We Are"+"</h2>";
  a+="<p>"+escapeHTML(aboutData.paragraph)||"We are a small business, etc."+"</p>";
  a+="</div><div class='about-right'>";
  if(aboutData.image){
    a+="<img src='"+escapeHTML(aboutData.image)+"' alt='About Image'>";
  }
  a+="</div></section>";
  return a;
}

/* Build contact from contactData */
function buildContactSection(){
  if(!contactData.instagram && !contactData.tiktok && !contactData.facebook && !contactData.email)return "";
  var c="<section class='contact-section' id='contact'>";
  if(heroData.logo){
    c+="<img class='contact-logo' src='"+escapeHTML(heroData.logo)+"' alt='Logo'>";
  }
  c+="<p>We’d love to hear from you! Reach out with any questions or feedback and we’ll respond promptly.</p>";
  c+="<div class='contact-links'>";
  if(contactData.instagram){
    c+="<a href='"+escapeHTML(contactData.instagram)+"' target='_blank'><img src='https://i.ibb.co/whYw9tf/Instagram-icon-png.png' alt='Instagram'></a>";
  }
  if(contactData.tiktok){
    c+="<a href='"+escapeHTML(contactData.tiktok)+"' target='_blank'><img src='https://i.ibb.co/JvLtTqq/Tik-Tok-icon-png.png' alt='TikTok'></a>";
  }
  if(contactData.facebook){
    c+="<a href='"+escapeHTML(contactData.facebook)+"' target='_blank'><img src='https://i.ibb.co/9nFXH9w/Facebook-icon-png.png' alt='Facebook'></a>";
  }
  c+="</div>";
  if(contactData.email){
    c+="<div class='contact-email'><span>"+escapeHTML(contactData.email)+"</span><a class='email-btn' href='mailto:"+escapeHTML(contactData.email)+"'>Send Us an Email</a></div>";
  }
  c+="</section>";
  return c;
}

/* Build modal code for multi-image, color/size, shipping, returns. */
function buildModal(){
  var m="";
  m+="<div id='productModal' class='modal'><div class='modal-content'>";
  m+="<span class='modal-close'>&times;</span>";
  m+="<div class='modal-body'>";
  m+="<div class='modal-left'><div class='modal-main-image'><div class='arrow arrow-left' id='arrowLeft'>❮</div><img id='modalMainImg' src='' alt='Main Product Image'><div class='arrow arrow-right' id='arrowRight'>❯</div></div><div class='modal-thumbs'><img id='modalThumb1' src='' alt='Thumb 1'><img id='modalThumb2' src='' alt='Thumb 2'><img id='modalThumb3' src='' alt='Thumb 3'></div></div>";
  m+="<div class='modal-right'><h1 id='modalTitle' class='modal-product-title'></h1><div class='modal-price-line'><div id='modalPrice' class='modal-product-price'>$0.00</div><div id='modalSold' class='modal-product-sold'></div></div>";
  m+="<div id='modalDescription' class='modal-description'></div><div class='color-options'><label>Color:</label><span id='colorPlaceholders'></span></div><div class='size-options'><label>Size:</label><span id='sizePlaceholders'></span></div>";
  m+="<div class='quantity-options'><label>Quantity:</label><div class='qty-controls'><button class='qty-btn qty-minus'>-</button><span id='qtyValue' class='qty-display'>1</span><button class='qty-btn qty-plus'>+</button></div></div>";
  m+="<div class='order-details-panel'><h3>Order Details</h3><div class='order-item'><label>Price x Quantity:</label><span class='value' id='itemTotal'>--</span></div><div class='order-item'><label>Selection:</label><span class='value' id='selectedCombos'>(Color, Size)</span></div><div class='order-item'><label>Shipping:</label><span class='value' id='shippingCost'>$0.00</span></div><div class='order-item'><label>Returns:</label><span class='value' id='returnPolicy'></span></div><div class='shipping-info' id='shippingInfo'><strong>Shipping Information:</strong> If your PayPal shipping address or contact details have changed, please update them at checkout so we send your goodies to the right place!</div><div class='subtotal'>Total: <span id='subtotalValue'>$0.00</span></div></div>";
  m+="<div class='modal-actions'><button class='buy-now-btn'>Buy Now</button></div></div>";
  m+="</div></div></div>";

  m+="<script>(function(){";
  m+="var fixedCurrencySymbol = '"+escapeHTML(paymentIntegration.currency || "$")+"';";
  m+="var paymentMethod = '"+escapeHTML(paymentIntegration.method)+"';";
  m+="var paypalEmail = '"+escapeHTML(paymentIntegration.paypalEmail)+"';";
  m+="var paypalCurrency = '"+escapeHTML(paymentIntegration.currency || "USD")+"';";
  m+="var currentProduct = null;";
  m+="var modal=document.getElementById('productModal'); var modalClose=document.querySelector('.modal-close'); var modalTitle=document.getElementById('modalTitle'); var modalPrice=document.getElementById('modalPrice'); var modalSold=document.getElementById('modalSold'); var modalDescription=document.getElementById('modalDescription'); var modalMainImg=document.getElementById('modalMainImg'); var modalThumb1=document.getElementById('modalThumb1'); var modalThumb2=document.getElementById('modalThumb2'); var modalThumb3=document.getElementById('modalThumb3'); var arrowLeft=document.getElementById('arrowLeft'); var arrowRight=document.getElementById('arrowRight'); var colorPH=document.getElementById('colorPlaceholders'); var sizePH=document.getElementById('sizePlaceholders'); var qtyValue=document.getElementById('qtyValue'); var itemTotal=document.getElementById('itemTotal'); var shippingCost=document.getElementById('shippingCost'); var returnPolicy=document.getElementById('returnPolicy'); var subtotalValue=document.getElementById('subtotalValue'); var selectedCombos=document.getElementById('selectedCombos'); var currentQty=1, basePrice=0, shippingFee=0, returnsText='Accepted'; var allImages=[], currentImgIndex=0; var selectedColor='', selectedSize='';";
  m+="function openModal(p){ currentProduct = p; modalTitle.textContent=p.title||''; modalPrice.textContent=fixedCurrencySymbol+(p.price||'0'); if(p.sold){modalSold.textContent=p.sold+' Sold';}else{modalSold.textContent='';} modalDescription.textContent=p.description||''; basePrice=parseFloat(p.price)||0; if(p.shipping==='FREE'){ shippingFee=0;} else{ shippingFee=parseFloat(p.shipping)||0;} returnsText=p.returns||'Accepted'; currentQty=1; qtyValue.textContent=currentQty;";
  m+="allImages=[]; if(p.img1)allImages.push(p.img1); if(p.img2)allImages.push(p.img2); if(p.img3)allImages.push(p.img3); currentImgIndex=0; if(allImages.length>0)modalMainImg.src=allImages[0]; else modalMainImg.src='https://via.placeholder.com/400?text=No+Image'; modalThumb1.src=allImages[0]||'https://via.placeholder.com/400?text=No+Image1'; modalThumb2.src=allImages[1]||'https://via.placeholder.com/400?text=No+Image2'; modalThumb3.src=allImages[2]||'https://via.placeholder.com/400?text=No+Image3'; resetThumbs(); if(allImages[0]) modalThumb1.classList.add('selected'); selectedColor=''; selectedSize=''; colorPH.innerHTML=''; sizePH.innerHTML=''; if(p.coloroptions){ var carr=p.coloroptions.split(','); for(var i=0;i<carr.length;i++){ var c=carr[i].trim(); if(!c)continue; var sp=document.createElement('span'); sp.innerText=c; sp.onclick=function(col,elm){return function(){ pickColor(col,elm);};}(c,sp); if(i===0){ sp.classList.add('selected'); selectedColor=c;} colorPH.appendChild(sp);}} if(p.sizeoptions){ var sarr=p.sizeoptions.split(','); for(var j=0;j<sarr.length;j++){ var sizeX=sarr[j].trim(); if(!sizeX)continue; var ssp=document.createElement('span'); ssp.innerText=sizeX; ssp.onclick=function(sz,elm){return function(){ pickSize(sz,elm);};}(sizeX,ssp); if(j===0){ ssp.classList.add('selected'); selectedSize=sizeX;} sizePH.appendChild(ssp);}} updateOrderDetails(); modal.style.display='flex';}";
  m+="function pickColor(c,span){ Array.from(colorPH.children).forEach(function(ch){ch.classList.remove('selected');}); span.classList.add('selected'); selectedColor=c; updateOrderDetails();}";
  m+="function pickSize(c,span){ Array.from(sizePH.children).forEach(function(ch){ch.classList.remove('selected');}); span.classList.add('selected'); selectedSize=c; updateOrderDetails();}";
  m+="function resetThumbs(){ modalThumb1.classList.remove('selected'); modalThumb2.classList.remove('selected'); modalThumb3.classList.remove('selected');}";
  m+="arrowLeft.onclick=function(){ if(allImages.length<2)return; currentImgIndex=(currentImgIndex-1+allImages.length)%allImages.length; setMain();}; arrowRight.onclick=function(){ if(allImages.length<2)return; currentImgIndex=(currentImgIndex+1)%allImages.length; setMain();};";
  m+="function setMain(){ modalMainImg.src=allImages[currentImgIndex]; resetThumbs(); if(currentImgIndex===0)modalThumb1.classList.add('selected'); if(currentImgIndex===1)modalThumb2.classList.add('selected'); if(currentImgIndex===2)modalThumb3.classList.add('selected');}";
  m+="modalThumb1.onclick=function(){ if(!allImages[0])return; currentImgIndex=0; setMain();}; modalThumb2.onclick=function(){ if(!allImages[1])return; currentImgIndex=1; setMain();}; modalThumb3.onclick=function(){ if(!allImages[2])return; currentImgIndex=2; setMain();};";
  m+="document.querySelector('.qty-minus').onclick=function(){ if(currentQty>1){ currentQty--; qtyValue.textContent=currentQty; updateOrderDetails();}};";
  m+="document.querySelector('.qty-plus').onclick=function(){ currentQty++; qtyValue.textContent=currentQty; updateOrderDetails();};";
  m+="function updateOrderDetails(){ var total=basePrice*currentQty; itemTotal.textContent=fixedCurrencySymbol+basePrice.toFixed(2)+' x '+currentQty+' = '+fixedCurrencySymbol+(total.toFixed(2)); if(shippingFee===0){ shippingCost.textContent='FREE'; } else{ shippingCost.textContent=fixedCurrencySymbol+shippingFee.toFixed(2);} returnPolicy.textContent=returnsText; var grand=total+shippingFee; subtotalValue.textContent=fixedCurrencySymbol+grand.toFixed(2); selectedCombos.textContent='('+selectedColor+', '+selectedSize+')';}";
  m+="modalClose.onclick=function(){ modal.style.display='none';}; window.onclick=function(e){ if(e.target===modal){ modal.style.display='none';}};";
  m+="document.querySelectorAll('.product-item').forEach(function(it){ var pd={}; pd.title=it.getAttribute('data-title')||''; pd.sold=it.getAttribute('data-sold')||''; pd.price=it.getAttribute('data-price')||'0'; pd.description=it.getAttribute('data-description')||''; pd.img1=it.getAttribute('data-img1')||''; pd.img2=it.getAttribute('data-img2')||''; pd.img3=it.getAttribute('data-img3')||''; pd.coloroptions=it.getAttribute('data-coloroptions')||''; pd.sizeoptions=it.getAttribute('data-sizeoptions')||''; pd.shipping=it.getAttribute('data-shipping')||'FREE'; pd.returns=it.getAttribute('data-returns')||'Accepted'; it.addEventListener('click',function(){ openModal(pd);}); var buy=it.querySelector('.buy-now'); if(buy){ buy.addEventListener('click',function(ev){ ev.stopPropagation(); ev.preventDefault(); openModal(pd);});}});";
  m+="document.querySelector('.buy-now-btn').onclick = function(){";
  m+="  if (!currentProduct) return;";
  m+="  if (paymentMethod === 'paypalEmail') {";
  m+="    var url = \"https://www.paypal.com/cgi-bin/webscr?cmd=_xclick\"";
  m+=",+ \"&business=\" + encodeURIComponent(paypalEmail)";
  m+=",+ \"&item_name=\" + encodeURIComponent(currentProduct.title)";
  m+=",+ \"&amount=\" + encodeURIComponent(currentProduct.price)";
  m+=",+ \"&currency_code=\" + encodeURIComponent(paypalCurrency);";
  m+="    window.open(url, '_blank');";
  m+="  } else if (paymentMethod === 'paypalLink' && currentProduct.paypalLink) {";
  m+="    window.open(currentProduct.paypalLink, '_blank');";
  m+="  } else if (paymentMethod === 'paypalEmbed' && currentProduct.paypalEmbed) {";
  m+="    var newWin = window.open(\"\", \"_blank\");";
  m+="    newWin.document.write(currentProduct.paypalEmbed);";
  m+="  } else {";
  m+="    alert(\"Payment integration not configured.\");";
  m+="  }";
  m+="};";
  m+="})();<\/script>";
  return m;
}

/* Escape function for user text. */
function escapeHTML(str){
  if(!str)return "";
  return str.replace(/[<>"'&]/g,function(c){
    switch(c){
      case '<':return '&lt;';
      case '>':return '&gt;';
      case '"':return '&quot;';
      case "'":return '&#39;';
      case '&':return '&amp;';
    }
  });
}
</script>
</body>
</html>
