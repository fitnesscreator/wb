<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <!-- Primary Meta Tags -->
<title>Boss in Pajamas ‚Äì eCommerce Website Builder for Quick Online Store Launch</title>
<meta name="title" content="Boss in Pajamas ‚Äì eCommerce Website Builder for Quick Online Store Launch">
<meta name="description" content="Build a professional online store in minutes with Boss in Pajamas. Launch your eCommerce website quickly and start selling without any coding experience.">
<meta name="keywords" content="eCommerce website builder, online store, quick launch, no coding required, online business, Boss in Pajamas, digital marketplace, sell products online, drop shipping, small business">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://bossinpajamas.com/">
<meta property="og:title" content="Boss in Pajamas ‚Äì eCommerce Website Builder for Quick Online Store Launch">
<meta property="og:description" content="Build a professional online store in minutes with Boss in Pajamas. Launch your eCommerce website quickly and start selling without any coding experience.">
<meta property="og:image" content="https://i.ibb.co/XNg8tLy/Bella-89.png">

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="https://bossinpajamas.com/">
<meta property="twitter:title" content="Boss in Pajamas ‚Äì eCommerce Website Builder for Quick Online Store Launch">
<meta property="twitter:description" content="Build a professional online store in minutes with Boss in Pajamas. Launch your eCommerce website quickly and start selling without any coding experience.">
<meta property="twitter:image" content="https://i.ibb.co/XNg8tLy/Bella-89.png">

<!-- Canonical Link -->
<link rel="canonical" href="https://bossinpajamas.com/" />

<!-- Organization Schema (JSON-LD) -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "Boss in Pajamas",
  "url": "https://bossinpajamas.com/",
  "logo": "https://i.ibb.co/XNg8tLy/Bella-89.png",
  "sameAs": [
    "https://facebook.com/your-company",
    "https://twitter.com/your-company",
    "https://instagram.com/your-company",
    "https://linkedin.com/company/your-company"
  ],
  "description": "Build a professional online store in minutes with Boss in Pajamas. Launch your eCommerce website quickly and start selling without any coding experience."
}
</script>
  <title>Create Website</title>
  <style>
    /* Basic builder layout */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
      background: #faf9ff;
      color: #333;
      text-align: center;
      line-height: 1.6;
    }
    /* Main container with Flexbox */
    .main-container {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      align-items: flex-start;
      max-width: 1400px;
      margin: 0 auto 40px auto;
      padding: 20px;
      gap: 20px;
    }
    /* Forms section */
    .forms-section {
      flex: 1;
      max-width: 500px;
      padding: 20px;
      height: calc(100vh - 80px);
      overflow-y: auto;
    }
    form {
      margin-bottom: 60px;
      background: transparent;
    }
    .forms-section h2 {
      text-align: left;
      margin-bottom: 15px;
      font-size: 1.5rem;
      color: #555;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: flex-start;
    }
    .forms-section h2::before {
      content: '';
      display: inline-block;
      width: 4px;
      height: 24px;
      background: linear-gradient(to bottom, #5e91ff, #9462ee);
      margin-right: 10px;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: 500;
      text-align: left;
      font-size: 0.9rem;
    }
    label img {
      width: 20px;
      height: 20px;
      margin-right: 8px;
      vertical-align: middle;
    }
    input, textarea, select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ddd;
      border-radius: 6px;
      box-sizing: border-box;
      font-size: 14px;
      transition: border-color 0.2s;
      background: #fff;
      color: #333;
      spellcheck: false;
    }
    input:focus, textarea:focus, select:focus {
      border-color: #2196f3;
      outline: none;
    }
    button {
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 12px 20px;
      margin-top: 20px;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.3s;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    button[onclick="addProduct()"],
    button[onclick="addReview()"] {
      background: linear-gradient(to right, #ff8f5a, #ff3096);
    }
    button[onclick="addProduct()"]:hover,
    button[onclick="addReview()"]:hover {
      background: #fe2c55;
    }
    button:hover:not([onclick="addProduct()"]):not([onclick="addReview()"]) {
      background: #1976f2;
    }
    /* Disabled Pay Button Styling */
    #payBtn {
      background: #b3d7ff;
      opacity: 0.7;
      cursor: not-allowed;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #payBtn img {
      margin-right: 8px;
      height: 20px;
      opacity: 0.7;
    }
    /* Enabled state: yellow background with black text/icon */
    #payBtn.enabled {
      background: #ffc439;
      opacity: 1;
      cursor: pointer;
    }
    #payBtn.enabled img {
      opacity: 1;
    }
    /* When payment is successful, icon disappears and text changes */
    /* Buttons for Download and Copy Code */
    #downloadBtn {
      background: #388eff;
      margin-right: 3px;
    }
    #downloadBtn:hover {
      background: #38b6ff;
    }
    #showCodeBtn {
      background: #004aad;
      margin-left: 3px;
    }
    #showCodeBtn:hover {
      background: #0057cc;
    }
    /* Stylized Add Image Button */
    #addImagesBtn {
      background: #fec7e0;
      color: #ffffff;
      border-radius: 4px;
      padding: 12px 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      margin-top: 10px;
    }
    #addImagesBtn .arrow {
      display: inline-block;
      margin-left: 8px;
      transform: rotate(-45deg);
      transition: transform 0.2s;
    }
    #addImagesBtn:hover {
      background: #ff66c4;
      color: #fff;
      border: none;
    }
    #addImagesBtn:hover .arrow {
      transform: rotate(-45deg) translateX(5px);
    }
    #uploadBtn {
      background: linear-gradient(to right, #fa8b5c, #f6d365);
      border: none;
      color: #fff;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.3s;
    }
    #uploadBtn:hover {
      background: linear-gradient(to right, #f67a45, #f5c64d);
    }
    /* Rotate the Upload Button Arrow */
    #uploadBtn .arrow {
      display: inline-block;
      transition: transform 0.3s ease;
      transform: rotate(-45deg);
    }
    #uploadBtn:hover .arrow {
      transform: rotate(135deg);
    }
    hr {
      margin: 30px 0;
      border: none;
      border-top: 1px solid #eee;
    }
    /* Preview section */
    .preview-section {
      flex: 1.2;
      max-width: 900px;
      background: #fff;
      border: 1px solid #eee;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .preview-section h2 {
      margin-bottom: 15px;
      font-size: 1.5rem;
      color: #777;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      width: 100%;
    }
    .preview-section h2::before {
      content: '';
      display: inline-block;
      width: 4px;
      height: 24px;
      background: linear-gradient(to bottom, #5e91ff, #9462ee);
      margin-right: 10px;
    }
    #previewFrame {
      width: 100%;
      min-height: 600px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      background: #fff;
    }
    /* Custom Currency Dropdown Styles */
    .currency-dropdown {
      position: relative;
      width: 100%;
    }
    .currency-input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      box-sizing: border-box;
      font-size: 14px;
      background: #fff;
      color: #333;
      cursor: pointer;
      spellcheck: false;
    }
    .currency-list {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid #ddd;
      border-top: none;
      background: #fff;
      z-index: 1000;
      display: none;
    }
    .currency-list.visible {
      display: block;
    }
    .currency-item {
      padding: 10px;
      display: flex;
      align-items: center;
      cursor: pointer;
    }
    .currency-item:hover {
      background: #f0f0f0;
    }
    .currency-flag {
      margin-right: 10px;
      font-size: 1.2rem;
    }
    .currency-code {
      font-weight: bold;
      margin-right: 5px;
    }
    .currency-name {
      color: #555;
    }
    .currency-search {
      padding: 10px;
      border-bottom: 1px solid #ddd;
    }
    .currency-search input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
    }
    /* Stylized Add Product Form */
    #addProductForm {
      border: 1px solid #ff3096;
      border-radius: 8px;
      padding: 20px;
      margin-top: 15px;
    }
    /* Stylized Upload Photos Form */
    #uploadPhotosForm {
      border: 1px solid #ff3096;
      border-radius: 8px;
      padding: 20px;
      margin-top: 15px;
      background: transparent;
    }
    #uploadPhotosForm h2::before {
      background: #5e91ff;
    }
    #uploadPhotosForm p {
      text-align: left;
      margin-bottom: 20px;
      color: #555;
      font-size: 0.9rem;
    }
    /* Stylized Builder Forms: Hero & Logo, Add Reviews, and About Us */
    #heroLogoForm,
    #addReviewForm,
    #aboutForm {
      border: 1px solid #ff3096;
      border-radius: 8px;
      padding: 20px;
      margin-top: 15px;
    }
    /* Payment Method Label Enhancements */
    .payment-method-label {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 4px;
      margin-top: 15px;
    }
    .payment-method-row {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .payment-method-row img {
      width: 24px;
      height: 24px;
    }
    .payment-method-row span {
      font-weight: 500;
      margin-left: 4px;
    }
    .payment-method-select {
  position: relative;
  display: inline-block;
  width: 100%;
}

.payment-method-select select {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  width: 100%;
  padding: 12px 16px;
  border: 1px solid #ccc;
  border-radius: 8px;
  font-size: 17px;
  color: #333;
  background-color: #fff;
  background-image: none;
  transition: border 0.3s ease, box-shadow 0.3s ease;
}

.payment-method-select select:focus {
  outline: none;
  border-color: #2196f3;
  box-shadow: 0 0 8px rgba(33, 150, 243, 0.2);
}

/* Custom arrow */
.payment-method-select::after {
  position: absolute;
  top: 50%;
  right: 16px;
  transform: translateY(-50%);
  pointer-events: none;
  font-size: 12px;
  color: #777;
}
    
    #productPaymentMethod optgroup {
  font-size: 12px;
  color: #888;
}
    
    /* Custom CSS for the "Select Payment Method" button */
#paymentMethodBtn {
  background-color: #5e91ff;
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 12px 24px;
  font-size: 0.9rem;
  text-transform: normal;
  letter-spacing: 0.05em;
  cursor: pointer;
  transition: background-color 0.3s ease, transform 0.2s ease;
}

#paymentMethodBtn:hover {
  background-color: #4a7bd4;
  transform: scale(1.03);
}

#paymentMethodBtn:focus {
  outline: none;
  box-shadow: 0 0 0 3px rgba(94, 145, 255, 0.5);
}
    
    /* When a payment method is selected */
#paymentMethodBtn.selected {
  background-color: #4caf50; /* A nice green */
  color: #fff;
  border: none;
}




    #howtocreatepaypalbutton {
      padding: 10px 20px;
      background: linear-gradient(to right, #a6a6a6, #c2d7db);
      color: #ffffff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: normal;
      transition: background 0.3s;
    }
    #howtocreatepaypalbutton:hover {
      background: linear-gradient(to right, #5450c0, #a862ea);
    }
    /* Add Contact Form row */
    .add-contact-form-row {
      margin-top: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .add-contact-form-row img {
      width: 40px;
      height: 40px;
    }
    .add-contact-form-row span {
      font-weight: bold;
      font-size: 1.2rem;
    }
    #addContactFormButton {
      background: linear-gradient(to right, #ff6c6c, #ffc371);
      color: #fff !important;
      font-weight: 600;
    }
    #addContactFormButton:hover {
      background: linear-gradient(to right, #ff4c4c, #ffb347);
    }
    #addContactFormButton.success {
      background: green !important;
      cursor: default;
    }
    /* The contact form modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .modal-content {
      background: #fff;
      margin: auto;
      width: 90%;
      max-width: 800px;
      border-radius: 6px;
      position: relative;
      padding: 20px;
    }
    .modal-close, .modal-close-contact {
      position: absolute;
      top: 15px;
      right: 20px;
      font-size: 1.5rem;
      font-weight: bold;
      cursor: pointer;
      line-height: 1;
    }
    .modal-content h2 {
      margin-top: 0;
    }
    .modal-content textarea {
      margin-top: 15px;
    }
    #confirmAddContactFormButton {
      background: linear-gradient(to right, #ff6c6c, #ffc371);
      color: #fff;
      font-weight: 600;
      margin-top: 20px;
      border: none;
      padding: 12px 20px;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s;
    }
    #confirmAddContactFormButton:hover {
      background: linear-gradient(to right, #ff4c4c, #ffb347);
    }
    /* Contact Us form in the builder */
    #contactUsForm {
      border: 1px solid #ff3096;
      border-radius: 8px;
      padding: 20px;
      margin-top: 15px;
      background: transparent;
    }
    
    /* New Buttons for Contact Form Modal */
.contact-btn {
  display: inline-block;
  padding: 4px 8px; /* reduced padding for a smaller button */
  border: none;
  border-radius: 4px;
  color: #fff;
  font-size: 12px; /* smaller font size */
  font-weight: bold;
  cursor: pointer;
  margin: 0 5px;
  position: relative;
  background: #333; /* fallback color */
  transition: background 0.3s ease, transform 0.3s ease;
  width: 140px;
  height: 40px;
}

/* Arrow to indicate redirection on hover */
.contact-btn::after {
  content: "‚Üí";
  opacity: 0;
  display: inline-block;
  margin-left: 5px;
  transition: opacity 0.3s ease, transform 0.3s ease;
}
.contact-btn:hover::after {
  opacity: 1;
  transform: translateX(3px);
}

/* Jotform button with a red-to-gold gradient */
.jotform-btn {
  background: linear-gradient(to right, #ff6c6c, #ffc371);
}

/* Google Forms button with a blue-to-green gradient */
.googleforms-btn {
  background: linear-gradient(to right, #000000, #004aad);
}


    /* Gradient Line for Section Titles */
    .section-title {
      position: relative;
      display: inline-block;
      padding-left: 25px;
      margin-bottom: 20px;
      font-size: 1.5rem;
      font-weight: 700;
    }
    .section-title::before {
      content: "";
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 5px;
      height: 35px;
      background: linear-gradient(to bottom, #ff8f5a, #ff3096, #fe2c55) !important;
      border-radius: 3px;
    }
    /* Email Verification Row Styling */
    #emailVerificationRow {
      display: none;
      margin-top: 10px;
      flex-direction: row;
      align-items: center;
      gap: 10px;
    }
    #emailVerificationRow input {
      width: 80%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    #emailVerificationRow button {
      width: 18%;
      padding: 8px;
      background: #28a745;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 7px;
    }
    /* Code Modal Styles */
    #codeModal .modal-content {
      max-width: 600px;
      text-align: left;
    }
    #codeModal textarea {
      width: 100%;
      margin-bottom: 10px;
      font-family: monospace;
      font-size: 12px;
    }
    #copyCodeButton {
      background: #2196f3;
      border: none;
      padding: 10px 20px;
      color: #fff;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s;
    }
    #copyCodeButton:hover {
      background: #1976d2;
    }
    /* Responsive adjustments */
    @media (max-width: 1400px) {
      .preview-section {
        flex: 1;
        max-width: 700px;
      }
    }
    @media (max-width: 992px) {
      .main-container {
        flex-direction: column;
      }
      .forms-section, .preview-section {
        max-width: 100%;
      }
    }
    /* --- Custom Builder Added Items Styling --- */
    .builder-item-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 5px 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 5px;
    }
    .builder-item-row span {
      flex: 1;
      text-align: left;
    }
    .delete-btn {
      background-color: red;
      color: #fff;
      border: none;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border-radius: 4px;
    }
    
    .popup-message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #2196F3; /* blue background */
      color: #fff;
      padding: 20px 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      z-index: 10000; /* make sure it's on top */
      max-width: 90%;
      text-align: center;
    }
    
    .popup-message .close {
      position: absolute;
      top: 8px;
      right: 12px;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
    }
    
    .color-options span.selected,
.size-options span.selected,
.paypal-embed-option span.selected {
  border: 2px solid #2196f3;
  background: #eef6ff;
}
    
    .paypal-embed-option span.selected {
  border: 2px solid #2196f3;
  background: #eef6ff;
}
    
    #refreshBtn {
    background: linear-gradient(135deg, #ff8f5a, #ff3096);
    color: white;
    font-size: 16px;
    font-weight: bold;
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease-in-out;
    outline: none;
    position: relative;
    overflow: hidden;
    width: 100px;
    height: 40px;
    margin-left: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
      top: -9px;
}

/* Add a refresh icon inside */
#refreshBtn::after {
    content: "‚Üª"; /* Unicode refresh symbol */
    font-size: 18px;
    margin-left: 5px;
    transition: transform 0.3s ease-in-out;
}

/* Rotate the refresh icon when clicked */
#refreshBtn:active::after {
    transform: rotate(360deg);
  
}
    
    /* Payment Card Wrapper */
.payment-card {
  width: auto;
  border-radius: 8px;                   /* Same border radius as other forms */
  overflow: hidden;                     /* Ensures child content respects the rounded corners */
  padding: 20px;                        /* Internal spacing */
  margin-top: 20px;                     /* Spacing above the card */
  /* Animated Gradient Background */
  background: linear-gradient(270deg, #ff8f5a, #ff99cb, #ff99ad);
  background-size: 800% 800%;
  animation: gradientAnimation 15s ease infinite;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Optional subtle shadow */
}

/* Keyframes for smooth gradient animation */
@keyframes gradientAnimation {
  0%   { background-position: 0% 50%; }
  50%  { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}
   #paymentSection .section-title {
  color: #fff; /* Change this to your desired title color */
}

#paymentSection p {
  color: #fff; /* Change this to your desired paragraph color */
  text-align: left;
}
    
    /* Styles for About Section Color Pickers */
.icon-container {
    display: flex;
    gap: 10px; /* Space between buttons */
}
.icon-wrapper {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 50px;
    height: 50px;
    border: 2px solid #fec7e0; /* Light gray border */
    border-radius: 10px; /* Rounded corners */
    background-color: #fff; /* Default background color */
    cursor: pointer; /* Pointer cursor on hover */
}
.custom-t-icon {
    font-size: 25px;
    font-weight: bold;
    color: #666; /* Light gray for the "T" icon */
}
.fa-paint-brush {
    font-size: 18px;
    color: #666; /* Light gray for the brush icon */
}
.fa-sliders-h {
    font-size: 20px;
    color: #666; /* Light gray for the brush icon */
}
/* Hide the color picker inputs */
.color-picker {
    display: none;
}
    
    /* New styles for the font dropdown */
.dropdown-menu {
  min-width: 120px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  max-height: 200px;
  overflow-y: auto;
}
.dropdown-menu div {
  padding: 5px 10px;
  cursor: pointer;
}
.dropdown-menu div:hover {
  background: #f0f0f0;
}
    
    .cta-color-options {
  display: flex;
  align-items: center;
  gap: 10px;
}
    
    .flex-row {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 10px;
}
    
    /* Container for each input + button */
.input-row {
  display: flex;
  align-items: center;
  margin-top: 5px;
}

/* Square upload button */
.upload-btn {
  background-color: #fc9cd3;
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 12px 24px;
  font-size: 0.9rem;
  text-transform: normal;
  letter-spacing: 0.05em;
  cursor: pointer;
  transition: background-color 0.3s ease, transform 0.2s ease;
}

.upload-btn:hover {
  background-color: #ff66c4 !important;
  transform: scale(1.03);
}


/* icon in the button */
.upload-btn i {
  margin: 0;
  font-size: 1.2rem;
}
    
    /* Upload Modal Styles */
#uploadModal {
  display: none;
  align-items: center;
  justify-content: center;
}

#uploadModal .modal-content {
  max-width: 600px;
  height: 400px;
  text-align: center;
}

#uploadModal .modal-close {
  cursor: pointer;
  font-size: 1.5rem;
}

/* Upload Drop Area */
#uploadDropArea {
  border: 2px dashed #ccc;
  padding: 20px;
  margin: 10px 0;
  height: 230px;
  text-align: center;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  cursor: pointer;
}

#uploadDropArea i {
  font-size: 5rem;
  color: #ccc;
  transition: transform 0.3s, color 0.3s;
}

#uploadDropArea:hover i {
  color: #ff3096;
  transform: scale(1.1);
}


/* Hide the file input */
#uploadFileInput {
  display: none;
}

/* Browse Button Styles */
#browseButton {
  background: linear-gradient(to right, #ff8f5a, #ff3096);
  border: none;
  color: #fff;
  border-radius: 4px;
  padding: 12px 20px;
  cursor: pointer;
  transition: background 0.3s;
}

#browseButton:hover {
  background: #fe2c55;
}

    
    /* Modal Overlay */
.modal {
  display: none; /* Hidden by default */
  position: fixed;
  z-index: 1000;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.4); /* Subtle dark overlay */
  justify-content: center;
  align-items: center;
  animation: fadeIn 0.3s ease-in-out;
}

/* Modal Content */
.modal-content {
  background: #fff;
  border-radius: 16px; /* Extra smooth corners */
  padding: 40px 50px;
  width: 800px; /* Fixed width of 800px */
  box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
  position: relative;
  font-family: 'Helvetica Neue', Arial, sans-serif;
  text-align: left;
  animation: slideDown 0.4s ease-out;
  overflow: hidden;
  border: 1px solid #e6e6e6;
}

/* Close Button */
.modal-close {
  position: absolute;
  top: 20px;
  right: 25px;
  font-size: 28px;
  cursor: pointer;
  color: #666;
  transition: color 0.2s ease;
}

.modal-close:hover {
  color: #333;
}

/* Modal Header */
.modal h2 {
  margin: 0 0 25px;
  font-size: 2rem;
  text-align: center;
  color: #333;
  font-weight: 600;
}

/* Payment Options List */
.payment-options {
  list-style: none;
  padding: 0;
  margin: 0;
}

.payment-options li {
  border: 1px solid #ddd;
  border-radius: 12px;
  padding: 20px 25px;
  margin-bottom: 15px;
  cursor: pointer;
  transition: background 0.3s, border-color 0.3s, transform 0.2s;
  text-align: left;
}

.payment-options li:hover {
  background: #e7f3ff; /* Light blue background on hover */
  border-color: #2575d6; /* Darker blue border on hover */
  transform: translateY(-2px);
}


.payment-options li h3 {
  margin: 0 0 12px;
  font-size: 1.4rem;
  color: #222;
  display: flex;
  align-items: center;
}

.payment-options li h3 img {
  width: 28px;
  height: 28px;
  vertical-align: middle;
  margin-right: 12px;
}

.payment-options li p {
  margin: 0 0 8px;
  font-size: 1rem;
  color: #555;
  line-height: 1.5;
}

.payment-options li small {
  font-size: 0.90rem;
  color: black;
  display: block;
  margin-top: 8px;
}

/* Animations */
@keyframes fadeIn {
  from { opacity: 0; }
  to   { opacity: 1; }
}

@keyframes slideDown {
  from { transform: translateY(-20px); opacity: 0; }
  to   { transform: translateY(0); opacity: 1; }
}


  
  </style>
</head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <!-- Then include FileSaver.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&family=Open+Sans&family=Lato&family=Montserrat&family=Source+Sans+Pro&family=Raleway&family=Ubuntu&family=Poppins&family=Merriweather&family=Oswald&family=Patrick+Hand&family=Indie+Flower&family=Shadows+Into+Light&family=Dancing+Script&family=Homemade+Apple&family=Caveat&family=Sacramento&family=Gloria+Hallelujah&family=Handlee&family=Reenie+Beanie&family=Pacifico&family=Lobster&family=Amatic+SC&family=Satisfy&family=Cookie&display=swap" rel="stylesheet">


  <script>
  // Create a new link element
  const faviconLink = document.createElement('link');
  
  // Set the attributes for the favicon
  faviconLink.rel = 'icon';
  faviconLink.type = 'image/png';
  faviconLink.href = 'https://i.ibb.co/r2dwry1t/Bella-2025-02-14-T170359-184.png';
  
  // Append the link element to the document head
  document.head.appendChild(faviconLink);
</script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<body>
  <!-- Main container: forms on the left, preview on the right -->
  <div class="main-container">
    <!-- Forms section on the left -->
    <div class="forms-section">
      
      <!-- Hero & Logo Section -->
<form id="heroLogoForm">
  <h2 class="section-title">Hero & Logo Section</h2>

  <!-- Logo Image Row -->
  <label>Upload Logo Image</label>
  <div class="input-row">
    <!-- Hidden input instead of text -->
    <input
      id="logo"
      type="hidden"
      value=""
      required
      spellcheck="false"
      maxlength="300"
    />
    <button
      type="button"
      class="upload-btn"
      id="uploadLogoBtn"
      title="Upload Logo"
      onclick="openUploadModal('uploadLogoBtn')"
    >
      <i class="fas fa-cloud-upload-alt"></i>
    </button>
  </div>

  <!-- Hero Banner Image Row -->
  <label>Upload Your Hero Banner Image</label>
  <div class="input-row">
    <!-- Hidden input instead of text -->
    <input
      id="banner"
      type="hidden"
      value=""
      required
      spellcheck="false"
      maxlength="300"
    />
    <button
      type="button"
      class="upload-btn"
      id="uploadBannerBtn"
      title="Upload Hero Banner"
      onclick="openUploadModal('uploadBannerBtn')"
    >
      <i class="fas fa-cloud-upload-alt"></i>
    </button>
  </div>

  <label>Hero Title
    <textarea
      id="heroText"
      rows="2"
      placeholder="Your amazing headline"
      required
      spellcheck="false"
      maxlength="70"
    ></textarea>
  </label>

  <label>Hero Title Color &amp; Font</label>
  <div class="flex-row" style="position: relative;">
    <!-- Color Picker Button -->
    <div class="icon-wrapper" onclick="document.getElementById('heroTitleColorPicker').click()">
      <div class="custom-t-icon">T</div>
      <input
        type="color"
        id="heroTitleColorPicker"
        class="color-picker"
        value="#000000"
        onchange="updateHeroTitleColor()"
      />
    </div>
    <!-- Font Button -->
    <div
      class="icon-wrapper"
      id="heroFontButton"
      onclick="event.stopPropagation(); toggleFontDropdown()"
    >
      Font
    </div>
    <!-- Dropdown Menu (initially hidden) -->
    <div
      id="fontDropdown"
      class="dropdown-menu"
      style="
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 5px;
        z-index: 1000;
      "
    ></div>
  </div>

  <label>CTA Button Text
    <input
      id="ctaText"
      type="text"
      placeholder="Shop Now!"
      required
      spellcheck="false"
      maxlength="30"
    />
  </label>

  <label>CTA Button Colors</label>
  <div class="cta-color-options">
    <div class="icon-wrapper" onclick="document.getElementById('ctaBgColorPicker').click()">
      <i class="fas fa-paint-brush"></i>
      <input
        type="color"
        id="ctaBgColorPicker"
        class="color-picker"
        value="#007bff"
        onchange="updateCTAButtonColors()"
      />
    </div>
    <div class="icon-wrapper" onclick="document.getElementById('ctaTextColorPicker').click()">
      <div class="custom-t-icon">T</div>
      <input
        type="color"
        id="ctaTextColorPicker"
        class="color-picker"
        value="#ffffff"
        onchange="updateCTAButtonColors()"
      />
    </div>
  </div>
</form>




      <!-- Add Products -->
<form id="addProductForm">
  <h2 class="section-title">Add Products</h2>

  <label>Product Title
    <input
      id="productTitle"
      type="text"
      placeholder="Awesome Gadget"
      required
      spellcheck="false"
      maxlength="60"
    />
  </label>

  <label>Upload Main Product Image</label>
  <div class="input-row">
    <!-- Hidden input instead of text -->
    <input
      id="image1"
      type="hidden"
      value=""
      required
      spellcheck="false"
      maxlength="300"
    />
    <button
      type="button"
      class="upload-btn"
      id="uploadImage1Btn"
      title="Upload 1st Image"
      onclick="openUploadModal('uploadImage1Btn')"
    >
      <i class="fas fa-cloud-upload-alt"></i>
    </button>
  </div>

  <div id="additionalImage2" style="display:none;">
    <label>Upload 2nd Product Image</label>
    <div class="input-row">
      <!-- Hidden input instead of text -->
      <input
        id="image2"
        type="hidden"
        value=""
        spellcheck="false"
        maxlength="300"
      />
      <button
        type="button"
        class="upload-btn"
        id="uploadImage2Btn"
        title="Upload 2nd Image"
        onclick="openUploadModal('uploadImage2Btn')"
      >
        <i class="fas fa-cloud-upload-alt"></i>
      </button>
    </div>
  </div>

  <div id="additionalImage3" style="display:none;">
    <label>Upload 3rd Product Image</label>
    <div class="input-row">
      <!-- Hidden input instead of text -->
      <input
        id="image3"
        type="hidden"
        value=""
        spellcheck="false"
        maxlength="300"
      />
      <button
        type="button"
        class="upload-btn"
        id="uploadImage3Btn"
        title="Upload 3rd Image"
        onclick="openUploadModal('uploadImage3Btn')"
      >
        <i class="fas fa-cloud-upload-alt"></i>
      </button>
    </div>
  </div>

  <button
    type="button"
    id="addImagesBtn"
    onclick="addImageField()"
  >
    Add Image +
  </button>

  <label>Your Paypal Currency
    <div class="currency-dropdown">
      <input
        type="text"
        id="productCurrency"
        class="currency-input"
        placeholder="Select Currency"
        readonly
        spellcheck="false"
      />
      <div class="currency-list" id="currencyList">
        <div class="currency-search">
          <input
            type="text"
            id="currencySearch"
            placeholder="Search Currency"
            spellcheck="false"
          />
        </div>
      </div>
    </div>
  </label>

  <label>Number Sold
    <input
      id="sold"
      type="text"
      placeholder="e.g. 500 (blank or 0 to hide)"
    />
  </label>

  <label>Price
    <input
      id="price"
      type="text"
      placeholder="12.99"
      required
      spellcheck="false"
      maxlength="15"
    />
  </label>

  <label>Shipping Cost (set 0 for FREE)
    <input
      id="shipping"
      type="text"
      placeholder="e.g. 3.99 or 0"
      required
      spellcheck="false"
      maxlength="15"
    />
  </label>

  <label>Returns
    <select id="returns" required>
      <option value="Accepted">Accepted</option>
      <option value="Not Accepted">Not Accepted</option>
    </select>

    <label>Selectable Options 1 üè∑Ô∏è
      <input
        id="colorLabel"
        type="text"
        placeholder="Example : Color"
        spellcheck="false"
        maxlength="30"
      />
    </label>

    <input
      id="colorOptions"
      type="text"
      placeholder="Example : Black, Cream, Pink...(comma-separated)"
      required
      spellcheck="false"
      maxlength="100"
    />
  </label>

  <label>Selectable Options 2 üè∑Ô∏è
    <input
      id="sizeLabel"
      type="text"
      placeholder="Example : Size"
      spellcheck="false"
      maxlength="30"
    />

    <input
      id="sizeOptions"
      type="text"
      placeholder="Example : S, M, L, XL...(comma-separated)"
      required
      spellcheck="false"
      maxlength="100"
    />
  </label>

  <label>Description
    <textarea
      id="description"
      rows="3"
      placeholder="Describe the product here"
      required
      spellcheck="false"
      maxlength="300"
    ></textarea>
  </label>

  <!-- Payment Method -->
  <label class="payment-method-label">
    <div class="payment-method-row">
      <img
        src="https://i.ibb.co/tC9LHLG/Bella-52.png"
        alt="PayPal"
      />
      <img
        src="https://i.ibb.co/cCtHLKs/Bella-58.png"
        alt="Stripe"
      />
      <img
        src="https://i.ibb.co/m496tmj/Bella-53.png"
        alt="Checkout Page"
      />
      <span>Select Payment Method</span>
    </div>
    <div class="payment-method-select">
      <button type="button" id="paymentMethodBtn">Select Payment Method</button>
      <input type="hidden" id="productPaymentMethod" name="productPaymentMethod" value="paypalEmail" />
    </div>
  </label>

  <div id="productLinkField">
    <label>PayPal Button Link (for this product)
      <textarea
        id="productLink"
        rows="2"
        placeholder="https://www.paypal.com/checkoutnow?token=YOURTOKEN"
        spellcheck="false"
        maxlength="1000"
      ></textarea>
    </label>
  </div>

  <div
    id="productEmbedField"
    style="display:none;"
  >
    <label>PayPal Button Embed Code (for this product)
      <textarea
        id="productEmbed"
        rows="2"
        placeholder="Embed code..."
        spellcheck="false"
        maxlength="2000"
      ></textarea>
    </label>
  </div>

  <div
    id="otherPaymentField"
    style="display:none;"
  >
    <label>Other Payment Button or Checkout Page Link
      <input
        id="otherPaymentLink"
        type="text"
        placeholder="https://example.com/checkout"
        spellcheck="false"
        maxlength="1000"
      />
    </label>
  </div>

  <div
    id="paypalEmailField"
    style="display: none;"
  >
    <label>PayPal Email
      <input
        id="paypalEmailInput"
        type="email"
        placeholder="yourpaypal@email.com"
        spellcheck="false"
        maxlength="200"
      />
    </label>
  </div>

  <button
    type="button"
    onclick="addProduct()"
  >
    Add Product
  </button>

  <label>Buy now button styles</label>
  <div
    id="productButtonStyleContainer"
    class="icon-container"
    style="margin: 10px 0;"
  >
    <!-- Background Color Picker for Buy Now Button -->
    <div
      class="icon-wrapper"
      onclick="document.getElementById('buyNowBgColorPicker').click()"
    >
      <i class="fas fa-paint-brush"></i>
      <input
        type="color"
        id="buyNowBgColorPicker"
        class="color-picker"
        value="#007bff"
        onchange="updateProductBuyNowStyles()"
      />
    </div>

    <!-- Text Color Picker for Buy Now Button -->
    <div
      class="icon-wrapper"
      onclick="document.getElementById('buyNowTextColorPicker').click()"
    >
      <div class="custom-t-icon">T</div>
      <input
        type="color"
        id="buyNowTextColorPicker"
        class="color-picker"
        value="#fff"
        onchange="updateProductBuyNowStyles()"
      />
    </div>

    <!-- Corner Radius Adjuster for Buy Now Button -->
    <div
      class="icon-wrapper"
      id="cornerPickerWrapper"
    >
      <i class="fas fa-sliders-h"></i>
    </div>
  </div>

  <div id="addedProductsList"></div>
</form>



<!-- Add Reviews -->
<form id="addReviewForm">
    <h2 class="section-title">Reviews Section (max 3)</h2>
  <label>Reviewer Name
    <input
      id="reviewerName"
      type="text"
      placeholder="John Doe"
      required
      spellcheck="false"
      maxlength="60"
    >
  </label>
  <label>Stars (1‚Äì5)
    <select id="reviewStars" required>
      <option value="1">1 star</option>
      <option value="2">2 stars</option>
      <option value="3" selected>3 stars</option>
      <option value="4">4 stars</option>
      <option value="5">5 stars</option>
    </select>
  </label>
  <label>Review Text
    <textarea
      id="reviewText"
      rows="2"
      placeholder="What do you think?"
      required
      spellcheck="false"
      maxlength="300"
    ></textarea>
  </label>
  <button
    type="button"
    onclick="addReview()"
  >
    Add Review
  </button>
  <div id="addedReviewsList"></div>
</form>
      <!-- About Us -->
<form id="aboutForm">
  <h2 class="section-title">About Us Section</h2>

  <label>About Title
    <input
      id="aboutTitle"
      type="text"
      placeholder="Who We Are"
      required
      spellcheck="false"
      maxlength="60"
    />
  </label>

  <label>About Paragraph
    <textarea
      id="aboutParagraph"
      rows="3"
      placeholder="Our story..."
      required
      spellcheck="false"
      maxlength="500"
    ></textarea>
  </label>

  <label>Upload About Us Image</label>
  <div class="input-row">
    <!-- Hidden input instead of text -->
    <input
      id="aboutImage"
      type="hidden"
      value=""
      required
      spellcheck="false"
      maxlength="300"
    />
    <button
      type="button"
      class="upload-btn"
      id="uploadAboutImgBtn"
      title="Upload About Image"
      onclick="openUploadModal('uploadAboutImgBtn')"
    >
      <i class="fas fa-cloud-upload-alt"></i>
    </button>
  </div>

  <label>About Section Colors</label>
  <div id="aboutColorsContainer" class="icon-container">
    <!-- Background Color Picker Button -->
    <div
      class="icon-wrapper"
      onclick="document.getElementById('aboutBgColorPicker').click()"
    >
      <i class="fas fa-paint-brush"></i>
      <input
        type="color"
        id="aboutBgColorPicker"
        class="color-picker"
        value="#ffffff"
        onchange="updateAboutColors()"
      />
    </div>
    <!-- Text Color Picker Button -->
    <div
      class="icon-wrapper"
      onclick="document.getElementById('aboutTextColorPicker').click()"
    >
      <div class="custom-t-icon">T</div>
      <input
        type="color"
        id="aboutTextColorPicker"
        class="color-picker"
        value="#333333"
        onchange="updateAboutColors()"
      />
    </div>
  </div>
</form>



      <!-- Contact Us -->
      <form id="contactUsForm">
        <h2 class="section-title">Contact Us</h2>
        <label>Custom Contact Intro
          <textarea id="contactIntro" rows="3" placeholder="We‚Äôd love to hear from you! Reach out..." required spellcheck="false" maxlength="250"></textarea>
        </label>
        <label><img src="https://i.ibb.co/N2yTY0Cj/Bella-73.png" alt="Instagram">Instagram Link
          <input id="contactInstagram" type="text" placeholder="https://instagram.com/..." required spellcheck="false" maxlength="300">
        </label>
        <label><img src="https://i.ibb.co/2vSmtt0/Bella-49.png" alt="TikTok">TikTok Link
          <input id="contactTiktok" type="text" placeholder="https://tiktok.com/@..." required spellcheck="false" maxlength="300">
        </label>
        <label><img src="https://i.ibb.co/gmDjkH3/Bella-48.png" alt="Facebook">Facebook Link
          <input id="contactFacebook" type="text" placeholder="https://facebook.com/..." required spellcheck="false" maxlength="300">
        </label>
        <label><img src="https://i.ibb.co/fqp0KrB/Bella-63.png" alt="X">X Link
          <input id="contactX" type="text" placeholder="https://x.com/username" required spellcheck="false" maxlength="300">
        </label>
        <label><img src="https://i.ibb.co/hC6CQzs/Bella-62.png" alt="Youtube">Youtube Link
          <input id="contactYoutube" type="text" placeholder="https://youtube.com/@channel" required spellcheck="false" maxlength="300">
        </label>
        <label><img src="https://i.ibb.co/zP00K3P/Bella-51.png" alt="Email">Email Address
          <input id="contactEmail" type="text" placeholder="info@example.com" required spellcheck="false" maxlength="300">
        </label>
        <div class="add-contact-form-row">
        </div>
        <button type="button" id="addContactFormButton">Add Contact Form</button>
        <div id="contactFormStatus" style="margin-top: 10px;"></div>
      </form>
      <!-- Payment Section: Get Your Website -->
<div class="payment-card">
  <section id="paymentSection" class="payment-section">
    <h2 class="section-title">Download your website</h2>
    <video
      autoplay
      loop
      muted
      playsinline
      style="border-radius: 15px; width: 300px; height: 300px; overflow: hidden;"
    >
      <source 
        src="https://raw.githubusercontent.com/fitnesscreator/builder/main/Videos/Boss%20in%20Pajamas.mp4"
        type="video/mp4"
      >
      Sorry, your browser doesn‚Äôt support embedded videos.
    </video>
    <p>
  üíæ <strong>What happens after payment?</strong><br>
  - You will get a <strong>ZIP file</strong> containing your website (<code>index.html</code>).<br>
  - Download it immediately after payment.<br><br>
  üì§ <strong>How to publish your website?</strong><br>
  - Extract the folder from the ZIP file.<br>
  - Drag and drop the folder to <strong><a href="https://www.netlify.com/" target="_blank" data-ignore-exit-confirm>Netlify.com</a></strong> for easy & Free website publishing.<br><br>
  üì∫ <strong><a href="https://www.youtube.com/watch?v=j2E6Now1Qec" target="_blank" data-ignore-exit-confirm>Watch how to Publish your website for Free</a></strong><br><br>
  <strong>The payment button will be available once you finish creating your website.</strong>
</p>

    <!-- Pay Button with icon -->
    <button id="payBtn" class="payment-btn" disabled>
      <img id="paypalIcon" src="https://i.ibb.co/PsWwm11F/2ea99dfb-27c1-43a9-84ba-acb7533f7784.png" alt="PayPal Icon">
      <span id="payBtnText">Pay ‚Ç¨12</span>
    </button>
    <!-- Email Verification Row (hidden by default) -->
    <div id="emailVerificationRow">
      <input type="email" id="verificationEmail" placeholder="Enter your Paypal email to verify payment">
      <button id="verifyEmailBtn">Verify</button>
    </div>
    <!-- Download & Show Code buttons (hidden initially) -->
    <div class="download-row" id="downloadRow" style="display: none;">
      <button id="downloadBtn" onclick="downloadSite()" class="unlock-button">Download Website Folder</button>
    </div>
  </section>
</div>
    </div>
    <!-- Preview section on the right -->
<div class="preview-section">
  <h2 id="livePreviewTitle" class="section-title">
  Live Preview of your Website 
  <button id="refreshBtn">Refresh</button>
</h2>
  <iframe id="previewFrame"></iframe>
</div>
</div>
  
  <!-- Contact Form Modal -->
<div id="contactFormModal" class="modal">
  <div class="modal-content">
    <span class="modal-close-contact" id="closeContactFormModal">&times;</span>
    <h2>Create Your Contact Form</h2>
    <p style="font-weight:bold">
      Step 1: Create your contact form in one of these companies:
      <button type="button" class="contact-btn jotform-btn" onclick="window.open('https://www.jotform.com', '_blank')">Jotform</button>
      <button type="button" class="contact-btn googleforms-btn" onclick="window.open('https://embedsocial.com/', '_blank')">EmbedSocial</button>
    </p>
    <p>
      Note: Google Forms doesnt work well here, unfortunately
    </p>
    <p style="font-weight:bold">
      Step 2: Paste the embed HTML code of your form here:
    </p>
    <textarea id="contactFormIframe" rows="5" placeholder="Paste your contact form iframe HTML code here..."></textarea>
    <button type="button" id="confirmAddContactFormButton">Add</button>
  </div>
</div>

  
  <!-- Code Modal for Copying Website Code -->
  <div id="codeModal" class="modal">
    <div class="modal-content">
      <span class="modal-close" id="closeCodeModal">&times;</span>
      <h2>Website Code</h2>
      <textarea id="codeOutput" rows="10" readonly></textarea>
      <button id="copyCodeButton">Copy Code</button>
    </div>
  </div>
  
  <!-- Custom Exit Confirmation Modal -->
  <div id="exitConfirm-modalOverlay" class="modal-overlay">
    <div id="exitConfirm-modal" class="modal">
      <p>To download your website, please complete your purchase. If you refresh this page, your progress will be lost. Make sure to download your website now to keep your work safe.</p>
      <div class="modal-buttons">
        <button id="exitConfirm-stayButton" class="btn-ok">Oky</button>
        <button id="exitConfirm-leaveButton" class="btn-cancel">I'm sure I want to leave</button>
      </div>
    </div>
  </div>
  
  <!-- Border Radius Modal -->
<div id="borderRadiusModal" class="modal" style="display:none; justify-content: center; align-items: center;">
  <div class="modal-content" style="max-width:300px; text-align: center;">
    <h3>Adjust Rounded Corners</h3>
    <!-- Border preview box with "Buy Now" text -->
    <div id="borderPreview" style="margin: 20px auto; width: 100px; height: 50px; border: 1px solid #ccc; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #333;">
      Buy Now
    </div>
    <!-- Slider to adjust border radius -->
    <input type="range" id="borderRadiusSlider" min="0" max="30" value="4" style="width: 80%;">
    <br><br>
    <!-- Save button -->
    <button id="saveBorderRadiusBtn" style="background: #388eff;padding: 8px 16px;">Save</button>
  </div>
</div>

  <!-- NEW: Upload Modal -->
<div id="uploadModal" class="modal">
  <div class="modal-content">
    <span class="modal-close" id="uploadModalClose">&times;</span>
    <h2>Upload Photo</h2>
    <div id="uploadDropArea" onclick="document.getElementById('uploadFileInput').click();">
      <i class="fas fa-cloud-upload-alt"></i>
      <p>Drag &amp; Drop your photo here</p>
    </div>
    <input type="file" id="uploadFileInput" accept="image/*" />
    <button id="browseButton" onclick="document.getElementById('uploadFileInput').click();">Browse Files</button>
  </div>
</div>

  
 <!-- Payment Method Modal -->
<div id="paymentMethodModal" class="modal">
  <div class="modal-content">
    <span class="modal-close" id="closePaymentMethodModal">&times;</span>
    <h2>Select Payment Method</h2>
    <ul class="payment-options">
      <li data-value="paypalEmail" data-label="PayPal Email">
        <h3>
          <img src="https://i.ibb.co/67p1dsJm/paypal-icon-logo-png-transparent.png" alt="PayPal Icon">
          PayPal Email
        </h3>
        <p>
          Uses your PayPal email to automatically create a checkout.
          <strong>Note:</strong> With PayPal Email, you lose control over stock and sales will keep coming even if you Sold Out.
        </p>
        <small>Product Options: Selectable ‚Äì Customers can choose options like size, color, etc.</small>
      </li>
      <li data-value="paypalEmbed" data-label="PayPal Button Embed Code">
        <h3>
          <img src="https://i.ibb.co/67p1dsJm/paypal-icon-logo-png-transparent.png" alt="PayPal Icon">
          PayPal Button Embed Code
        </h3>
        <p>
          Embeds a PayPal button directly on your site.
          <strong>Create this button in your PayPal account, set a Stock Limit for each product, Add Product Options, and copy its embed code to paste it Here.</strong>
        </p>
        <small>Product Options: Selectable ‚Äì Customers can choose options like size, color, etc.</small>
      </li>
      <li data-value="paypalLink" data-label="PayPal Button Link">
        <h3>
          <img src="https://i.ibb.co/67p1dsJm/paypal-icon-logo-png-transparent.png" alt="PayPal Icon">
          PayPal Button Link
        </h3>
        <p>
          Provides a direct URL to a PayPal checkout.
          <strong>Create this button in your PayPal account and paste its link here.</strong>
        </p>
        <small>Product Options: Not Selectable ‚Äì Options are shown but cannot be selected.</small>
      </li>
      <li data-value="other" data-label="Other Payment Button Link">
        <h3>
          <img src="https://i.ibb.co/cCtHLKs/Bella-58.png" alt="Stripe Icon">
          <img src="https://i.ibb.co/V3gG6tw/Bella-56.png" alt="Sumup Icon">
          <img src="https://i.ibb.co/QJY6Cp7/Bella-57.png" alt="Square Icon">
          <img src="https://i.ibb.co/m496tmj/Bella-53.png" alt="Checkout Icon">
          Other Payment Button Link
        </h3>
        <p>
          Uses a payment button from another platform (like Stripe, Square, etc.).
          <strong>Create the button on that platform and paste its link here.</strong>
        </p>
        <small>Product Options: Not Selectable ‚Äì Options are shown but cannot be selected.</small>
      </li>
    </ul>
  </div>
</div>






  
  <!-- Popup Message -->
  <div id="popupMessage" class="popup-message">
    <span class="close">&times;</span>
    <p>
      Hi üòä, This website does not save your progress, so make sure not to refresh or leave this website before downloading the website you created. Thank you!
    </p>
  </div>

  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "pyh4snlwpe");
</script>
  
  <script>
    
    // A global counter to ensure uniqueness
var uniqueCounter = 0;

// Your original function that ‚Äúcleans‚Äù the filename:
function generateSafeFileName(name) {
  return name
    .toLowerCase()
    .trim()
    .replace(/\s+/g, '-')        // Replace spaces with dashes
    .replace(/[^a-z0-9.-]/g, ''); // Remove any unsafe characters
}

// New helper to get a unique filename:
function generateUniqueSafeFileName(name) {
  uniqueCounter++;
  
  // 1. Find the file extension
  let dotIndex = name.lastIndexOf(".");
  let extension = "";
  let baseName = name;
  
  if (dotIndex !== -1) {
    // extension includes the dot, e.g. ".png"
    extension = name.substring(dotIndex).toLowerCase();
    // everything before that dot
    baseName = name.substring(0, dotIndex);
  }
  
  // 2. Clean up the base name (remove unsafe chars/spaces)
  let safeBase = generateSafeFileName(baseName); // your existing ‚Äúcleaner‚Äù function
  
  // 3. Return something like ‚Äúbella-2025-02-14-1.png‚Äù
  return safeBase + "-" + uniqueCounter + extension;
}



    
    
  // Global variables to remember selections
  var defaultCurrency = '';
  var defaultCurrencyCode = '';  // to store the currency‚Äôs data-code
  var defaultPaymentMethod = '';
  var defaultPaypalEmail = "";
  var downloadCount = 0;
  var aboutData = { title:'', paragraph:'', image:'', bgColor: '#ffffff', textColor: '#333333' };
  var productBuyNowBgColor = "#007bff"; // default background color for Buy Now button
  var productBuyNowTextColor = "#fff";  // default text color for Buy Now button
  var productBuyNowBorderRadius = 4;    // default border radius (in pixels)
  var heroData = { 
  logo: '', 
  banner: '', 
  heroText: '', 
  ctaText: '', 
  heroTitleColor: '#000000',  // default hero title color (black)
  ctaBgColor: '#007bff',        // default CTA button background color
  ctaTextColor: '#ffffff'       // default CTA button text color
};
    var heroTitleFont = "Roboto"; // default font (keep the current hero title font as default)
  // ============== CURRENCY DATA ==============
    const currencyData = [
      { code: "AED", name: "United Arab Emirates Dirham", symbol: "ÿØ.ÿ•", flag: "üá¶üá™" },
      { code: "AFN", name: "Afghan Afghani", symbol: "ÿã", flag: "üá¶üá´" },
      { code: "ALL", name: "Albanian Lek", symbol: "L", flag: "üá¶üá±" },
      { code: "AMD", name: "Armenian Dram", symbol: "÷è", flag: "üá¶üá≤" },
      { code: "ANG", name: "Netherlands Antillean Guilder", symbol: "∆í", flag: "üá≥üá±" },
      { code: "AOA", name: "Angolan Kwanza", symbol: "Kz", flag: "üá¶üá¥" },
      { code: "ARS", name: "Argentine Peso", symbol: "$", flag: "üá¶üá∑" },
      { code: "AUD", name: "Australian Dollar", symbol: "A$", flag: "üá¶üá∫" },
      { code: "AWG", name: "Aruban Florin", symbol: "∆í", flag: "üá¶üáº" },
      { code: "AZN", name: "Azerbaijani Manat", symbol: "‚Çº", flag: "üá¶üáø" },
      { code: "BAM", name: "Bosnia-Herzegovina Convertible Mark", symbol: "KM", flag: "üáßüá¶" },
      { code: "BBD", name: "Barbadian Dollar", symbol: "Bds$", flag: "üáßüáß" },
      { code: "BDT", name: "Bangladeshi Taka", symbol: "‡ß≥", flag: "üáßüá©" },
      { code: "BGN", name: "Bulgarian Lev", symbol: "–ª–≤", flag: "üáßüá¨" },
      { code: "BHD", name: "Bahraini Dinar", symbol: "ÿØ.ÿ®", flag: "üáßüá≠" },
      { code: "BIF", name: "Burundian Franc", symbol: "FBu", flag: "üáßüáÆ" },
      { code: "BMD", name: "Bermudan Dollar", symbol: "$", flag: "üáßüá≤" },
      { code: "BND", name: "Brunei Dollar", symbol: "B$", flag: "üáßüá≥" },
      { code: "BOB", name: "Bolivian Boliviano", symbol: "$b", flag: "üáßüá¥" },
      { code: "BRL", name: "Brazilian Real", symbol: "R$", flag: "üáßüá∑" },
      { code: "BSD", name: "Bahamian Dollar", symbol: "$", flag: "üáßüá∏" },
      { code: "BTN", name: "Bhutanese Ngultrum", symbol: "Nu.", flag: "üáßüáπ" },
      { code: "BWP", name: "Botswanan Pula", symbol: "P", flag: "üáßüáº" },
      { code: "BYN", name: "Belarusian Ruble", symbol: "Br", flag: "üáßüáæ" },
      { code: "BZD", name: "Belize Dollar", symbol: "BZ$", flag: "üáßüáø" },
      { code: "CAD", name: "Canadian Dollar", symbol: "C$", flag: "üá®üá¶" },
      { code: "CDF", name: "Congolese Franc", symbol: "FC", flag: "üá®üá©" },
      { code: "CHF", name: "Swiss Franc", symbol: "CHF", flag: "üá®üá≠" },
      { code: "CLP", name: "Chilean Peso", symbol: "$", flag: "üá®üá±" },
      { code: "CNY", name: "Chinese Yuan", symbol: "¬•", flag: "üá®üá≥" },
      { code: "COP", name: "Colombian Peso", symbol: "$", flag: "üá®üá¥" },
      { code: "CRC", name: "Costa Rican Col√≥n", symbol: "‚Ç°", flag: "üá®üá∑" },
      { code: "CUC", name: "Cuban Convertible Peso", symbol: "$", flag: "üá®üá∫" },
      { code: "CUP", name: "Cuban Peso", symbol: "$", flag: "üá®üá∫" },
      { code: "CVE", name: "Cape Verdean Escudo", symbol: "$", flag: "üá®üáª" },
      { code: "CZK", name: "Czech Koruna", symbol: "Kƒç", flag: "üá®üáø" },
      { code: "DJF", name: "Djiboutian Franc", symbol: "Fdj", flag: "üá©üáØ" },
      { code: "DKK", name: "Danish Krone", symbol: "kr", flag: "üá©üá∞" },
      { code: "DOP", name: "Dominican Peso", symbol: "RD$", flag: "üá©üá¥" },
      { code: "DZD", name: "Algerian Dinar", symbol: "ÿØ.ÿ¨", flag: "üá©üáø" },
      { code: "EGP", name: "Egyptian Pound", symbol: "¬£", flag: "üá™üá¨" },
      { code: "ERN", name: "Eritrean Nakfa", symbol: "Nfk", flag: "üá™üá∑" },
      { code: "ETB", name: "Ethiopian Birr", symbol: "Br", flag: "üá™üáπ" },
      { code: "EUR", name: "Euro", symbol: "‚Ç¨", flag: "üá™üá∫" },
      { code: "FJD", name: "Fijian Dollar", symbol: "FJ$", flag: "üá´üáØ" },
      { code: "FKP", name: "Falkland Islands Pound", symbol: "¬£", flag: "üá´üá∞" },
      { code: "FOK", name: "Faroese Kr√≥na", symbol: "kr", flag: "üá´üá¥" },
      { code: "GBP", name: "British Pound Sterling", symbol: "¬£", flag: "üá¨üáß" },
      { code: "GEL", name: "Georgian Lari", symbol: "‚Çæ", flag: "üá¨üá™" },
      { code: "GGP", name: "Guernsey Pound", symbol: "¬£", flag: "üá¨üá¨" },
      { code: "GHS", name: "Ghanaian Cedi", symbol: "‚Çµ", flag: "üá¨üá≠" },
      { code: "GIP", name: "Gibraltar Pound", symbol: "¬£", flag: "üá¨üáÆ" },
      { code: "GMD", name: "Gambian Dalasi", symbol: "D", flag: "üá¨üá≤" },
      { code: "GNF", name: "Guinean Franc", symbol: "FG", flag: "üá¨üá≥" },
      { code: "GTQ", name: "Guatemalan Quetzal", symbol: "Q", flag: "üá¨üáπ" },
      { code: "GYD", name: "Guyanese Dollar", symbol: "G$", flag: "üá¨üáæ" },
      { code: "HKD", name: "Hong Kong Dollar", symbol: "HK$", flag: "üá≠üá∞" },
      { code: "HNL", name: "Honduran Lempira", symbol: "L", flag: "üá≠üá≥" },
      { code: "HRK", name: "Croatian Kuna", symbol: "kn", flag: "üá≠üá∑" },
      { code: "HTG", name: "Haitian Gourde", symbol: "G", flag: "üá≠üáπ" },
      { code: "HUF", name: "Hungarian Forint", symbol: "Ft", flag: "üá≠üá∫" },
      { code: "IDR", name: "Indonesian Rupiah", symbol: "Rp", flag: "üáÆüá©" },
      { code: "ILS", name: "Israeli New Shekel", symbol: "‚Ç™", flag: "üáÆüá±" },
      { code: "IMP", name: "Isle of Man Pound", symbol: "¬£", flag: "üáÆüá≤" },
      { code: "INR", name: "Indian Rupee", symbol: "‚Çπ", flag: "üáÆüá≥" },
      { code: "IQD", name: "Iraqi Dinar", symbol: "ÿπ.ÿØ", flag: "üáÆüá∂" },
      { code: "IRR", name: "Iranian Rial", symbol: "Ô∑º", flag: "üáÆüá∑" },
      { code: "ISK", name: "Icelandic Kr√≥na", symbol: "kr", flag: "üáÆüá∏" },
      { code: "JEP", name: "Jersey Pound", symbol: "¬£", flag: "üáØüá™" },
      { code: "JMD", name: "Jamaican Dollar", symbol: "J$", flag: "üáØüá≤" },
      { code: "JOD", name: "Jordanian Dinar", symbol: "ÿØ.ÿß", flag: "üáØüá¥" },
      { code: "JPY", name: "Japanese Yen", symbol: "¬•", flag: "üáØüáµ" },
      { code: "KES", name: "Kenyan Shilling", symbol: "KSh", flag: "üá∞üá™" },
      { code: "KGS", name: "Kyrgyzstani Som", symbol: "—Å–æ–º", flag: "üá∞üá¨" },
      { code: "KHR", name: "Cambodian Riel", symbol: "·üõ", flag: "üá∞üá≠" },
      { code: "KMF", name: "Comorian Franc", symbol: "CF", flag: "üá∞üá≤" },
      { code: "KPW", name: "North Korean Won", symbol: "‚Ç©", flag: "üá∞üáµ" },
      { code: "KRW", name: "South Korean Won", symbol: "‚Ç©", flag: "üá∞üá∑" },
      { code: "KWD", name: "Kuwaiti Dinar", symbol: "ÿØ.ŸÉ", flag: "üá∞üáº" },
      { code: "KYD", name: "Cayman Islands Dollar", symbol: "KYD", flag: "üá∞üáæ" },
      { code: "KZT", name: "Kazakhstani Tenge", symbol: "‚Ç∏", flag: "üá∞üáø" },
      { code: "LAK", name: "Laotian Kip", symbol: "‚Ç≠", flag: "üá±üá¶" },
      { code: "LBP", name: "Lebanese Pound", symbol: "¬£", flag: "üá±üáß" },
      { code: "LKR", name: "Sri Lankan Rupee", symbol: "Rs", flag: "üá±üá∞" },
      { code: "LRD", name: "Liberian Dollar", symbol: "L$", flag: "üá±üá∑" },
      { code: "LSL", name: "Lesotho Loti", symbol: "L", flag: "üá±üá∏" },
      { code: "LYD", name: "Libyan Dinar", symbol: "ŸÑ.ÿØ", flag: "üá±üáæ" },
      { code: "MAD", name: "Moroccan Dirham", symbol: "ÿØ.ŸÖ.", flag: "üá≤üá¶" },
      { code: "MDL", name: "Moldovan Leu", symbol: "L", flag: "üá≤üá©" },
      { code: "MGA", name: "Malagasy Ariary", symbol: "Ar", flag: "üá≤üá¨" },
      { code: "MKD", name: "Macedonian Denar", symbol: "–¥–µ–Ω", flag: "üá≤üá∞" },
      { code: "MMK", name: "Myanmar Kyat", symbol: "K", flag: "üá≤üá≤" },
      { code: "MNT", name: "Mongolian Tugrik", symbol: "‚ÇÆ", flag: "üá≤üá≥" },
      { code: "MOP", name: "Macanese Pataca", symbol: "MOP$", flag: "üá≤üá¥" },
      { code: "MRU", name: "Mauritanian Ouguiya", symbol: "UM", flag: "üá≤üá∑" },
      { code: "MUR", name: "Mauritian Rupee", symbol: "‚Ç®", flag: "üá≤üá∫" },
      { code: "MVR", name: "Maldivian Rufiyaa", symbol: "Rf", flag: "üá≤üáª" },
      { code: "MWK", name: "Malawian Kwacha", symbol: "MK", flag: "üá≤üáº" },
      { code: "MXN", name: "Mexican Peso", symbol: "$", flag: "üá≤üáΩ" },
      { code: "MYR", name: "Malaysian Ringgit", symbol: "RM", flag: "üá≤üáæ" },
      { code: "MZN", name: "Mozambican Metical", symbol: "MT", flag: "üá≤üáø" },
      { code: "NAD", name: "Namibian Dollar", symbol: "N$", flag: "üá≥üá¶" },
      { code: "NGN", name: "Nigerian Naira", symbol: "‚Ç¶", flag: "üá≥üá¨" },
      { code: "NIO", name: "Nicaraguan C√≥rdoba", symbol: "C$", flag: "üá≥üáÆ" },
      { code: "NOK", name: "Norwegian Krone", symbol: "kr", flag: "üá≥üá¥" },
      { code: "NPR", name: "Nepalese Rupee", symbol: "‚Ç®", flag: "üá≥üáµ" },
      { code: "NZD", name: "New Zealand Dollar", symbol: "NZ$", flag: "üá≥üáø" },
      { code: "OMR", name: "Omani Rial", symbol: "ÿ±.ÿπ.", flag: "üá¥üá≤" },
      { code: "PAB", name: "Panamanian Balboa", symbol: "B/.", flag: "üáµüá¶" },
      { code: "PEN", name: "Peruvian Nuevo Sol", symbol: "S/.", flag: "üáµüá™" },
      { code: "PGK", name: "Papua New Guinean Kina", symbol: "K", flag: "üáµüá¨" },
      { code: "PHP", name: "Philippine Peso", symbol: "‚Ç±", flag: "üáµüá≠" },
      { code: "PKR", name: "Pakistani Rupee", symbol: "‚Ç®", flag: "üáµüá∞" },
      { code: "PLN", name: "Polish Z≈Çoty", symbol: "z≈Ç", flag: "üáµüá±" },
      { code: "PYG", name: "Paraguayan Guaran√≠", symbol: "‚Ç≤", flag: "üáµüáæ" },
      { code: "QAR", name: "Qatari Rial", symbol: "ÿ±.ŸÇ", flag: "üá∂üá¶" },
      { code: "RON", name: "Romanian Leu", symbol: "lei", flag: "üá∑üá¥" },
      { code: "RSD", name: "Serbian Dinar", symbol: "din", flag: "üá∑üá∏" },
      { code: "RUB", name: "Russian Ruble", symbol: "‚ÇΩ", flag: "üá∑üá∫" },
      { code: "RWF", name: "Rwandan Franc", symbol: "FRw", flag: "üá∑üáº" },
      { code: "SAR", name: "Saudi Riyal", symbol: "ÿ±.ÿ≥", flag: "üá∏üá¶" },
      { code: "SBD", name: "Solomon Islands Dollar", symbol: "SI$", flag: "üá∏üáß" },
      { code: "SCR", name: "Seychellois Rupee", symbol: "‚Ç®", flag: "üá∏üá®" },
      { code: "SDG", name: "Sudanese Pound", symbol: "¬£", flag: "üá∏üá©" },
      { code: "SEK", name: "Swedish Krona", symbol: "kr", flag: "üá∏üá™" },
      { code: "SGD", name: "Singapore Dollar", symbol: "S$", flag: "üá∏üá¨" },
      { code: "SHP", name: "Saint Helena Pound", symbol: "¬£", flag: "üá∏üá≠" },
      { code: "SLL", name: "Sierra Leonean Leone", symbol: "Le", flag: "üá∏üá±" },
      { code: "SOS", name: "Somali Shilling", symbol: "S", flag: "üá∏üá¥" },
      { code: "SRD", name: "Surinamese Dollar", symbol: "$", flag: "üá∏üá∑" },
      { code: "SSP", name: "South Sudanese Pound", symbol: "¬£", flag: "üá∏üá∏" },
      { code: "STD", name: "S√£o Tom√© and Pr√≠ncipe Dobra", symbol: "Db", flag: "üá∏üáπ" },
      { code: "STN", name: "S√£o Tom√© and Pr√≠ncipe Dobra", symbol: "Db", flag: "üá∏üáπ" },
      { code: "SVC", name: "Salvadoran Col√≥n", symbol: "$", flag: "üá∏üáª" },
      { code: "SYP", name: "Syrian Pound", symbol: "¬£", flag: "üá∏üáæ" },
      { code: "SZL", name: "Swazi Lilangeni", symbol: "E", flag: "üá∏üáø" },
      { code: "THB", name: "Thai Baht", symbol: "‡∏ø", flag: "üáπüá≠" },
      { code: "TJS", name: "Tajikistani Somoni", symbol: "–Ö–ú", flag: "üáπüáØ" },
      { code: "TMT", name: "Turkmenistani Manat", symbol: "m", flag: "üáπüá≤" },
      { code: "TND", name: "Tunisian Dinar", symbol: "ÿØ.ÿ™", flag: "üáπüá≥" },
      { code: "TOP", name: "Tongan Pa ªanga", symbol: "T$", flag: "üáπüá¥" },
      { code: "TRY", name: "Turkish Lira", symbol: "‚Ç∫", flag: "üáπüá∑" },
      { code: "TTD", name: "Trinidad and Tobago Dollar", symbol: "TT$", flag: "üáπüáπ" },
      { code: "TWD", name: "New Taiwan Dollar", symbol: "NT$", flag: "üáπüáº" },
      { code: "TZS", name: "Tanzanian Shilling", symbol: "TSh", flag: "üáπüáø" },
      { code: "UAH", name: "Ukrainian Hryvnia", symbol: "‚Ç¥", flag: "üá∫üá¶" },
      { code: "UGX", name: "Ugandan Shilling", symbol: "USh", flag: "üá∫üá¨" },
      { code: "USD", name: "United States Dollar", symbol: "$", flag: "üá∫üá∏" },
      { code: "UYU", name: "Uruguayan Peso", symbol: "$U", flag: "üá∫üáæ" },
      { code: "UZS", name: "Uzbekistan Som", symbol: "UZS", flag: "üá∫üáø" },
      { code: "VES", name: "Venezuelan Bol√≠var Soberano", symbol: "Bs.S", flag: "üáªüá™" },
      { code: "VND", name: "Vietnamese Dong", symbol: "‚Ç´", flag: "üáªüá≥" },
      { code: "VUV", name: "Vanuatu Vatu", symbol: "VT", flag: "üáªüá∫" },
      { code: "WST", name: "Samoan Tala", symbol: "WS$", flag: "üáºüá∏" },
      { code: "XAF", name: "CFA Franc BEAC", symbol: "FCFA", flag: "üá®üá´" },
      { code: "XCD", name: "East Caribbean Dollar", symbol: "EC$", flag: "üá®üá©" },
      { code: "XDR", name: "Special Drawing Rights", symbol: "XDR", flag: "üá∫üá≥" },
      { code: "XOF", name: "CFA Franc BCEAO", symbol: "CFA", flag: "üá®üáÆ" },
      { code: "XPF", name: "CFP Franc", symbol: "CFPF", flag: "üáµüá´" },
      { code: "YER", name: "Yemeni Rial", symbol: "Ô∑º", flag: "üáæüá™" },
      { code: "ZAR", name: "South African Rand", symbol: "R", flag: "üáøüá¶" },
      { code: "ZMW", name: "Zambian Kwacha", symbol: "ZK", flag: "üáøüá≤" },
      { code: "ZWL", name: "Zimbabwean Dollar", symbol: "Z$", flag: "üáøüáº" }
    ];

  // ============== DATA STRUCTURES ==============
  var heroData    = { logo:'', banner:'', heroText:'', ctaText:'' };
  var products    = [];
  var reviews     = [];
  var aboutData   = { title:'', paragraph:'', image:'' };
  var contactData = {
    intro:'', 
    instagram:'', 
    tiktok:'', 
    facebook:'', 
    xLink:'', 
    youtube:'', 
    email:'', 
    formEmbed:'',
    googleAnalytics: ''
  };
  var finalHTML = '';

  // ============== Mandatory Fields Check ==============
  function checkMandatory() {
  // For the Logo: require either a URL or an uploaded image
  if (
    document.getElementById('logo').value.trim() === "" &&
    !uploadedImages['uploadLogoBtn']
  ) return false;

  // For the Banner: require either a URL or an uploaded image
  if (
    document.getElementById('banner').value.trim() === "" &&
    !uploadedImages['uploadBannerBtn']
  ) return false;

  // Other mandatory fields:
  if (document.getElementById('heroText').value.trim() === "") return false;
  if (document.getElementById('ctaText').value.trim() === "") return false;
  if (products.length < 1) return false;
  if (reviews.length < 1) return false;
  if (document.getElementById('aboutTitle').value.trim() === "") return false;
  if (document.getElementById('aboutParagraph').value.trim() === "") return false;
  // About Image remains as it is (not mandatory)
  if (document.getElementById('contactEmail').value.trim() === "") return false;

  return true;
}
    

// Ensure these are defined before any HTML uses them
window.currentUploadField = null;
window.uploadedImages = {};
window.backupImages = {};

window.openUploadModal = function(fieldId) {
  console.log("openUploadModal called for " + fieldId);
  // Your code to open the upload modal goes here.
  document.getElementById('uploadModal').style.display = 'flex';
  window.currentUploadField = fieldId;
};
    
    // Add this helper to get the final image URL (for the downloaded website)
function getFinalImageURL(fieldId, currentURL) {
  if (window.uploadedFiles && window.uploadedFiles[fieldId]) {
    return "Images/" + window.uploadedFiles[fieldId].name;
  }
  return currentURL;
}




  // ============== ON LOAD ==============
  window.onload = function() {
    // Real-time preview watchers
    document.getElementById('logo').oninput     = updatePreview;
    document.getElementById('banner').oninput   = updatePreview;
    document.getElementById('heroText').oninput = updatePreview;
    document.getElementById('ctaText').oninput  = updatePreview;

    document.getElementById('aboutTitle').oninput     = updatePreview;
    document.getElementById('aboutParagraph').oninput = updatePreview;
    document.getElementById('aboutImage').oninput     = updatePreview;

    document.getElementById('contactIntro').oninput     = updatePreview;
    document.getElementById('contactInstagram').oninput = updatePreview;
    document.getElementById('contactTiktok').oninput    = updatePreview;
    document.getElementById('contactFacebook').oninput  = updatePreview;
    document.getElementById('contactX').oninput         = updatePreview;
    document.getElementById('contactYoutube').oninput   = updatePreview;
    document.getElementById('contactEmail').oninput     = updatePreview;

    // Payment method event
    document.getElementById('productPaymentMethod').onchange = function(){
      var method = this.value;
      document.getElementById('productLinkField').style.display   = (method === 'paypalLink')  ? 'block' : 'none';
      document.getElementById('productEmbedField').style.display  = (method === 'paypalEmbed') ? 'block' : 'none';
      document.getElementById('otherPaymentField').style.display  = (method === 'other')       ? 'block' : 'none';
      document.getElementById('paypalEmailField').style.display   = (method === 'paypalEmail') ? 'block' : 'none';

      // Hide color/size if embed
      var colorInput = document.getElementById('colorOptions').parentElement;
      var sizeInput  = document.getElementById('sizeOptions').parentElement;
      if (method === 'paypalEmbed') {
        colorInput.style.display = 'none';
        sizeInput.style.display  = 'none';
      } else {
        colorInput.style.display = 'block';
        sizeInput.style.display  = 'block';
      }
      updatePreview();
    };

    // Additional watchers
    document.getElementById('productLink').oninput      = updatePreview;
    document.getElementById('productEmbed').oninput     = updatePreview;
    document.getElementById('otherPaymentLink').oninput = updatePreview;
    
    document.getElementById('paypalEmailInput').addEventListener('input', function() {
    defaultPaypalEmail = this.value;
  });

    updateAddProductFormFields();
    setupContactFormModal();
    updateManagementLists();

    // Remember selections when they change
    document.getElementById('productCurrency').addEventListener('change', function() {
      defaultCurrency = this.value;
      defaultCurrencyCode = this.getAttribute('data-code') || '';
    });
    document.getElementById('productPaymentMethod').addEventListener('change', function() {
      defaultPaymentMethod = this.value;
    });

    // Attach event listener to the existing refresh button
    var refreshBtn = document.getElementById('refreshBtn');
    if (refreshBtn) {
      refreshBtn.addEventListener('click', forceRefreshPreview);
    }
  };

  // ============== CURRENCY DROPDOWN INIT ==============
document.addEventListener('DOMContentLoaded', function() {
  const currencyInput  = document.getElementById('productCurrency');
  const currencyList   = document.getElementById('currencyList');
  const currencySearch = document.getElementById('currencySearch');

  // Populate currency data
  currencyData.forEach(currency => {
    const item = document.createElement('div');
    item.classList.add('currency-item');
    item.innerHTML = `
      <span class="currency-flag">${currency.flag}</span>
      <span class="currency-code">${currency.code}</span>
      <span class="currency-name">${currency.name}</span>
    `;
    item.addEventListener('click', (e) => {
  e.stopPropagation();  // Prevent the click from bubbling up
  currencyInput.value = `${currency.code} - ${currency.name}`;
  currencyInput.setAttribute('data-code', currency.code);
  // Update global variables so they persist in addProduct()
  defaultCurrency = currencyInput.value;
  defaultCurrencyCode = currency.code;
  currencyList.classList.remove('visible');
  updatePreview();
});
    currencyList.appendChild(item);
  });

  // Default to EUR
  const defaultCurr = currencyData.find(c => c.code === "EUR");
  if (defaultCurr) {
    currencyInput.value = `${defaultCurr.code} - ${defaultCurr.name}`;
    currencyInput.setAttribute('data-code', defaultCurr.code);
  }

  currencyInput.addEventListener('click', () => {
    currencyList.classList.toggle('visible');
    currencySearch.focus();
  });

  document.addEventListener('click', function(e) {
    if (!currencyInput.contains(e.target) && !currencyList.contains(e.target)) {
      currencyList.classList.remove('visible');
    }
  });

  currencySearch.addEventListener('input', function() {
    const filter = currencySearch.value.toUpperCase();
    const items  = currencyList.getElementsByClassName('currency-item');
    for (let i = 0; i < items.length; i++) {
      const txtValue = items[i].textContent || items[i].innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        items[i].style.display = "";
      } else {
        items[i].style.display = "none";
      }
    }
  });
});

  // ============== FUNCTIONS ==============
  function updateAddProductFormFields() {
    var method = document.getElementById('productPaymentMethod').value;
    document.getElementById('productLinkField').style.display   = (method === 'paypalLink')  ? 'block' : 'none';
    document.getElementById('productEmbedField').style.display  = (method === 'paypalEmbed') ? 'block' : 'none';
    document.getElementById('otherPaymentField').style.display  = (method === 'other')       ? 'block' : 'none';
    document.getElementById('paypalEmailField').style.display   = (method === 'paypalEmail') ? 'block' : 'none';
  }

  var imageCount = 1;
  function addImageField(){
    imageCount++;
    if(imageCount === 2){
      document.getElementById('additionalImage2').style.display = 'block';
    } else if(imageCount === 3){
      document.getElementById('additionalImage3').style.display = 'block';
      document.getElementById('addImagesBtn').style.display = 'none';
    }
  }

  // NEW: Function to force refresh the preview iframe
  function forceRefreshPreview() {
    var iframe = document.getElementById('previewFrame');
    iframe.src = 'about:blank';
    setTimeout(updatePreview, 100);
  }

  function addProduct(){
  // Gather inputs
  var title         = document.getElementById('productTitle').value.trim();
  
  // For image1:
var img1Blob = uploadedImages['uploadImage1Btn'] || document.getElementById('image1').value.trim();
var img1File = (window.uploadedFiles && window.uploadedFiles['uploadImage1Btn']) ? window.uploadedFiles['uploadImage1Btn'] : null;
var img1Final;
if (img1File) {
  img1Final = "Images/" + img1File.safeName;
} else {
  img1Final = img1Blob;
}


// For image2:
var img2Blob = uploadedImages['uploadImage2Btn'] || document.getElementById('image2').value.trim();
var img2File = (window.uploadedFiles && window.uploadedFiles['uploadImage2Btn']) ? window.uploadedFiles['uploadImage2Btn'] : null;
var img2Final;
if (img2File) {
  img2Final = "Images/" + img2File.safeName;
} else {
  img2Final = img2Blob;
}


// For image3:
var img3Blob = uploadedImages['uploadImage3Btn'] || document.getElementById('image3').value.trim();
var img3File = (window.uploadedFiles && window.uploadedFiles['uploadImage3Btn']) ? window.uploadedFiles['uploadImage3Btn'] : null;
var img3Final;
if (img3File) {
  img3Final = "Images/" + img3File.safeName;
} else {
  img3Final = img3Blob;
}



  
  var currencyInput = document.getElementById('productCurrency');
  var currencyCode  = currencyInput.getAttribute('data-code') || 'EUR';
  var sold          = document.getElementById('sold').value.trim();
  var price         = document.getElementById('price').value.trim();
  var shipping      = document.getElementById('shipping').value.trim();
  var returns       = document.getElementById('returns').value;
  var colorLabel    = document.getElementById('colorLabel').value.trim();
  var coloroptions  = document.getElementById('colorOptions').value.trim();
  var sizeLabel     = document.getElementById('sizeLabel').value.trim();
  var sizeoptions   = document.getElementById('sizeOptions').value.trim();
  var desc          = document.getElementById('description').value.trim();
  var paymentMethod = document.getElementById('productPaymentMethod').value;
  var paypalEmail   = document.getElementById('paypalEmailInput').value.trim();

  var productLink      = "";
  var productEmbed     = "";
  var otherPaymentLink = "";

  if(paymentMethod === 'paypalLink'){
    productLink  = document.getElementById('productLink').value.trim();
  }
  if(paymentMethod === 'paypalEmbed'){
    productEmbed = document.getElementById('productEmbed').value.trim();
  }
  if(paymentMethod === 'other'){
    otherPaymentLink = document.getElementById('otherPaymentLink').value.trim();
  }

  // Basic mandatory checks for existing fields
  if (!title || !img1Blob || !price || !desc) {
    alert("Please fill out all mandatory fields (Title, First Image, Price, and Description).");
    return;
  }
  
  // New: Check that the Color Options field is filled (if payment method is not paypalEmbed)
  if (paymentMethod !== 'paypalEmbed' && !coloroptions) {
    alert("Please fill out the Color Options field.");
    return;
  }
  
  // New: Validate the field corresponding to the selected payment method
  if (paymentMethod === 'paypalLink' && !productLink) {
    alert("Please fill out the PayPal Button Link.");
    return;
  }
  if (paymentMethod === 'paypalEmbed' && !productEmbed) {
    alert("Please fill out the PayPal Button Embed Code.");
    return;
  }
  if (paymentMethod === 'other' && !otherPaymentLink) {
    alert("Please fill out the Other Payment Button/Checkout Page Link.");
    return;
  }
  if (paymentMethod === 'paypalEmail' && !paypalEmail) {
    alert("Please fill out the PayPal Email.");
    return;
  }

  // Gather images into an array of objects with both preview and final URLs
   var imgs = [];
  if (img1Blob) {
    var imageObj = { preview: img1Blob, final: img1Final, file: img1File };
    imgs.push(imageObj);
  }
  if (img2Blob) {
    var imageObj = { preview: img2Blob, final: img2Final, file: img2File };
    imgs.push(imageObj);
  }
  if (img3Blob) {
    var imageObj = { preview: img3Blob, final: img3Final, file: img3File };
    imgs.push(imageObj);
  }
  
  // Assign unique names to uploaded image files
  var productIndex = products.length + 1; // Next product index
  imgs.forEach(function(img, index) {
    if (img.file) {
      var originalName = img.file.name;
      var ext = originalName.split('.').pop();
      // Generate a name like "product-3-img-1.jpg"
      img.uniqueName = "product-" + productIndex + "-img-" + (index + 1) + "." + ext;
      // Update the final URL accordingly
      img.final = "Images/" + img.uniqueName;
    }
  });


  // Set shipping value
  var shippingVal = "FREE";
  if(shipping && shipping !== "0"){
    shippingVal = shipping;
  }

  // Set sold value
  var soldVal = "";
  if(sold && sold !== "0"){
    soldVal = sold;
  }

  // Build product object
  var product = {
    title        : title,
    images       : imgs,
    sold         : soldVal,
    price        : price,
    currency     : currencyCode,
    shipping     : shippingVal,
    returns      : returns,
    coloroptions : coloroptions,
    sizeoptions  : sizeoptions,
    colorLabel   : colorLabel || "Color",
    sizeLabel    : sizeLabel || "Size",
    description  : desc,
    paymentMethod: paymentMethod,
    paypalLink   : productLink,
    paypalEmbed  : productEmbed,
    otherPaymentLink : otherPaymentLink,
    paypalEmail  : paypalEmail
  };

  products.push(product);

  // Clear product input fields
  document.getElementById('productTitle').value = '';
  document.getElementById('image1').value = '';
  document.getElementById('image2').value = '';
  document.getElementById('image3').value = '';

  if (defaultCurrency) {
    currencyInput.value = defaultCurrency;
    currencyInput.setAttribute('data-code', defaultCurrencyCode);
  } else {
    currencyInput.value = '';
    currencyInput.removeAttribute('data-code');
  }

  document.getElementById('sold').value = '';
  document.getElementById('price').value = '';
  document.getElementById('shipping').value = '';
  document.getElementById('description').value = '';
  document.getElementById('colorOptions').value = '';
  document.getElementById('sizeOptions').value = '';
  document.getElementById('productLink').value = '';
  document.getElementById('productEmbed').value = '';
  document.getElementById('otherPaymentLink').value = '';
  if (paymentMethod !== 'paypalEmail') {
    document.getElementById('paypalEmailInput').value = '';
  } else {
    document.getElementById('paypalEmailInput').value = defaultPaypalEmail;
  }

  updateAddProductFormFields();

  // Reset the upload fields for product images by deleting their entries 
  delete window.uploadedImages['uploadImage1Btn'];
  delete window.uploadedImages['uploadImage2Btn'];
  delete window.uploadedImages['uploadImage3Btn'];
  delete window.backupImages['uploadImage1Btn'];
  delete window.backupImages['uploadImage2Btn'];
  delete window.backupImages['uploadImage3Btn'];

  // Reset the upload button icons for product images
  document.getElementById('uploadImage1Btn').innerHTML = '<i class="fas fa-cloud-upload-alt"></i>';
  document.getElementById('uploadImage2Btn').innerHTML = '<i class="fas fa-cloud-upload-alt"></i>';
  document.getElementById('uploadImage3Btn').innerHTML = '<i class="fas fa-cloud-upload-alt"></i>';

  // Reset image field count and hide additional fields
  imageCount = 1;
  document.getElementById('additionalImage2').style.display = 'none';
  document.getElementById('additionalImage3').style.display = 'none';
  document.getElementById('addImagesBtn').style.display = 'block';

  // Refresh the preview and update the added products list
  forceRefreshPreview();
  renderAddedProductsList();
}


function renderAddedProductsList() {
  const container = document.getElementById('addedProductsList');
  container.innerHTML = '';
  products.forEach((prod, idx) => {
    const row = document.createElement('div');
    row.classList.add('builder-item-row');

    const textSpan = document.createElement('span');
    textSpan.textContent = prod.title || 'Untitled';
    row.appendChild(textSpan);

    const delBtn = document.createElement('button');
    delBtn.classList.add('delete-btn');
    delBtn.textContent = '√ó';
    delBtn.onclick = function() {
      products.splice(idx, 1);
      renderAddedProductsList();
      updatePreview();
    };
    row.appendChild(delBtn);
    container.appendChild(row);
  });
}


  function addReview(){
    if(reviews.length >= 3){
      alert("You can only add up to 3 reviews!");
      return;
    }
    var name = document.getElementById('reviewerName').value.trim();
    var s    = document.getElementById('reviewStars').value;
    var txt  = document.getElementById('reviewText').value.trim();
    if(!name || !txt){
      alert("Please fill out reviewer's name and text!");
      return;
    }
    reviews.push({ name, stars:s, text:txt });
    document.getElementById('reviewerName').value='';
    document.getElementById('reviewText').value='';
    document.getElementById('reviewStars').value='3';
    // Force the preview to refresh even if the PayPal page is active
    forceRefreshPreview();
    renderAddedReviewsList();
  }

  function renderAddedReviewsList() {
    const container = document.getElementById('addedReviewsList');
    container.innerHTML = '';
    reviews.forEach((rev, idx) => {
      const row = document.createElement('div');
      row.classList.add('builder-item-row');

      const nameSpan = document.createElement('span');
      nameSpan.textContent = rev.name || "Unnamed";
      row.appendChild(nameSpan);

      const delBtn = document.createElement('button');
      delBtn.classList.add('delete-btn');
      delBtn.textContent = '√ó';
      delBtn.onclick = function () {
        reviews.splice(idx, 1);
        renderAddedReviewsList();
        updatePreview();
      };
      row.appendChild(delBtn);
      container.appendChild(row);
    });
  }

  function updatePreview() {
  // --- HERO DATA ---

 // For the Logo:
if (uploadedImages['uploadLogoBtn'] && window.uploadedFiles && window.uploadedFiles['uploadLogoBtn']) {
  heroData.logoPreview = uploadedImages['uploadLogoBtn'];
  heroData.logoFinal = "Images/" + window.uploadedFiles['uploadLogoBtn'].safeName;
} else {
  heroData.logoPreview = document.getElementById('logo').value.trim();
  heroData.logoFinal = document.getElementById('logo').value.trim();
}



  // For the Hero Banner:
if (uploadedImages['uploadBannerBtn'] && window.uploadedFiles && window.uploadedFiles['uploadBannerBtn']) {
  heroData.bannerPreview = uploadedImages['uploadBannerBtn'];
  heroData.bannerFinal = "Images/" + window.uploadedFiles['uploadBannerBtn'].safeName;
} else {
  heroData.bannerPreview = document.getElementById('banner').value.trim();
  heroData.bannerFinal = document.getElementById('banner').value.trim();
}


  heroData.heroText = document.getElementById('heroText').value.trim();
  heroData.ctaText = document.getElementById('ctaText').value.trim();

  // For the About Image:
if (uploadedImages['uploadAboutImgBtn'] && window.uploadedFiles && window.uploadedFiles['uploadAboutImgBtn']) {
  aboutData.imagePreview = uploadedImages['uploadAboutImgBtn'];
  aboutData.imageFinal = "Images/" + window.uploadedFiles['uploadAboutImgBtn'].safeName;
} else {
  aboutData.imagePreview = document.getElementById('aboutImage').value.trim();
  aboutData.imageFinal = document.getElementById('aboutImage').value.trim();
}

  aboutData.title = document.getElementById('aboutTitle').value.trim();
  aboutData.paragraph = document.getElementById('aboutParagraph').value.trim();
  aboutData.bgColor = document.getElementById('aboutBgColorPicker').value;
  aboutData.textColor = document.getElementById('aboutTextColorPicker').value;

  // --- CONTACT DATA ---
  contactData.intro = document.getElementById('contactIntro').value.trim();
  contactData.instagram = document.getElementById('contactInstagram').value.trim();
  contactData.tiktok = document.getElementById('contactTiktok').value.trim();
  contactData.facebook = document.getElementById('contactFacebook').value.trim();
  contactData.xLink = document.getElementById('contactX').value.trim();
  contactData.youtube = document.getElementById('contactYoutube').value.trim();
  contactData.email = document.getElementById('contactEmail').value.trim();

  // --- BUILD PREVIEW ---
  const previewHTML = buildPreviewHTML();
  const iframe = document.getElementById('previewFrame');
  const doc = iframe.contentDocument || iframe.contentWindow.document;
  doc.open();
  doc.write(previewHTML);
  doc.close();

  // --- PAYMENT BUTTON ENABLE/DISABLE ---
  var payBtn = document.getElementById('payBtn');
  if (checkMandatory()) {
    payBtn.disabled = false;
    payBtn.classList.add('enabled');
  } else {
    payBtn.disabled = true;
    payBtn.classList.remove('enabled');
  }
}

    
    function updateAboutColors() {
  // Update aboutData with the chosen colors
  aboutData.bgColor = document.getElementById('aboutBgColorPicker').value;
  aboutData.textColor = document.getElementById('aboutTextColorPicker').value;
  updatePreview(); // Refresh the preview to apply the new colors
}

  // NEW: Build the PREVIEW HTML (uses .logoPreview, .bannerPreview, etc.)
function buildPreviewHTML() {
  let top = "<!DOCTYPE html><html><head><meta charset='UTF-8'><title>Live Preview</title>";
  top += "<meta name='viewport' content='width=device-width, initial-scale=1.0'>";

  // Use the currently selected font for hero title, same as final:
  top += "<link href='https://fonts.googleapis.com/css2?family="
      + heroTitleFont.split(" ").join("+")
      + ":wght@400;500;700&display=swap' rel='stylesheet'>";

  // Include your global CSS:
  top += buildGlobalCSS();
  // No need for a favicon in the preview or Google Analytics
  top += "</head><body>";

  // *** Here we call the "preview" versions of the sections ***
  top += buildTopHeaderPreview();
  top += buildHeroPreview();
  top += buildProductsSectionPreview();
  top += buildReviewsSectionPreview();
  top += buildAboutSectionPreview();
  top += buildContactSectionPreview();

  // For the preview, you typically do not need the full product modal script,
  // but you *can* reuse it if you want the popup to appear in the preview.
  // If you want it, include:
  top += buildProductModalScript();

  top += "</body></html>";
  return top;
}
    
    function buildProductsSectionPreview() {
  // For example, you can return the same HTML as your final products section:
  return buildProductsSection();
}
function buildReviewsSectionPreview() {
  return buildReviewsSection();
}
function buildAboutSectionPreview() {
  return buildAboutSectionFinal(); // or buildAboutSection() if you prefer
}
function buildContactSectionPreview() {
  return buildContactSection();
}

    
    function buildPreviewHTML() {
  let top = "<!DOCTYPE html><html><head><meta charset='UTF-8'><title>Live Preview</title>";
  top += "<meta name='viewport' content='width=device-width, initial-scale=1.0'>";
  top += "<link href='https://fonts.googleapis.com/css2?family=" + heroTitleFont.split(" ").join("+") + ":wght@400;500;700&display=swap' rel='stylesheet'>";
  top += buildGlobalCSS();
  top += "</head><body>";
  top += buildTopHeaderPreview();
  top += buildHeroPreview();
  top += buildProductsSectionPreview();
  top += buildReviewsSectionPreview();
  top += buildAboutSectionPreview();
  top += buildContactSectionPreview();
  top += buildProductModalScript();
  top += "</body></html>";
  return top;
}

    

// Your existing function, now *unchanged*, still references .logoFinal, .bannerFinal, etc.
function buildFinalHTML() {
  var top = "<!DOCTYPE html><html><head><meta charset='UTF-8'>";
  top += "<meta name='viewport' content='width=device-width, initial-scale=1.0'>";

  top += "<link href='https://fonts.googleapis.com/css2?family="
      + heroTitleFont.split(" ").join("+")
      + ":wght@400;500;700&display=swap' rel='stylesheet'>";

  top += buildGlobalCSS();

  // Possibly add your favicon, analytics, etc.:
  if (heroData.logo.trim() !== "") {
    top += "<link rel='shortcut icon' href='" + escapeHTML(heroData.logoFinal) + "'>";
  }
  if (contactData.googleAnalytics) {
    top += "\n<!-- Google Analytics -->\n" + contactData.googleAnalytics + "\n";
  }

  top += "</head><body>";

  // *** Call the "final" versions below ***
  top += buildTopHeaderFinal();
  top += buildHeroFinal();
  top += buildProductsSectionFinal();
  top += buildReviewsSectionFinal();
  top += buildAboutSectionFinal();
  top += buildContactSectionFinal();
  top += buildProductModalScript(); // keep the final script for real usage

  top += "</body></html>";
  return top;
}



  function downloadSite(){
  if(downloadCount >= 4){
    alert("Oops! You've reached the 4-download limit!");
    return;
  }
  
  downloadCount++;
  
  if(downloadCount === 4) {
    var downloadBtn = document.getElementById("downloadBtn");
    if(downloadBtn){
      downloadBtn.disabled = true;
      downloadBtn.textContent = "Download limit reached";
    }
  }
  
  // Rebuild finalHTML if needed. (Ensure buildFinalHTML uses final URLs ‚Äì e.g. heroData.logoFinal, heroData.bannerFinal, aboutData.imageFinal, and for product images use img.final)
  if (!finalHTML.trim()){
    finalHTML = buildFinalHTML();
  }
  
  // Create a new JSZip instance and a root folder "MyWebsite"
  var zip = new JSZip();
  var websiteFolder = zip.folder("MyWebsite");
  
  // Add index.html to the root folder
  websiteFolder.file("index.html", finalHTML);
  
  // Create an "Images" folder inside "MyWebsite"
  var imagesFolder = websiteFolder.folder("Images");
  
  var filePromises = [];
  
  // 1. Process files that were uploaded via your file input
  if(window.uploadedFiles) {
    for (const key in window.uploadedFiles) {
      const file = window.uploadedFiles[key];
      filePromises.push(new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = function(e) {
          // e.target.result is an ArrayBuffer that preserves the original file data
          imagesFolder.file(file.safeName, e.target.result);
          resolve();
        };
        reader.onerror = reject;
        reader.readAsArrayBuffer(file);
      }));
    }
  }
  
  // 2. For each product, process its images:
  products.forEach((product, pIndex) => {
  if (product.images && product.images.length > 0) {
    product.images.forEach((img, i) => {
      // If a file object exists, use FileReader to read its data
      if (img.file) {
  filePromises.push(new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = function(e) {
      imagesFolder.file(img.uniqueName, e.target.result);
      resolve();
    };
    reader.onerror = reject;
    reader.readAsArrayBuffer(img.file);
  }));
}
      // Else if the image is external, fetch it normally
      else if (img.final && img.final.startsWith("http")) {
        filePromises.push(
          fetch(img.final)
            .then(response => {
              if (!response.ok) throw new Error("Network response was not ok");
              return response.arrayBuffer();
            })
            .then(arrayBuffer => {
              let ext = "jpg"; // default extension
              let parts = img.final.split('.');
              if (parts.length > 1) {
                ext = parts[parts.length - 1].split(/[?#]/)[0];
              }
              let filename = "product" + (pIndex + 1) + "_img" + (i + 1) + "." + ext;
              imagesFolder.file(filename, arrayBuffer);
            })
            .catch(err => {
              console.error("Error fetching image from URL:", img.final, err);
            })
        );
      }
    });
  }
});

  
  // Wait for all file processing to complete, then generate and trigger the ZIP download.
  Promise.all(filePromises)
    .then(() => {
      zip.generateAsync({ type: "blob" }).then(function(content) {
        saveAs(content, "My Website.zip");
      });
    })
    .catch(err => {
      console.error("Error reading files:", err);
      alert("Error reading files. Check console for details.");
    });
}






  function buildGlobalCSS(){
  var s = "<style>html{scroll-behavior:smooth;}*{box-sizing:border-box;transition:all 0.2s ease;}\n\
html,body { margin: 0; padding: 0; font-family: 'Roboto', sans-serif; background: #ffffff; color: #333; line-height: 1.6; }\n\
a{text-decoration:none;color:#2196f3}a:hover{opacity:0.8}img{max-width:100%;height:auto;display:block}\n\
.top-header{background:#fff;box-shadow:0 1px 3px rgba(0,0,0,0.1);padding:15px 10px;text-align:center}\n\
.logo-wrapper{display:inline-block}\n\
.logo-wrapper img{max-height:75px;width:auto;}\n\
.nav-links{margin-top:10px}\n\
.nav-links a{display:inline-block;margin:0 10px;padding:8px 12px;color:#555;font-weight:500;border-radius:4px;transition:background 0.2s,color 0.2s}\n\
.hero-banner{position:relative;min-height:70vh;display:flex;align-items:center;justify-content:center;overflow:hidden;background-size:cover;background-position:center}\n\
.hero-overlay{position:relative;z-index:1;text-align:center;color:#fff;padding:15px}\n\
.hero-title{font-size:2.5rem;margin:0 0 15px;text-shadow:1px 1px 3px rgba(0,0,0,0.3)}\n\
.hero-cta{display:inline-block;padding:12px 25px;background:#fff;color:#333;font-size:1.2rem;font-weight:600;border-radius:4px;transition:background 0.3s}\n\
.hero-cta:hover{background:#2196f3;color:#fff}\n\
.products-grid{display:grid;grid-gap:20px;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));padding:30px 10px;max-width:1300px;margin:0 auto}\n\
.product-item{background:#fff;border-radius:8px;overflow:hidden;border:1px solid #eee;cursor:pointer;text-align:left;transition:transform 0.2s,box-shadow 0.2s}\n\
.product-item:hover{transform:translateY(-3px);box-shadow:0 3px 6px rgba(0,0,0,0.1)}\n\
.product-img{width:100%;padding-bottom:100%;background-size:cover;background-position:center}\n\
.product-content{padding:15px}\n\
.product-content h3{margin:0 0 8px;font-size:1.2rem;font-weight:600;color:#222}\n\
.product-content h2{margin:0 0 10px;font-size:1rem;font-weight:500;color:#28a745}\n\
.buy-now{display:block;width:100%;padding:10px 0;background:" + productBuyNowBgColor + ";color:" + productBuyNowTextColor + ";text-align:center;border-radius:" + productBuyNowBorderRadius + "px;font-weight:600;transition:background 0.3s}\n\
.buy-now:hover{background-color:" + shadeColor(productBuyNowBgColor, -10) + ";}\n\
.reviews-section{background:#fff;padding:40px 20px;text-align:center}\n\
.reviews-section h2{margin-bottom:30px;font-size:1.8rem;color:#555}\n\
.review-container{display:flex;justify-content:center;flex-wrap:wrap;gap:20px}\n\
.review-item{background:#f9f9f9;border-radius:8px;padding:20px;box-shadow:0 1px 4px rgba(0,0,0,0.05);max-width:300px;transition:transform 0.3s ease,box-shadow 0.3s ease;text-align:left}\n\
.review-item:hover{transform:translateY(-3px);box-shadow:0 4px 8px rgba(0,0,0,0.1)}\n\
.review-item h4{margin:0 0 10px;font-weight:600;font-size:1.1rem}\n\
.review-stars{color:#ffc107;font-size:1.2rem;margin-bottom:10px}\n\
.review-item p{margin:5px 0 0;color:#666}\n\
.about-section{background:#fff;display:flex;flex-wrap:wrap;align-items:center;justify-content:center;padding:40px 20px;max-width:100%;margin:0 auto}\n\
.about-left,.about-right{margin-left:70px;flex:1 1 300px;padding:15px}\n\
.about-left h2{margin-top:0;color:#444;font-size:2rem}\n\
.about-left p{color:#555;line-height:1.8;font-size:1rem}\n\
.about-right img{border-radius:8px;max-width:80%;height:auto;box-shadow:0 1px 4px rgba(0,0,0,0.05);transition:transform 0.3s}\n\
.about-right img:hover{transform:scale(1.02)}\n\
.contact-section{border:0px solid #ddd;background:#ffffff;color:#333;padding:40px 20px;max-width:1200px;margin:40px auto;display:flex;gap:20px;flex-wrap:wrap;align-items:flex-start;justify-content:center}\n\
.contact-left{flex:1 1 300px;text-align:left}\n\
.contact-logo-left img{max-height:50px;width:auto;margin-bottom:15px}\n\
.contact-left p{font-size:0.95rem;color:#555;margin-bottom:15px;}\n\
.contact-social-icons{display:flex;flex-wrap:wrap;gap:15px;margin-bottom:15px}\n\
.contact-social-icons img{width:35px;height:35px;cursor:pointer;transition:transform 0.3s;border-radius:4px}\n\
.contact-social-icons img:hover{transform:scale(1.05)}\n\
.contact-email-line{margin-top:10px;color:#333;font-size:0.95rem;margin-bottom:8px}\n\
.email-btn{display:inline-block;padding:10px 20px;background:#2196f3;color:#fff;font-weight:600;border-radius:4px;text-transform:uppercase;letter-spacing:0.5px;transition:background 0.3s;text-align:center}\n\
.email-btn:hover{background:#1976d2}\n\
.contact-right{flex:1 1 300px;}\n\
.modal{display:none;position:fixed;z-index:9999;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,0.6);justify-content:center;align-items:center;padding:20px}\n\
.modal-content{background:#fff;margin:auto;width:90%;max-width:1100px;border-radius:8px;position:relative;padding:20px}\n\
.modal-close{position:absolute;top:15px;right:20px;font-size:1.5rem;font-weight:bold;cursor:pointer;line-height:1}\n\
.modal-body{display:flex;flex-wrap:wrap;gap:20px}\n\
.modal-left{flex:1 1 50%;display:flex;flex-direction:column}\n\
.modal-main-image{width:85%;aspect-ratio:4/5;position:relative;overflow:hidden;border-radius:8px}\n\
.modal-main-image img{width:100%;height:100%;object-fit:cover}\n\
.arrow{position:absolute;top:50%;transform:translateY(-50%);background-color:rgba(255,255,255,0.8);color:#333;padding:0.3rem 0.6rem;border-radius:50%;cursor:pointer;user-select:none;font-weight:bold;box-shadow:0 2px 4px rgba(0,0,0,0.2)}\n\
.arrow-left{left:5px}\n\
.arrow-right{right:5px}\n\
.arrow:hover{background-color:rgba(255,255,255,1)}\n\
.modal-thumbnails{display:flex;gap:10px;margin-top:10px}\n\
.modal-thumbnails img{width:80px;height:80px;object-fit:cover;border-radius:4px;box-shadow:0 2px 4px rgba(0,0,0,0.1);border:2px solid transparent;cursor:pointer}\n\
.modal-right{flex:1 1 45%;display:flex;flex-direction:column}\n\
.modal-product-price{font-size:1.6rem;color:#109c15;font-weight:700;margin-bottom:15px}\n\
.modal-product-sold{text-align:left;font-size:1rem;color:#333;margin-bottom:15px}\n\
.modal-product-title{font-size:1.8rem;margin:0 0 10px;font-weight:700;line-height:1.2}\n\
.modal-description{margin-bottom:20px;color:#555}\n\
.color-options,.size-options{margin-bottom:15px}\n\
.color-options label,.size-options label{font-weight:600;margin-right:10px}\n\
.color-options span,.size-options span{display:inline-block;margin-right:5px;background:#f0f0f0;padding:5px 10px;border-radius:4px;font-size:0.9rem;border:1px solid transparent;cursor:pointer}\n\
.order-details-panel{border:1px solid #eee;padding:15px;border-radius:8px;background:#fafafa}\n\
.order-details-panel h3{margin-top:0;font-size:1.2rem;margin-bottom:15px}\n\
.order-item{display:flex;justify-content:space-between;margin-bottom:10px;font-size:0.95rem}\n\
.order-item label{color:#555;font-weight:500;margin-right:5px}\n\
.order-item .value{font-weight:600}\n\
.shipping-info{background:#fff7de;border-left:4px solid #ffc107;padding:10px;font-size:0.9rem;margin-top:10px}\n\
.subtotal{margin-top:10px;font-size:1rem;text-align:right;font-weight:bold}\n\
.modal-actions{display:flex;gap:10px;margin-top:20px}\n\
.modal-actions button{flex:1;background:#2196f3;color:#fff;border:none;padding:12px;border-radius:4px;cursor:pointer;font-weight:600;font-size:1rem;height:50px;transition:background 0.3s}\n\
.modal-actions button:hover{background:#1976d2}\n\
.paypal-embed-option{margin-bottom:15px;}\n\
.paypal-embed-option label{font-weight:600;margin-right:10px;}\n\
.paypal-embed-option span{cursor:pointer;margin-right:5px;background:#f0f0f0;padding:5px 10px;border-radius:4px;font-size:0.9rem;border:1px solid transparent;}\n\
.paypal-embed-option span.selected{border:2px solid #2196f3;background:#eef6ff;}\n" +
  "\n/* Media Query for Small Screens */\n@media (max-width: 768px) {\n" +
  "  .top-header {\n" +
  "    padding: 15px 10px;\n" +
  "    text-align: center;\n" +
  "  }\n" +
  "  .logo-wrapper img {\n" +
  "    margin-top: 15px;\n" +
  "    max-width: 150px;\n" +
  "  }\n" +
  "  .nav-links {\n" +
  "    display: flex;\n" +
  "    justify-content: space-between;\n" +
  "    align-items: center;\n" +
  "    flex-wrap: nowrap;\n" +
  "    gap: 0px;\n" +
  "    margin-top: 10px;\n" +
  "  }\n" +
  "  .nav-links a {\n" +
  "    padding: 8px 10px;\n" +
  "    font-size: 0.85rem;\n" +
  "    font-weight: 500;\n" +
  "    white-space: nowrap;\n" +
  "  }\n" +
  "  .products-grid {\n" +
  "    display: flex;\n" +
  "    flex-direction: column;\n" +
  "    align-items: center;\n" +
  "    gap: 15px;\n" +
  "    padding: 15px;\n" +
  "  }\n" +
  "  .product-item {\n" +
  "    width: 100%;\n" +
  "    max-width: 300px;\n" +
  "    border-radius: 8px;\n" +
  "    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);\n" +
  "    overflow: hidden;\n" +
  "  }\n" +
  "  .product-img {\n" +
  "    width: 100%;\n" +
  "    aspect-ratio: 1 / 1;\n" +
  "    background-size: cover;\n" +
  "    background-position: center;\n" +
  "  }\n" +
  "  .product-content {\n" +
  "    padding: 15px;\n" +
  "  }\n" +
  "  .product-content h3 {\n" +
  "    font-size: 1rem;\n" +
  "    margin-bottom: 10px;\n" +
  "  }\n" +
  "  .product-content h2 {\n" +
  "    font-size: 1rem;\n" +
  "    color: #109c15;\n" +
  "    margin-bottom: 10px;\n" +
  "  }\n" +
  "  .buy-now {\n" +
  "    padding: 10px;\n" +
  "    font-size: 0.9rem;\n" +
  "    border-radius: 5px;\n" +
  "  }\n" +
  "  .modal-content {\n" +
  "    width: 100%;\n" +
  "    max-width: 100%;\n" +
  "    padding: 15px;\n" +
  "    position: relative;\n" +
  "  }\n" +
  "  .modal-close {\n" +
  "    position: absolute;\n" +
  "    top: 10px;\n" +
  "    right: 15px;\n" +
  "    font-size: 2rem;\n" +
  "    font-weight: bold;\n" +
  "    z-index: 10;\n" +
  "    line-height: 1;\n" +
  "    cursor: pointer;\n" +
  "    color: #333;\n" +
  "  }\n" +
  "  .modal-body {\n" +
  "    flex-direction: column;\n" +
  "    gap: 15px;\n" +
  "  }\n" +
  "  .modal-left {\n" +
  "    flex: none;\n" +
  "    align-items: center;\n" +
  "    width: 100%;\n" +
  "  }\n" +
  "  .modal-main-image {\n" +
  "    width: 100%;\n" +
  "    aspect-ratio: 4/5;\n" +
  "    object-fit: cover;\n" +
  "  }\n" +
  "  .modal-thumbnails {\n" +
  "    justify-content: center;\n" +
  "    gap: 5px;\n" +
  "  }\n" +
  "  .modal-thumbnails img {\n" +
  "    width: 60px;\n" +
  "    height: 60px;\n" +
  "  }\n" +
  "  .modal-right {\n" +
  "    flex: none;\n" +
  "    width: 100%;\n" +
  "    text-align: left;\n" +
  "  }\n" +
  "  .modal-product-title {\n" +
  "    font-size: 1.5rem;\n" +
  "  }\n" +
  "  .modal-product-price {\n" +
  "    font-size: 1.4rem;\n" +
  "  }\n" +
  "  .modal-description {\n" +
  "    font-size: 0.9rem;\n" +
  "  }\n" +
  "  .color-options, .size-options {\n" +
  "    gap: 5px;\n" +
  "    justify-content: center;\n" +
  "  }\n" +
  "  .color-options span, .size-options span {\n" +
  "    padding: 6px 10px;\n" +
  "    font-size: 0.8rem;\n" +
  "  }\n" +
  "  .qty-controls {\n" +
  "    justify-content: center;\n" +
  "    gap: 5px;\n" +
  "  }\n" +
  "  .order-details-panel {\n" +
  "    padding: 10px;\n" +
  "    font-size: 0.9rem;\n" +
  "  }\n" +
  "  .modal-actions {\n" +
  "    flex-direction: column;\n" +
  "    gap: 10px;\n" +
  "  }\n" +
  "  .modal-actions button {\n" +
  "    width: 100%;\n" +
  "    height: 45px;\n" +
  "  }\n" +
  "  .reviews-section {\n" +
  "    padding: 40px 15px;\n" +
  "  }\n" +
  "  .review-container {\n" +
  "    flex-direction: column;\n" +
  "    align-items: center;\n" +
  "    gap: 20px;\n" +
  "  }\n" +
  "  .review-item {\n" +
  "    max-width: 90%;\n" +
  "    padding: 20px;\n" +
  "    text-align: center;\n" +
  "  }\n" +
  "  .review-item h4 {\n" +
  "    font-size: 1rem;\n" +
  "  }\n" +
  "  .review-stars {\n" +
  "    font-size: 1.3rem;\n" +
  "    margin-bottom: 8px;\n" +
  "  }\n" +
  "  .review-item p {\n" +
  "    font-size: 0.9rem;\n" +
  "    line-height: 1.4;\n" +
  "  }\n" +
"  .about-section {\n" +
"    display: flex;\n" +
"    flex-direction: column;\n" +
"    padding: 40px 15px;\n" +
"    margin: 0 auto;\n" +
"  }\n" +
"  .about-left, .about-right {\n" +
"    flex: none;\n" +
"    margin: 0;\n" +
"    width: 100%;\n" +
"    text-align: center;\n" +
"    padding: 20px;\n" +
"  }\n" +
"  .about-left h2 {\n" +
"    font-size: 1.8rem;\n" +
"  }\n" +
"  .about-left p {\n" +
"    font-size: 1rem;\n" +
"    line-height: 1.6;\n" +
"    max-width: 100%;\n" +
"  }\n" +
"  .about-right img {\n" +
"    max-width: 100%;\n" +
"    height: auto;\n" +
"    border-radius: 8px;\n" +
"    box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n" +
  "  }\n" +
  "  .contact-section {\n" +
  "    padding: 40px 15px;\n" +
  "    text-align: center;\n" +
  "  }\n" +
  "  .contact-logo-left img {\n" +
  "    max-width: 150px;\n" +
  "    margin-bottom: 15px;\n" +
  "  }\n" +
  "  .contact-section p {\n" +
  "    font-size: 0.95rem;\n" +
  "    line-height: 1.5;\n" +
  "    margin-bottom: 20px;\n" +
  "  }\n" +
  "  .contact-social-icons {\n" +
  "    flex-wrap: wrap;\n" +
  "    gap: 15px;\n" +
  "    justify-content: center;\n" +
  "  }\n" +
  "  .contact-social-icons img {\n" +
  "    width: 35px;\n" +
  "    height: 35px;\n" +
  "    margin-bottom: 10px;\n" +
  "  }\n" +
  "  .contact-email-line {\n" +
  "    font-size: 0.9rem;\n" +
  "    margin-bottom: 10px;\n" +
  "  }\n" +
  "  .email-btn {\n" +
  "    font-size: 0.9rem;\n" +
  "    padding: 10px 20px;\n" +
  "    border-radius: 4px;\n" +
  "    box-shadow: 0 2px 6px rgba(0,0,0,0.1);\n" +
  "  }\n" +
  "}\n\
</style>";
  return s;
}


  function buildTopHeaderPreview() {
  let h = "<header class='top-header'><div class='logo-wrapper'>";
  // Use .logoPreview for the preview
  if (heroData.logoPreview) {
    h += "<img src='" + escapeHTML(heroData.logoPreview) + "' alt='Logo'>";
  }
  h += "</div><div class='nav-links'>";
  h += "<a href='#products'>Shop</a>";
  h += "<a href='#reviews'>Reviews</a>";
  h += "<a href='#about'>About Us</a>";
  h += "<a href='#contact'>Contact Us</a>";
  h += "</div></header>";
  return h;
}

function buildTopHeaderFinal() {
  let h = "<header class='top-header'><div class='logo-wrapper'>";
  // Use .logoFinal for the final code
  if (heroData.logoFinal) {
    h += "<img src='" + escapeHTML(heroData.logoFinal) + "' alt='Logo'>";
  }
  h += "</div><div class='nav-links'>";
  h += "<a href='#products'>Shop</a>";
  h += "<a href='#reviews'>Reviews</a>";
  h += "<a href='#about'>About Us</a>";
  h += "<a href='#contact'>Contact Us</a>";
  h += "</div></header>";
  return h;
}



  // For the live preview ‚Äì use the blob URL (heroData.bannerPreview)
function buildHeroPreview() {
  if (!heroData.bannerPreview) {
    // Minimal hero (no banner uploaded)
    let minimal = "";
    minimal += "<section class='hero-banner' style='background:none; min-height:200px;'>";
    minimal += "<div class='hero-overlay'>";
    if (heroData.heroText) {
      minimal += "<h1 class='hero-title' style='color:" + (heroData.heroTitleColor || '#000000') +
                 "; font-family:" + heroTitleFont + ";'>" + escapeHTML(heroData.heroText) + "</h1>";
    }
    if (heroData.ctaText) {
      minimal += "<a class='hero-cta' style='background-color:" + (heroData.ctaBgColor || '#007bff') +
                 "; color:" + (heroData.ctaTextColor || '#ffffff') + ";' href='#products'>" +
                 escapeHTML(heroData.ctaText) + "</a>";
    }
    minimal += "</div></section>";
    return minimal;
  }
  // Big hero using the preview URL
  let bkg = heroData.bannerPreview || "";
  let s = "<section class='hero-banner' style=\"background-image:url('" + escapeHTML(bkg) + "');\">";
  s += "<div class='hero-overlay'>";
  if (heroData.heroText) {
    s += "<h1 class='hero-title' style='color:" + (heroData.heroTitleColor || '#000000') +
         "; font-family:" + heroTitleFont + ";'>" + escapeHTML(heroData.heroText) + "</h1>";
  }
  if (heroData.ctaText) {
    s += "<a class='hero-cta' style='background-color:" + (heroData.ctaBgColor || '#007bff') +
         "; color:" + (heroData.ctaTextColor || '#ffffff') + ";' href='#products'>" +
         escapeHTML(heroData.ctaText) + "</a>";
  }
  s += "</div></section>";
  return s;
}

// For the final generated HTML ‚Äì use the final image path (heroData.bannerFinal)
function buildHeroFinal() {
  if (!heroData.bannerFinal) {
    // Minimal hero (no banner uploaded)
    let minimal = "";
    minimal += "<section class='hero-banner' style='background:none; min-height:200px;'>";
    minimal += "<div class='hero-overlay'>";
    if (heroData.heroText) {
      minimal += "<h1 class='hero-title' style='color:" + (heroData.heroTitleColor || '#000000') +
                 "; font-family:" + heroTitleFont + ";'>" + escapeHTML(heroData.heroText) + "</h1>";
    }
    if (heroData.ctaText) {
      minimal += "<a class='hero-cta' style='background-color:" + (heroData.ctaBgColor || '#007bff') +
                 "; color:" + (heroData.ctaTextColor || '#ffffff') + ";' href='#products'>" +
                 escapeHTML(heroData.ctaText) + "</a>";
    }
    minimal += "</div></section>";
    return minimal;
  }
  // Big hero using the final URL
  let bkg = heroData.bannerFinal || "";
  let s = "<section class='hero-banner' style=\"background-image:url('" + escapeHTML(bkg) + "');\">";
  s += "<div class='hero-overlay'>";
  if (heroData.heroText) {
    s += "<h1 class='hero-title' style='color:" + (heroData.heroTitleColor || '#000000') +
         "; font-family:" + heroTitleFont + ";'>" + escapeHTML(heroData.heroText) + "</h1>";
  }
  if (heroData.ctaText) {
    s += "<a class='hero-cta' style='background-color:" + (heroData.ctaBgColor || '#007bff') +
         "; color:" + (heroData.ctaTextColor || '#ffffff') + ";' href='#products'>" +
         escapeHTML(heroData.ctaText) + "</a>";
  }
  s += "</div></section>";
  return s;
}

  function buildProductsSectionFinal(){
    if(products.length === 0){
      return "<section id='products'><div class='products-grid'></div></section>";
    }
    var html = "";
    for(var i=0; i<products.length; i++){
      var p       = products[i];
      var mainImg = (p.images.length > 0) ? escapeHTML(p.images[0].final) : "";
      var symbol  = getCurrencySymbol(p.currency);

      html += "<div class='product-item'"+
        " data-title='"+escapeHTML(p.title||"")+"'"+
        " data-sold='"+escapeHTML(p.sold||"")+"'"+
        " data-price='"+escapeHTML(p.price||"0")+"'"+
        " data-currency='"+escapeHTML(p.currency||"$")+"'"+
        " data-description='"+escapeHTML(p.description||"")+"'"+
        " data-shipping='"+escapeHTML(p.shipping||"FREE")+"'"+
        " data-returns='"+escapeHTML(p.returns||"Accepted")+"'"+
        " data-coloroptions='"+escapeHTML(p.coloroptions||"")+"'"+
        " data-sizeoptions='"+escapeHTML(p.sizeoptions||"")+"'"+
        " data-colorlabel='"+escapeHTML(p.colorLabel||"Color")+"'"+
        " data-sizelabel='"+escapeHTML(p.sizeLabel||"Size")+"'"+
        " data-images1='"+(p.images[0] ? p.images[0].final : "")+"'"+
        " data-images2='"+(p.images[1] ? p.images[1].final : "")+"'"+
        " data-images3='"+(p.images[2] ? p.images[2].final : "")+"'"+
        " data-paymentmethod='"+escapeHTML(p.paymentMethod||"")+"'"+
        " data-paypallink='"+escapeHTML(p.paypalLink||"")+"'"+
        " data-paypalembed='"+escapeHTML(p.paypalEmbed||"")+"'"+
        " data-otherpaymentlink='"+escapeHTML(p.otherPaymentLink||"")+"'"+
        " data-paypalemail='"+escapeHTML(p.paypalEmail||"")+"'"+
        ">";
      
      html += "<div class='product-img' style=\"background-image:url('"+mainImg+"');\"></div>";
      html += "<div class='product-content'>";
      html += (p.title ? "<h3>"+escapeHTML(p.title)+"</h3>" : "<h3>Untitled Product</h3>");
      html += "<h2>"+ symbol + escapeHTML(p.price||"0") +"</h2>";
      html += "<a class='buy-now' style='background-color:" + productBuyNowBgColor + "; color:" + productBuyNowTextColor + "; border-radius:" + productBuyNowBorderRadius + "px;' href='#'>Buy Now</a>";
      html += "</div></div>";
    }
    return "<section id='products'><div class='products-grid'>"+html+"</div></section>";
  }
    
    function buildProductsSectionPreview() {
  if (products.length === 0) {
    return "<section id='products'><div class='products-grid'></div></section>";
  }
  var html = "";
  for (var i = 0; i < products.length; i++) {
    var p = products[i];
    // Use the preview image (blob URL) if available; otherwise, fallback to final URL.
    var mainImg = "";
    if (p.images.length > 0) {
      mainImg = p.images[0].preview ? escapeHTML(p.images[0].preview)
                                    : escapeHTML(p.images[0].final);
    }
    var symbol = getCurrencySymbol(p.currency);
    
    html += "<div class='product-item'" +
      " data-title='" + escapeHTML(p.title || "") + "'" +
      " data-sold='" + escapeHTML(p.sold || "") + "'" +
      " data-price='" + escapeHTML(p.price || "0") + "'" +
      " data-currency='" + escapeHTML(p.currency || "$") + "'" +
      " data-description='" + escapeHTML(p.description || "") + "'" +
      " data-shipping='" + escapeHTML(p.shipping || "FREE") + "'" +
      " data-returns='" + escapeHTML(p.returns || "Accepted") + "'" +
      " data-coloroptions='" + escapeHTML(p.coloroptions || "") + "'" +
      " data-sizeoptions='" + escapeHTML(p.sizeoptions || "") + "'" +
      " data-colorlabel='" + escapeHTML(p.colorLabel || "Color") + "'" +
      " data-sizelabel='" + escapeHTML(p.sizeLabel || "Size") + "'" +
      " data-images1='" + (p.images[0] ? p.images[0].preview : "") + "'" +
      " data-images2='" + (p.images[1] ? p.images[1].preview : "") + "'" +
      " data-images3='" + (p.images[2] ? p.images[2].preview : "") + "'" +
      " data-paymentmethod='" + escapeHTML(p.paymentMethod || "") + "'" +
      " data-paypallink='" + escapeHTML(p.paypalLink || "") + "'" +
      " data-paypalembed='" + escapeHTML(p.paypalEmbed || "") + "'" +
      " data-otherpaymentlink='" + escapeHTML(p.otherPaymentLink || "") + "'" +
      " data-paypalemail='" + escapeHTML(p.paypalEmail || "") + "'" +
      ">";
    
    html += "<div class='product-img' style=\"background-image:url('" + mainImg + "');\"></div>";
    html += "<div class='product-content'>";
    html += (p.title ? "<h3>" + escapeHTML(p.title) + "</h3>" : "<h3>Untitled Product</h3>");
    html += "<h2>" + symbol + escapeHTML(p.price || "0") + "</h2>";
    html += "<a class='buy-now' style='background-color:" + productBuyNowBgColor +
            "; color:" + productBuyNowTextColor +
            "; border-radius:" + productBuyNowBorderRadius + "px;' href='#'>Buy Now</a>";
    html += "</div></div>";
  }
  return "<section id='products'><div class='products-grid'>" + html + "</div></section>";
}



  function buildReviewsSection(){
    if(reviews.length === 0) return "";
    var r = "<section class='reviews-section' id='reviews'><h2>Reviews</h2><div class='review-container'>";
    for(var i=0; i<reviews.length; i++){
      var rv         = reviews[i];
      var starCount  = parseInt(rv.stars,10) || 3;
      var starSymbols= "";
      for(var s=0; s<starCount; s++){ starSymbols += "‚òÖ"; }
      for(var s2=starCount; s2<5; s2++){ starSymbols += "‚òÜ"; }

      r += "<div class='review-item'><h4>"+escapeHTML(rv.name)+"</h4>"+
           "<div class='review-stars'>"+starSymbols+"</div>"+
           "<p>"+escapeHTML(rv.text)+"</p></div>";
    }
    r += "</div></section>";
    return r;
  }
    function buildReviewsSectionFinal() {
  return buildReviewsSection();
}


  function buildAboutSectionPreview() {
  if (!aboutData.title && !aboutData.paragraph && !aboutData.image) return "";
  // Only apply background color on the section
  let styleAttr = "";
  if (aboutData.bgColor) {
    styleAttr += "background-color:" + aboutData.bgColor + ";";
  }
  let a = "<section class='about-section' id='about' style='" + styleAttr + "'>";
  a += "<div class='about-left'>";
  // Apply text color directly on the heading and paragraph
  a += "<h2 style='color:" + aboutData.textColor + ";'>" + escapeHTML(aboutData.title || "Who We Are") + "</h2>";
  a += "<p style='color:" + aboutData.textColor + ";'>" + escapeHTML(aboutData.paragraph || "Our story...") + "</p>";
  a += "</div><div class='about-right'>";
  // Use the preview image (blob URL)
  if (aboutData.imagePreview) {
    a += "<img src='" + escapeHTML(aboutData.imagePreview) + "' alt='About Image'>";
  }
  a += "</div></section>";
  return a;
}
function buildAboutSectionFinal() {
  if (!aboutData.title && !aboutData.paragraph && !aboutData.image) return "";
  // Only apply background color on the section
  let styleAttr = "";
  if (aboutData.bgColor) {
    styleAttr += "background-color:" + aboutData.bgColor + ";";
  }
  let a = "<section class='about-section' id='about' style='" + styleAttr + "'>";
  a += "<div class='about-left'>";
  // Apply text color directly on the heading and paragraph
  a += "<h2 style='color:" + aboutData.textColor + ";'>" + escapeHTML(aboutData.title || "Who We Are") + "</h2>";
  a += "<p style='color:" + aboutData.textColor + ";'>" + escapeHTML(aboutData.paragraph || "Our story...") + "</p>";
  a += "</div><div class='about-right'>";
  // Use the final image path here
  if (aboutData.imageFinal) {
    a += "<img src='" + escapeHTML(aboutData.imageFinal) + "' alt='About Image'>";
  }
  a += "</div></section>";
  return a;
}


  // For the live preview ‚Äì use blob URL first (if available)
function buildContactSectionPreview() {
  var anyFilled = contactData.intro || contactData.instagram || contactData.tiktok ||
                  contactData.facebook || contactData.xLink || contactData.youtube ||
                  contactData.email || contactData.formEmbed;
  if (!anyFilled) return "";

  var c = "<section class='contact-section' id='contact'><div class='contact-left'><div class='contact-logo-left'>";
  // In preview, use the blob URL if available
  var contactLogo = heroData.logoPreview || heroData.logoFinal || "";
  if (contactLogo) {
    c += "<img src='" + escapeHTML(contactLogo) + "' alt='Logo'>";
  }
  c += "</div>";
  if (contactData.intro) {
    c += "<p>" + escapeHTML(contactData.intro) + "</p>";
  }
  let iconsHTML = "";
  if (contactData.instagram) iconsHTML += "<a href='" + escapeHTML(contactData.instagram) + "' target='_blank'><img src='https://i.ibb.co/N2yTY0Cj/Bella-73.png' alt='Instagram'></a>";
  if (contactData.tiktok)    iconsHTML += "<a href='" + escapeHTML(contactData.tiktok) + "' target='_blank'><img src='https://i.ibb.co/2vSmtt0/Bella-49.png' alt='TikTok'></a>";
  if (contactData.facebook)  iconsHTML += "<a href='" + escapeHTML(contactData.facebook) + "' target='_blank'><img src='https://i.ibb.co/gmDjkH3/Bella-48.png' alt='Facebook'></a>";
  if (contactData.xLink)     iconsHTML += "<a href='" + escapeHTML(contactData.xLink) + "' target='_blank'><img src='https://i.ibb.co/fqp0KrB/Bella-63.png' alt='X'></a>";
  if (contactData.youtube)   iconsHTML += "<a href='" + escapeHTML(contactData.youtube) + "' target='_blank'><img src='https://i.ibb.co/hC6CQzs/Bella-62.png' alt='Youtube'></a>";

  if (iconsHTML) {
    c += "<div class='contact-social-icons'>" + iconsHTML + "</div>";
  }
  if (contactData.email) {
    c += "<div class='contact-email-line'>" + escapeHTML(contactData.email) + "</div>";
    if (!contactData.formEmbed) {
      c += "<a class='email-btn' href='mailto:" + escapeHTML(contactData.email) + "'>Send Us an Email</a>";
    }
  }
  c += "</div><div class='contact-right'>";
  if (contactData.formEmbed) {
    c += "<div class='contact-embed'>" + contactData.formEmbed + "</div>";
  }
  c += "</div></section>";
  return c;
}

// For the final generated website ‚Äì use only the final URL
function buildContactSectionFinal() {
  var anyFilled = contactData.intro || contactData.instagram || contactData.tiktok ||
                  contactData.facebook || contactData.xLink || contactData.youtube ||
                  contactData.email || contactData.formEmbed;
  if (!anyFilled) return "";

  var c = "<section class='contact-section' id='contact'><div class='contact-left'><div class='contact-logo-left'>";
  // In final build, use only the final logo URL
  var contactLogo = heroData.logoFinal || "";
  if (contactLogo) {
    c += "<img src='" + escapeHTML(contactLogo) + "' alt='Logo'>";
  }
  c += "</div>";
  if (contactData.intro) {
    c += "<p>" + escapeHTML(contactData.intro) + "</p>";
  }
  let iconsHTML = "";
  if (contactData.instagram) iconsHTML += "<a href='" + escapeHTML(contactData.instagram) + "' target='_blank'><img src='https://i.ibb.co/N2yTY0Cj/Bella-73.png' alt='Instagram'></a>";
  if (contactData.tiktok)    iconsHTML += "<a href='" + escapeHTML(contactData.tiktok) + "' target='_blank'><img src='https://i.ibb.co/2vSmtt0/Bella-49.png' alt='TikTok'></a>";
  if (contactData.facebook)  iconsHTML += "<a href='" + escapeHTML(contactData.facebook) + "' target='_blank'><img src='https://i.ibb.co/gmDjkH3/Bella-48.png' alt='Facebook'></a>";
  if (contactData.xLink)     iconsHTML += "<a href='" + escapeHTML(contactData.xLink) + "' target='_blank'><img src='https://i.ibb.co/fqp0KrB/Bella-63.png' alt='X'></a>";
  if (contactData.youtube)   iconsHTML += "<a href='" + escapeHTML(contactData.youtube) + "' target='_blank'><img src='https://i.ibb.co/hC6CQzs/Bella-62.png' alt='Youtube'></a>";

  if (iconsHTML) {
    c += "<div class='contact-social-icons'>" + iconsHTML + "</div>";
  }
  if (contactData.email) {
    c += "<div class='contact-email-line'>" + escapeHTML(contactData.email) + "</div>";
    if (!contactData.formEmbed) {
      c += "<a class='email-btn' href='mailto:" + escapeHTML(contactData.email) + "'>Send Us an Email</a>";
    }
  }
  c += "</div><div class='contact-right'>";
  if (contactData.formEmbed) {
    c += "<div class='contact-embed'>" + contactData.formEmbed + "</div>";
  }
  c += "</div></section>";
  return c;
}



  // ============== PRODUCT MODAL SCRIPT ==============
function buildProductModalScript(){
  // We'll build a string for an inline <script> in the final HTML.
  let m = "";
  m += "<script>(function(){\n";
  m += "  function getSymbol(cc){\n";
  m += "    const known = {USD:'$', EUR:'‚Ç¨', GBP:'¬£', JPY:'¬•', AUD:'A$', CAD:'C$', CHF:'CHF', CNY:'¬•', HKD:'HK$', NZD:'NZ$'};\n";
  m += "    return known[cc.toUpperCase()] || cc + ' ';}\n\n";
  
  // Function to check selections (for embed code only) if needed
  m += "  function checkEmbedSelections() {\n";
  m += "    var embedBlocks = paypalEmbedDiv.getElementsByClassName('paypal-embed-option');\n";
  m += "    for(var i = 0; i < embedBlocks.length; i++){\n";
  m += "      if(!embedBlocks[i].querySelector('span.selected')){\n";
  m += "         alert('Please select an option for ' + embedBlocks[i].querySelector('label').textContent);\n";
  m += "         return false;\n";
  m += "      }\n";
  m += "    }\n";
  m += "    return true;\n";
  m += "  }\n\n";
  
  // Create the modal container
  m += "  var modal = document.createElement('div');\n";
  m += "  modal.id = 'productModal';\n";
  m += "  modal.className = 'modal';\n";
  
  // The modal's inner HTML (using 'Color:' and 'Size:' labels)
  m += "  modal.innerHTML = `\\\n\
<div class='modal-content'>\\\n\
  <span class='modal-close'>&times;</span>\\\n\
  <div class='modal-body'>\\\n\
    <div class='modal-left'>\\\n\
      <div class='modal-main-image'>\\\n\
        <div class='arrow arrow-left' id='arrowLeft'>‚ùÆ</div>\\\n\
        <img id='modalMainImg' src='' alt='Main Product Image'>\\\n\
        <div class='arrow arrow-right' id='arrowRight'>‚ùØ</div>\\\n\
      </div>\\\n\
      <div class='modal-thumbnails' id='modalThumbnails'></div>\\\n\
    </div>\\\n\
    <div class='modal-right'>\\\n\
      <h1 id='modalTitle' class='modal-product-title'></h1>\\\n\
      <div style='display:flex;flex-direction:row;justify-content:flex-start;align-items:center;'>\\\n\
        <div id='modalPrice' class='modal-product-price'>$0.00</div>\\\n\
        <div id='modalSold' class='modal-product-sold' style='margin-left:10px;'></div>\\\n\
      </div>\\\n\
      <div id='modalDescription' class='modal-description'></div>\\\n\
      <div id='modalAttributes' style='margin: 10px 0;'>\\\n\
         <div class='attribute-group'>\\\n\
           <span class='attribute-label' style='font-weight:bold;margin-right:5px;'>Color:</span>\\\n\
           <div id='modalColorOptions' class='color-options'></div>\\\n\
         </div>\\\n\
         <div class='attribute-group' style='margin-top:5px;'>\\\n\
           <span class='attribute-label' style='font-weight:bold;margin-right:5px;'>Size:</span>\\\n\
           <div id='modalSizeOptions' class='size-options'></div>\\\n\
         </div>\\\n\
      </div>\\\n\
      <div id='paypalEmbedFields'></div>\\\n\
      <div id='quantityWrapper' style='display:none; margin:15px 0;'>\\\n\
        <label style='font-weight:600;'>Quantity:</label>\\\n\
        <button id='decreaseQty' type='button' style='margin-left:10px;'>-</button>\\\n\
        <span id='modalQuantityDisplay' style='display:inline-block; width:40px; text-align:center;'>1</span>\\\n\
        <button id='increaseQty' type='button'>+</button>\\\n\
      </div>\\\n\
      <div class='order-details-panel'>\\\n\
        <h3>Order Details</h3>\\\n\
        <div class='order-item'><label>Price:</label><span class='value' id='itemPrice'>--</span></div>\\\n\
        <div class='order-item'><label>Shipping:</label><span class='value' id='shippingCost'>$0.00</span></div>\\\n\
        <div class='order-item'><label>Returns:</label><span class='value' id='returnPolicy'></span></div>\\\n\
        <div class='shipping-info' id='shippingInfo'><strong>Shipping Information:</strong> If your PayPal shipping address or contact details have changed, please update them at checkout so we send your goodies to the right place!</div>\\\n\
        <div class='subtotal'>Total: <span id='subtotalValue'>$0.00</span></div>\\\n\
      </div>\\\n\
      <div class='modal-actions'>\\\n\
        <button class='buy-now-btn'>Buy Now</button>\\\n\
      </div>\\\n\
    </div>\\\n\
  </div>\\\n\
</div>`;\n";
  
  m += "  document.body.appendChild(modal);\n\n";
  // Append CSS style element for selected options
  m += "  var styleEl = document.createElement('style');\n";
  m += "  styleEl.innerHTML = '.color-options span.selected, .size-options span.selected, .paypal-embed-option span.selected { border: 2px solid #2196f3; background: #eef6ff; }';\n";
  m += "  document.head.appendChild(styleEl);\n\n";
  
  m += "  var productModal = document.getElementById('productModal');\n";
  m += "  var closeBtn = productModal.querySelector('.modal-close');\n";
  m += "  var mainImg = productModal.querySelector('#modalMainImg');\n";
  m += "  var modalTitle = productModal.querySelector('#modalTitle');\n";
  m += "  var modalPrice = productModal.querySelector('#modalPrice');\n";
  m += "  var modalSold = productModal.querySelector('#modalSold');\n";
  m += "  var modalDesc = productModal.querySelector('#modalDescription');\n";
  m += "  var paypalEmbedDiv = productModal.querySelector('#paypalEmbedFields');\n";
  m += "  var itemPrice = productModal.querySelector('#itemPrice');\n";
  m += "  var shippingCost = productModal.querySelector('#shippingCost');\n";
  m += "  var returnPolicy = productModal.querySelector('#returnPolicy');\n";
  m += "  var subtotalValue = productModal.querySelector('#subtotalValue');\n";
  m += "  var arrowLeft = productModal.querySelector('#arrowLeft');\n";
  m += "  var arrowRight = productModal.querySelector('#arrowRight');\n";
  m += "  var thumbsContainer = productModal.querySelector('#modalThumbnails');\n";
  m += "  var buyNowBtn = productModal.querySelector('.buy-now-btn');\n";
  m += "  var quantityWrapper = productModal.querySelector('#quantityWrapper');\n";
  m += "  var decreaseQty = productModal.querySelector('#decreaseQty');\n";
  m += "  var increaseQty = productModal.querySelector('#increaseQty');\n";
  m += "  var modalQuantityDisplay = productModal.querySelector('#modalQuantityDisplay');\n\n";
  
  m += "  var currentProduct = null;\n";
  m += "  var allImages = [];\n";
  m += "  var currentIndex = 0;\n";
  m += "  var basePrice = 0; var shippingFee = 0; var returnsText = 'Accepted';\n";
  m += "  var currentQty = 1;\n\n";
  
  // Order detail update function with quantity handling for PayPal Email
  m += "  function updateOrderDetails(){\n";
  m += "    var qty = (currentProduct && currentProduct.paymentMethod === 'paypalEmail') ? currentQty : 1;\n";
  m += "    var totalPrice = (basePrice * qty) + shippingFee;\n";
  m += "    itemPrice.textContent = getSymbol(currentProduct.currency || '$') + (basePrice * qty).toFixed(2);\n";
  m += "    shippingCost.textContent = (shippingFee === 0) ? 'FREE' : getSymbol(currentProduct.currency || '$') + shippingFee.toFixed(2);\n";
  m += "    returnPolicy.textContent = returnsText;\n";
  m += "    subtotalValue.textContent = getSymbol(currentProduct.currency || '$') + totalPrice.toFixed(2);\n";
  m += "  }\n\n";
  
  // Attach event listeners for quantity control buttons
  m += "  decreaseQty.addEventListener('click', function(){\n";
  m += "    if(currentQty > 1){\n";
  m += "      currentQty--;\n";
  m += "      modalQuantityDisplay.textContent = currentQty;\n";
  m += "      updateOrderDetails();\n";
  m += "    }\n";
  m += "  });\n";
  m += "  increaseQty.addEventListener('click', function(){\n";
  m += "    if(currentQty < 99){\n";
  m += "      currentQty++;\n";
  m += "      modalQuantityDisplay.textContent = currentQty;\n";
  m += "      updateOrderDetails();\n";
  m += "    }\n";
  m += "  });\n\n";
  
  // Function to show image in modal
  m += "  function showImageAt(idx){\n";
  m += "    if(idx < 0 || idx >= allImages.length) return;\n";
  m += "    currentIndex = idx;\n";
  m += "    mainImg.src = allImages[idx];\n";
  m += "    Array.from(thumbsContainer.children).forEach((imgEl, i) => {\n";
  m += "      imgEl.style.borderColor = (i === idx) ? '#2196f3' : 'transparent';\n";
  m += "    });\n";
  m += "  }\n\n";
  
  // Function to open the modal and populate its data
  m += "  function openModal(prod){\n";
  m += "    currentProduct = prod;\n";
  m += "    productModal.style.display = 'flex';\n";
  m += "    // Reset quantity to 1\n";
  m += "    currentQty = 1;\n";
  m += "    modalQuantityDisplay.textContent = currentQty;\n";
  m += "    // Always keep the Buy Now button enabled\n";
  m += "    buyNowBtn.disabled = false;\n";
  m += "    allImages = [];\n";
  m += "    if(prod.images1) allImages.push(prod.images1);\n";
  m += "    if(prod.images2) allImages.push(prod.images2);\n";
  m += "    if(prod.images3) allImages.push(prod.images3);\n";
  m += "    modalTitle.textContent = prod.title || '';\n";
  m += "    modalSold.textContent = prod.sold ? (prod.sold + ' Sold') : '';\n";
  m += "    modalPrice.textContent = getSymbol(prod.currency || '$') + (prod.price || '0');\n";
  m += "    modalDesc.textContent = prod.description || '';\n";
  m += "    basePrice = parseFloat(prod.price) || 0;\n";
  m += "    shippingFee = (prod.shipping === 'FREE') ? 0 : (parseFloat(prod.shipping) || 0);\n";
  m += "    returnsText = prod.returns || 'Accepted';\n";
  m += "    thumbsContainer.innerHTML = '';\n";
  m += "    if(allImages.length > 0){\n";
  m += "      showImageAt(0);\n";
  m += "    } else {\n";
  m += "      mainImg.src = 'https://via.placeholder.com/400?text=No+Image';\n";
  m += "    }\n";
  m += "    for(var i = 0; i < allImages.length; i++){\n";
  m += "      var t = document.createElement('img');\n";
  m += "      t.src = allImages[i];\n";
  m += "      t.dataset.index = i;\n";
  m += "      t.addEventListener('click', function(){ showImageAt(parseInt(this.dataset.index)); });\n";
  m += "      if(i === 0){ t.style.borderColor = '#2196f3'; }\n";
  m += "      thumbsContainer.appendChild(t);\n";
  m += "    }\n\n";
  
  m += "    var attributesContainer = productModal.querySelector('#modalAttributes');\n";
  m += "    if(prod.paymentMethod === 'paypalEmbed'){\n";
  m += "       attributesContainer.style.display = 'none';\n";
  m += "    } else {\n";
  m += "       attributesContainer.style.display = 'block';\n";
  m += "       var colorLabelElem = productModal.querySelector('#modalAttributes .attribute-group:first-child .attribute-label');\n";
  m += "       if(colorLabelElem) { colorLabelElem.textContent = ((prod.colorLabel && prod.colorLabel.trim() !== '') ? prod.colorLabel : 'Color') + ':'; }\n";
  m += "       var sizeLabelElem = productModal.querySelector('#modalAttributes .attribute-group:last-child .attribute-label');\n";
  m += "       if(sizeLabelElem) { sizeLabelElem.textContent = ((prod.sizeLabel && prod.sizeLabel.trim() !== '') ? prod.sizeLabel : 'Size') + ':'; }\n";
  m += "       var colorOptionsContainer = productModal.querySelector('#modalColorOptions');\n";
  m += "       var sizeOptionsContainer = productModal.querySelector('#modalSizeOptions');\n";
  m += "       colorOptionsContainer.innerHTML = '';\n";
  m += "       sizeOptionsContainer.innerHTML = '';\n";
  m += "       if(prod.coloroptions){\n";
  m += "         var colors = prod.coloroptions.split(',').map(s => s.trim()).filter(s => s);\n";
  m += "         colors.forEach(function(color){\n";
  m += "             var span = document.createElement('span');\n";
  m += "             span.textContent = color;\n";
  m += "             if(prod.paymentMethod === 'paypalEmail'){\n";
  m += "                 span.style.cursor = 'pointer';\n";
  m += "                 span.addEventListener('click', function(e){\n";
  m += "                     e.stopPropagation();\n";
  m += "                     Array.from(colorOptionsContainer.getElementsByTagName('span')).forEach(s => s.classList.remove('selected'));\n";
  m += "                     this.classList.add('selected');\n";
  m += "                 });\n";
  m += "             } else {\n";
  m += "                 span.style.cursor = 'default';\n";
  m += "                 span.style.opacity = '0.6';\n";
  m += "             }\n";
  m += "             colorOptionsContainer.appendChild(span);\n";
  m += "         });\n";
  m += "       }\n";
  m += "       if(prod.sizeoptions){\n";
  m += "         var sizes = prod.sizeoptions.split(',').map(s => s.trim()).filter(s => s);\n";
  m += "         sizes.forEach(function(size){\n";
  m += "             var span = document.createElement('span');\n";
  m += "             span.textContent = size;\n";
  m += "             if(prod.paymentMethod === 'paypalEmail'){\n";
  m += "                 span.style.cursor = 'pointer';\n";
  m += "                 span.addEventListener('click', function(e){\n";
  m += "                     e.stopPropagation();\n";
  m += "                     Array.from(sizeOptionsContainer.getElementsByTagName('span')).forEach(s => s.classList.remove('selected'));\n";
  m += "                     this.classList.add('selected');\n";
  m += "                 });\n";
  m += "             } else {\n";
  m += "                 span.style.cursor = 'default';\n";
  m += "                 span.style.opacity = '0.6';\n";
  m += "             }\n";
  m += "             sizeOptionsContainer.appendChild(span);\n";
  m += "         });\n";
  m += "       }\n";
  m += "    }\n";
  m += "    paypalEmbedDiv.innerHTML = '';\n";
  m += "    if(prod.paymentMethod === 'paypalEmbed' && prod.paypalEmbed){\n";
  m += "      var tempDiv = document.createElement('div');\n";
  m += "      tempDiv.innerHTML = prod.paypalEmbed;\n";
  m += "      for(var i = 0; i < 5; i++){\n";
  m += "        var onName = 'on' + i;\n";
  m += "        var osName = 'os' + i;\n";
  m += "        var labelInput = tempDiv.querySelector('input[name=\"' + onName + '\"]');\n";
  m += "        var selectEl = tempDiv.querySelector('select[name=\"' + osName + '\"]');\n";
  m += "        if(labelInput && selectEl){\n";
  m += "          var labelVal = labelInput.value || 'Option';\n";
  m += "          var embedBlock = document.createElement('div');\n";
  m += "          embedBlock.classList.add('paypal-embed-option');\n";
  m += "          var labelElem = document.createElement('label');\n";
  m += "          labelElem.textContent = labelVal + ': ';\n";
  m += "          embedBlock.appendChild(labelElem);\n";
  m += "          var optionContainer = document.createElement('div');\n";
  m += "          optionContainer.style.marginTop = '5px';\n";
  m += "          var opts = selectEl.querySelectorAll('option');\n";
  m += "          opts.forEach(function(opt){\n";
  m += "            var sp = document.createElement('span');\n";
  m += "            sp.textContent = opt.value;\n";
  m += "            sp.addEventListener('click', function(e){\n";
  m += "              e.stopPropagation();\n";
  m += "              Array.from(optionContainer.querySelectorAll('span')).forEach(s => s.classList.remove('selected'));\n";
  m += "              this.classList.add('selected');\n";
  m += "            });\n";
  m += "            optionContainer.appendChild(sp);\n";
  m += "          });\n";
  m += "          embedBlock.appendChild(optionContainer);\n";
  m += "          paypalEmbedDiv.appendChild(embedBlock);\n";
  m += "        }\n";
  m += "      }\n";
  m += "    }\n\n";
  m += "    if(prod.paymentMethod === 'paypalEmail'){\n";
  m += "      var hiddenFormSelects = {};\n";
  m += "      if(prod.coloroptions){\n";
  m += "        var colorSelect = document.createElement('select');\n";
  m += "        colorSelect.name = 'os0';\n";
  m += "        var colors = prod.coloroptions.split(',').map(s => s.trim()).filter(s => s);\n";
  m += "        colors.forEach(function(color){\n";
  m += "          var opt = document.createElement('option');\n";
  m += "          opt.value = color;\n";
  m += "          opt.textContent = color;\n";
  m += "          colorSelect.appendChild(opt);\n";
  m += "        });\n";
  m += "        var selectedColor = productModal.querySelector('#modalColorOptions span.selected');\n";
  m += "        if(selectedColor){ colorSelect.value = selectedColor.textContent; }\n";
  m += "        hiddenFormSelects.colorSelect = colorSelect;\n";
  m += "      }\n";
  m += "      if(prod.sizeoptions){\n";
  m += "        var sizeSelect = document.createElement('select');\n";
  m += "        sizeSelect.name = 'os1';\n";
  m += "        var sizes = prod.sizeoptions.split(',').map(s => s.trim()).filter(s => s);\n";
  m += "        sizes.forEach(function(size){\n";
  m += "          var opt = document.createElement('option');\n";
  m += "          opt.value = size;\n";
  m += "          opt.textContent = size;\n";
  m += "          sizeSelect.appendChild(opt);\n";
  m += "        });\n";
  m += "        var selectedSize = productModal.querySelector('#modalSizeOptions span.selected');\n";
  m += "        if(selectedSize){ sizeSelect.value = selectedSize.textContent; }\n";
  m += "        hiddenFormSelects.sizeSelect = sizeSelect;\n";
  m += "      }\n";
  m += "    } else { /* If not paypalEmail, no hidden selects needed */ }\n\n";
  m += "    if(prod.paymentMethod === 'paypalEmail'){\n";
  m += "      quantityWrapper.style.display = 'block';\n";
  m += "    } else {\n";
  m += "      quantityWrapper.style.display = 'none';\n";
  m += "    }\n\n";
  m += "    updateOrderDetails();\n";
  m += "  }\n\n";
  
  m += "  document.querySelectorAll('.product-item').forEach(function(pi){\n";
  m += "    var pd = {};\n";
  m += "    pd.title = pi.getAttribute('data-title') || '';\n";
  m += "    pd.sold = pi.getAttribute('data-sold') || '';\n";
  m += "    pd.price = pi.getAttribute('data-price') || '0';\n";
  m += "    pd.currency = pi.getAttribute('data-currency') || '$';\n";
  m += "    pd.description = pi.getAttribute('data-description') || '';\n";
  m += "    pd.shipping = pi.getAttribute('data-shipping') || 'FREE';\n";
  m += "    pd.returns = pi.getAttribute('data-returns') || 'Accepted';\n";
  m += "    pd.coloroptions = pi.getAttribute('data-coloroptions') || '';\n";
  m += "    pd.sizeoptions = pi.getAttribute('data-sizeoptions') || '';\n";
  m += "    pd.colorLabel = pi.getAttribute('data-colorlabel') || '';\n";
  m += "    pd.sizeLabel = pi.getAttribute('data-sizelabel') || '';\n";
  m += "    pd.images1 = pi.getAttribute('data-images1') || '';\n";
  m += "    pd.images2 = pi.getAttribute('data-images2') || '';\n";
  m += "    pd.images3 = pi.getAttribute('data-images3') || '';\n";
  m += "    pd.paymentMethod = pi.getAttribute('data-paymentmethod') || '';\n";
  m += "    pd.paypalLink = pi.getAttribute('data-paypallink') || '';\n";
  m += "    pd.paypalEmbed = pi.getAttribute('data-paypalembed') || '';\n";
  m += "    pd.otherPaymentLink = pi.getAttribute('data-otherpaymentlink') || '';\n";
  m += "    pd.paypalEmail = pi.getAttribute('data-paypalemail') || '';\n\n";
  m += "    pi.addEventListener('click', function(){ openModal(pd); });\n";
  m += "    var buy = pi.querySelector('.buy-now');\n";
  m += "    if(buy){\n";
  m += "      buy.addEventListener('click', function(e){\n";
  m += "        e.preventDefault(); e.stopPropagation();\n";
  m += "        openModal(pd);\n";
  m += "      });\n";
  m += "    }\n";
  m += "  });\n\n";
  
  m += "  closeBtn.onclick = function(){ productModal.style.display = 'none'; };\n";
  m += "  modal.addEventListener('click', function(e){ if(e.target === modal){ modal.style.display = 'none'; } });\n";
  m += "  arrowLeft.onclick = function(){ if(currentIndex > 0){ showImageAt(currentIndex - 1); } };\n";
  m += "  arrowRight.onclick = function(){ if(currentIndex < allImages.length - 1){ showImageAt(currentIndex + 1); } };\n\n";
  
  m += "  buyNowBtn.onclick = function(){\n";
  m += "    if(!currentProduct)return;\n";
  m += "    if(currentProduct.paymentMethod === 'paypalLink'){\n";
  m += "      window.open(currentProduct.paypalLink, '_blank');\n";
  m += "    } else if(currentProduct.paymentMethod === 'paypalEmbed'){\n";
  m += "      if(!checkEmbedSelections()) return;\n";
  m += "      var hiddenForm = document.createElement('form');\n";
  m += "      hiddenForm.method = 'POST';\n";
  m += "      hiddenForm.action = 'https://www.paypal.com/cgi-bin/webscr';\n";
  m += "      hiddenForm.style.display = 'none';\n";
  m += "      var tempDiv = document.createElement('div');\n";
  m += "      tempDiv.innerHTML = currentProduct.paypalEmbed;\n";
  m += "      var formInputs = tempDiv.querySelectorAll('input, select');\n";
  m += "      formInputs.forEach(function(fi){ hiddenForm.appendChild(fi.cloneNode(true)); });\n";
  m += "      var embedFields = document.querySelector('#paypalEmbedFields');\n";
  m += "      for(var i = 0; i < 5; i++){\n";
  m += "        var onName = 'on' + i;\n";
  m += "        var osName = 'os' + i;\n";
  m += "        var labelInput = hiddenForm.querySelector('input[name=\"' + onName + '\"]');\n";
  m += "        var selectEl = hiddenForm.querySelector('select[name=\"' + osName + '\"]');\n";
  m += "        if(labelInput && selectEl){\n";
  m += "          var blocks = embedFields.getElementsByClassName('paypal-embed-option');\n";
  m += "          if(blocks[i]){\n";
  m += "            var sel = blocks[i].querySelector('span.selected');\n";
  m += "            if(sel){ selectEl.value = sel.textContent; }\n";
  m += "          }\n";
  m += "        }\n";
  m += "      }\n";
  m += "      document.body.appendChild(hiddenForm);\n";
  m += "      hiddenForm.submit();\n";
  m += "    } else if(currentProduct.paymentMethod === 'other'){\n";
  m += "      if(currentProduct.otherPaymentLink){ window.open(currentProduct.otherPaymentLink, '_blank'); }\n";
  m += "      else { alert('No other payment link provided.'); }\n";
  m += "    } else if(currentProduct.paymentMethod === 'paypalEmail'){\n";
  m += "      var selectedColorEl = productModal.querySelector('#modalColorOptions span.selected');\n";
  m += "      var selectedSizeEl = productModal.querySelector('#modalSizeOptions span.selected');\n";
  m += "      if(!selectedColorEl || !selectedSizeEl){\n";
  m += "         alert('Please select a color and size before proceeding.');\n";
  m += "         return;\n";
  m += "      }\n";
  m += "      var quantity = parseInt(currentQty, 10);\n";
  m += "      if(isNaN(quantity) || quantity < 1){ quantity = 1; }\n";
  m += "      var total = (basePrice * quantity) + shippingFee;\n";
  m += "      var hiddenForm = document.createElement('form');\n";
  m += "      hiddenForm.method = 'POST';\n";
  m += "      hiddenForm.action = 'https://www.paypal.com/cgi-bin/webscr';\n";
  m += "      hiddenForm.style.display = 'none';\n";
  m += "      var fields = [\n";
  m += "        { name: 'cmd', value: '_xclick' },\n";
  m += "        { name: 'business', value: currentProduct.paypalEmail },\n";
  m += "        { name: 'currency_code', value: (currentProduct.currency && currentProduct.currency.length <= 3) ? currentProduct.currency : 'USD' },\n";
  m += "        { name: 'amount', value: total.toFixed(2) }\n";
  m += "      ];\n";
  m += "      fields.forEach(function(f){\n";
  m += "        var inp = document.createElement('input');\n";
  m += "        inp.type = 'hidden';\n";
  m += "        inp.name = f.name;\n";
  m += "        inp.value = f.value;\n";
  m += "        hiddenForm.appendChild(inp);\n";
  m += "      });\n";
  m += "      var itemName = currentProduct.title || 'Product';\n";
  m += "      itemName += ' ' + selectedColorEl.textContent;\n";
  m += "      itemName += ' ' + selectedSizeEl.textContent;\n";
  m += "      itemName += ' Quantity ' + quantity;\n";
  m += "      var itemNameInp = document.createElement('input');\n";
  m += "      itemNameInp.type = 'hidden';\n";
  m += "      itemNameInp.name = 'item_name';\n";
  m += "      itemNameInp.value = itemName;\n";
  m += "      hiddenForm.appendChild(itemNameInp);\n";
  m += "      document.body.appendChild(hiddenForm);\n";
  m += "      hiddenForm.submit();\n";
  m += "    } else {\n";
  m += "      alert('Payment method not configured.');\n";
  m += "    }\n";
  m += "  };\n\n";
  
  m += "  document.querySelectorAll('.product-item').forEach(function(pi){\n";
  m += "    var pd = {};\n";
  m += "    pd.title = pi.getAttribute('data-title') || '';\n";
  m += "    pd.sold = pi.getAttribute('data-sold') || '';\n";
  m += "    pd.price = pi.getAttribute('data-price') || '0';\n";
  m += "    pd.currency = pi.getAttribute('data-currency') || '$';\n";
  m += "    pd.description = pi.getAttribute('data-description') || '';\n";
  m += "    pd.shipping = pi.getAttribute('data-shipping') || 'FREE';\n";
  m += "    pd.returns = pi.getAttribute('data-returns') || 'Accepted';\n";
  m += "    pd.coloroptions = pi.getAttribute('data-coloroptions') || '';\n";
  m += "    pd.sizeoptions = pi.getAttribute('data-sizeoptions') || '';\n";
  m += "    pd.colorLabel = pi.getAttribute('data-colorlabel') || '';\n";
  m += "    pd.sizeLabel = pi.getAttribute('data-sizelabel') || '';\n";
  m += "    pd.images1 = pi.getAttribute('data-images1') || '';\n";
  m += "    pd.images2 = pi.getAttribute('data-images2') || '';\n";
  m += "    pd.images3 = pi.getAttribute('data-images3') || '';\n";
  m += "    pd.paymentMethod = pi.getAttribute('data-paymentmethod') || '';\n";
  m += "    pd.paypalLink = pi.getAttribute('data-paypallink') || '';\n";
  m += "    pd.paypalEmbed = pi.getAttribute('data-paypalembed') || '';\n";
  m += "    pd.otherPaymentLink = pi.getAttribute('data-otherpaymentlink') || '';\n";
  m += "    pd.paypalEmail = pi.getAttribute('data-paypalemail') || '';\n\n";
  m += "    pi.addEventListener('click', function(){ openModal(pd); });\n";
  m += "    var buy = pi.querySelector('.buy-now');\n";
  m += "    if(buy){\n";
  m += "      buy.addEventListener('click', function(e){\n";
  m += "        e.preventDefault(); e.stopPropagation();\n";
  m += "        openModal(pd);\n";
  m += "      });\n";
  m += "    }\n";
  m += "  });\n\n";
  
  m += "  closeBtn.onclick = function(){ productModal.style.display = 'none'; };\n";
  m += "  modal.addEventListener('click', function(e){ if(e.target === modal){ modal.style.display = 'none'; } });\n";
  m += "  arrowLeft.onclick = function(){ if(currentIndex > 0){ showImageAt(currentIndex - 1); } };\n";
  m += "  arrowRight.onclick = function(){ if(currentIndex < allImages.length - 1){ showImageAt(currentIndex + 1); } };\n\n";
  
  m += "  buyNowBtn.onclick = function(){\n";
  m += "    if(!currentProduct)return;\n";
  m += "    if(currentProduct.paymentMethod === 'paypalLink'){\n";
  m += "      window.open(currentProduct.paypalLink, '_blank');\n";
  m += "    } else if(currentProduct.paymentMethod === 'paypalEmbed'){\n";
  m += "      if(!checkEmbedSelections()) return;\n";
  m += "      var hiddenForm = document.createElement('form');\n";
  m += "      hiddenForm.method = 'POST';\n";
  m += "      hiddenForm.action = 'https://www.paypal.com/cgi-bin/webscr';\n";
  m += "      hiddenForm.style.display = 'none';\n";
  m += "      var tempDiv = document.createElement('div');\n";
  m += "      tempDiv.innerHTML = currentProduct.paypalEmbed;\n";
  m += "      var formInputs = tempDiv.querySelectorAll('input, select');\n";
  m += "      formInputs.forEach(function(fi){ hiddenForm.appendChild(fi.cloneNode(true)); });\n";
  m += "      var embedFields = document.querySelector('#paypalEmbedFields');\n";
  m += "      for(var i = 0; i < 5; i++){\n";
  m += "        var onName = 'on' + i;\n";
  m += "        var osName = 'os' + i;\n";
  m += "        var labelInput = hiddenForm.querySelector('input[name=\"' + onName + '\"]');\n";
  m += "        var selectEl = hiddenForm.querySelector('select[name=\"' + osName + '\"]');\n";
  m += "        if(labelInput && selectEl){\n";
  m += "          var blocks = embedFields.getElementsByClassName('paypal-embed-option');\n";
  m += "          if(blocks[i]){\n";
  m += "            var sel = blocks[i].querySelector('span.selected');\n";
  m += "            if(sel){ selectEl.value = sel.textContent; }\n";
  m += "          }\n";
  m += "        }\n";
  m += "      }\n";
  m += "      document.body.appendChild(hiddenForm);\n";
  m += "      hiddenForm.submit();\n";
  m += "    } else if(currentProduct.paymentMethod === 'other'){\n";
  m += "      if(currentProduct.otherPaymentLink){ window.open(currentProduct.otherPaymentLink, '_blank'); }\n";
  m += "      else { alert('No other payment link provided.'); }\n";
  m += "    } else if(currentProduct.paymentMethod === 'paypalEmail'){\n";
  m += "      var selectedColorEl = productModal.querySelector('#modalColorOptions span.selected');\n";
  m += "      var selectedSizeEl = productModal.querySelector('#modalSizeOptions span.selected');\n";
  m += "      if(!selectedColorEl || !selectedSizeEl){\n";
  m += "         alert('Please select a color and size before proceeding.');\n";
  m += "         return;\n";
  m += "      }\n";
  m += "      var quantity = parseInt(currentQty, 10);\n";
  m += "      if(isNaN(quantity) || quantity < 1){ quantity = 1; }\n";
  m += "      var total = (basePrice * quantity) + shippingFee;\n";
  m += "      var hiddenForm = document.createElement('form');\n";
  m += "      hiddenForm.method = 'POST';\n";
  m += "      hiddenForm.action = 'https://www.paypal.com/cgi-bin/webscr';\n";
  m += "      hiddenForm.style.display = 'none';\n";
  m += "      var fields = [\n";
  m += "        { name: 'cmd', value: '_xclick' },\n";
  m += "        { name: 'business', value: currentProduct.paypalEmail },\n";
  m += "        { name: 'currency_code', value: (currentProduct.currency && currentProduct.currency.length <= 3) ? currentProduct.currency : 'USD' },\n";
  m += "        { name: 'amount', value: total.toFixed(2) }\n";
  m += "      ];\n";
  m += "      fields.forEach(function(f){\n";
  m += "        var inp = document.createElement('input');\n";
  m += "        inp.type = 'hidden';\n";
  m += "        inp.name = f.name;\n";
  m += "        inp.value = f.value;\n";
  m += "        hiddenForm.appendChild(inp);\n";
  m += "      });\n";
  m += "      var itemName = currentProduct.title || 'Product';\n";
  m += "      itemName += ' ' + selectedColorEl.textContent;\n";
  m += "      itemName += ' ' + selectedSizeEl.textContent;\n";
  m += "      itemName += ' Quantity ' + quantity;\n";
  m += "      var itemNameInp = document.createElement('input');\n";
  m += "      itemNameInp.type = 'hidden';\n";
  m += "      itemNameInp.name = 'item_name';\n";
  m += "      itemNameInp.value = itemName;\n";
  m += "      hiddenForm.appendChild(itemNameInp);\n";
  m += "      document.body.appendChild(hiddenForm);\n";
  m += "      hiddenForm.submit();\n";
  m += "    } else {\n";
  m += "      alert('Payment method not configured.');\n";
  m += "    }\n";
  m += "  };\n\n";
  
  m += "  document.querySelectorAll('.product-item').forEach(function(pi){\n";
  m += "    var pd = {};\n";
  m += "    pd.title = pi.getAttribute('data-title') || '';\n";
  m += "    pd.sold = pi.getAttribute('data-sold') || '';\n";
  m += "    pd.price = pi.getAttribute('data-price') || '0';\n";
  m += "    pd.currency = pi.getAttribute('data-currency') || '$';\n";
  m += "    pd.description = pi.getAttribute('data-description') || '';\n";
  m += "    pd.shipping = pi.getAttribute('data-shipping') || 'FREE';\n";
  m += "    pd.returns = pi.getAttribute('data-returns') || 'Accepted';\n";
  m += "    pd.coloroptions = pi.getAttribute('data-coloroptions') || '';\n";
  m += "    pd.sizeoptions = pi.getAttribute('data-sizeoptions') || '';\n";
  m += "    pd.colorLabel = pi.getAttribute('data-colorlabel') || '';\n";
  m += "    pd.sizeLabel = pi.getAttribute('data-sizelabel') || '';\n";
  m += "    pd.images1 = pi.getAttribute('data-images1') || '';\n";
  m += "    pd.images2 = pi.getAttribute('data-images2') || '';\n";
  m += "    pd.images3 = pi.getAttribute('data-images3') || '';\n";
  m += "    pd.paymentMethod = pi.getAttribute('data-paymentmethod') || '';\n";
  m += "    pd.paypalLink = pi.getAttribute('data-paypallink') || '';\n";
  m += "    pd.paypalEmbed = pi.getAttribute('data-paypalembed') || '';\n";
  m += "    pd.otherPaymentLink = pi.getAttribute('data-otherpaymentlink') || '';\n";
  m += "    pd.paypalEmail = pi.getAttribute('data-paypalemail') || '';\n\n";
  m += "    pi.addEventListener('click', function(){ openModal(pd); });\n";
  m += "    var buy = pi.querySelector('.buy-now');\n";
  m += "    if(buy){\n";
  m += "      buy.addEventListener('click', function(e){\n";
  m += "        e.preventDefault(); e.stopPropagation();\n";
  m += "        openModal(pd);\n";
  m += "      });\n";
  m += "    }\n";
  m += "  });\n\n";
  
  m += "  closeBtn.onclick = function(){ productModal.style.display = 'none'; };\n";
  m += "  modal.addEventListener('click', function(e){ if(e.target === modal){ modal.style.display = 'none'; } });\n";
  m += "  arrowLeft.onclick = function(){ if(currentIndex > 0){ showImageAt(currentIndex - 1); } };\n";
  m += "  arrowRight.onclick = function(){ if(currentIndex < allImages.length - 1){ showImageAt(currentIndex + 1); } };\n\n";
  
  m += "  buyNowBtn.onclick = function(){\n";
  m += "    if(!currentProduct)return;\n";
  m += "    if(currentProduct.paymentMethod === 'paypalLink'){\n";
  m += "      window.open(currentProduct.paypalLink, '_blank');\n";
  m += "    } else if(currentProduct.paymentMethod === 'paypalEmbed'){\n";
  m += "      if(!checkEmbedSelections()) return;\n";
  m += "      var hiddenForm = document.createElement('form');\n";
  m += "      hiddenForm.method = 'POST';\n";
  m += "      hiddenForm.action = 'https://www.paypal.com/cgi-bin/webscr';\n";
  m += "      hiddenForm.style.display = 'none';\n";
  m += "      var tempDiv = document.createElement('div');\n";
  m += "      tempDiv.innerHTML = currentProduct.paypalEmbed;\n";
  m += "      var formInputs = tempDiv.querySelectorAll('input, select');\n";
  m += "      formInputs.forEach(function(fi){ hiddenForm.appendChild(fi.cloneNode(true)); });\n";
  m += "      var embedFields = document.querySelector('#paypalEmbedFields');\n";
  m += "      for(var i = 0; i < 5; i++){\n";
  m += "        var onName = 'on' + i;\n";
  m += "        var osName = 'os' + i;\n";
  m += "        var labelInput = hiddenForm.querySelector('input[name=\"' + onName + '\"]');\n";
  m += "        var selectEl = hiddenForm.querySelector('select[name=\"' + osName + '\"]');\n";
  m += "        if(labelInput && selectEl){\n";
  m += "          var blocks = embedFields.getElementsByClassName('paypal-embed-option');\n";
  m += "          if(blocks[i]){\n";
  m += "            var sel = blocks[i].querySelector('span.selected');\n";
  m += "            if(sel){ selectEl.value = sel.textContent; }\n";
  m += "          }\n";
  m += "        }\n";
  m += "      }\n";
  m += "      document.body.appendChild(hiddenForm);\n";
  m += "      hiddenForm.submit();\n";
  m += "    } else if(currentProduct.paymentMethod === 'other'){\n";
  m += "      if(currentProduct.otherPaymentLink){ window.open(currentProduct.otherPaymentLink, '_blank'); }\n";
  m += "      else { alert('No other payment link provided.'); }\n";
  m += "    } else if(currentProduct.paymentMethod === 'paypalEmail'){\n";
m += "      var selectedColorEl = productModal.querySelector('#modalColorOptions span.selected');\n";
m += "      if(!selectedColorEl){\n";
m += "         alert('Please select a color before proceeding.');\n";
m += "         return;\n";
m += "      }\n";
m += "      var quantity = parseInt(currentQty, 10);\n";
m += "      if(isNaN(quantity) || quantity < 1){ quantity = 1; }\n";
m += "      var total = (basePrice * quantity) + shippingFee;\n";
m += "      var hiddenForm = document.createElement('form');\n";
m += "      hiddenForm.method = 'POST';\n";
m += "      hiddenForm.action = 'https://www.paypal.com/cgi-bin/webscr';\n";
m += "      hiddenForm.style.display = 'none';\n";
m += "      var fields = [\n";
m += "        { name: 'cmd', value: '_xclick' },\n";
m += "        { name: 'business', value: currentProduct.paypalEmail },\n";
m += "        { name: 'currency_code', value: (currentProduct.currency && currentProduct.currency.length <= 3) ? currentProduct.currency : 'USD' },\n";
m += "        { name: 'amount', value: total.toFixed(2) }\n";
m += "      ];\n";
m += "      fields.forEach(function(f){\n";
m += "        var inp = document.createElement('input');\n";
m += "        inp.type = 'hidden';\n";
m += "        inp.name = f.name;\n";
m += "        inp.value = f.value;\n";
m += "        hiddenForm.appendChild(inp);\n";
m += "      });\n";
m += "      var itemName = currentProduct.title || 'Product';\n";
m += "      itemName += ' ' + selectedColorEl.textContent;\n";
m += "      itemName += ' Quantity ' + quantity;\n";
m += "      var itemNameInp = document.createElement('input');\n";
m += "      itemNameInp.type = 'hidden';\n";
m += "      itemNameInp.name = 'item_name';\n";
m += "      itemNameInp.value = itemName;\n";
m += "      hiddenForm.appendChild(itemNameInp);\n";
m += "      document.body.appendChild(hiddenForm);\n";
m += "      hiddenForm.submit();\n";
m += "    } else {\n";
m += "      alert('Payment method not configured.');\n";
m += "    }\n";
m += "  };\n";
m += "})();";
  m += "</scr" + "ipt>";

  return m;
}
    
    function updateProductBuyNowStyles(){
  productBuyNowBgColor = document.getElementById('buyNowBgColorPicker').value;
  productBuyNowTextColor = document.getElementById('buyNowTextColorPicker').value;
  // Read the border radius from the slider in the modal
  productBuyNowBorderRadius = document.getElementById('borderRadiusSlider').value;
  
  // Update the border preview element (using the correct ID)
  document.getElementById('borderPreview').style.borderRadius = productBuyNowBorderRadius + "px";
  
  // Refresh the website preview so the changes take effect
  updatePreview();
}
    
    function updateHeroTitleColor(){
  heroData.heroTitleColor = document.getElementById('heroTitleColorPicker').value;
  updatePreview();
}

function updateCTAButtonColors(){
  heroData.ctaBgColor = document.getElementById('ctaBgColorPicker').value;
  heroData.ctaTextColor = document.getElementById('ctaTextColorPicker').value;
  updatePreview();
}



    
function shadeColor(color, percent) {
  var num = parseInt(color.slice(1),16),
      amt = Math.round(2.55 * percent),
      R = (num >> 16) + amt,
      G = (num >> 8 & 0x00FF) + amt,
      B = (num & 0x0000FF) + amt;
  return "#" + (
    0x1000000 +
    (R < 255 ? (R < 1 ? 0 : R) : 255) * 0x10000 +
    (G < 255 ? (G < 1 ? 0 : G) : 255) * 0x100 +
    (B < 255 ? (B < 1 ? 0 : B) : 255)
  ).toString(16).slice(1);
}


function toggleFontDropdown() {
  var dropdown = document.getElementById('fontDropdown');
  if (dropdown.style.display === "none" || dropdown.style.display === "") {
    dropdown.style.display = "block";
  } else {
    dropdown.style.display = "none";
  }
}



function selectHeroFont(fontName) {
  heroTitleFont = fontName;      // update global variable
  updatePreview();               // refresh preview so new font is applied
  document.getElementById('fontDropdown').style.display = "none"; // close dropdown
}

// Populate the dropdown with font options on page load
window.addEventListener('load', function(){
  // List of fonts: 10 modern fonts from your snippet + the extra fonts
  var fonts = [
    "Roboto",          // modern
    "Open Sans",       // modern
    "Lato",            // modern
    "Montserrat",      // modern
    "Source Sans Pro", // modern
    "Raleway",         // modern
    "Ubuntu",          // modern
    "Poppins",         // modern
    "Merriweather",    // modern
    "Oswald",          // modern
    "Patrick Hand",    // extra
    "Indie Flower",    // extra
    "Shadows Into Light", // extra
    "Dancing Script",  // extra
    "Homemade Apple",  // extra
    "Caveat",          // extra
    "Sacramento",      // extra
    "Gloria Hallelujah", // extra
    "Handlee",         // extra
    "Reenie Beanie",   // extra
    "Pacifico",        // extra
    "Lobster",         // extra
    "Amatic SC",       // extra
    "Satisfy",         // extra
    "Cookie"           // extra
  ];
  var dropdown = document.getElementById('fontDropdown');
  fonts.forEach(function(font) {
    var option = document.createElement('div');
    option.textContent = font;
    option.style.fontFamily = font; // preview the font
    option.onclick = function() {
      selectHeroFont(font);
    };
    dropdown.appendChild(option);
  });
});


// Close the dropdown if clicking outside of it
document.addEventListener('click', function(e) {
  var dropdown = document.getElementById('fontDropdown');
  var fontButton = document.getElementById('heroFontButton');
  if (dropdown && !dropdown.contains(e.target) && e.target !== fontButton) {
    dropdown.style.display = "none";
  }
});





  function getCurrencySymbol(code){
    const sym = {
      USD:"$", EUR:"‚Ç¨", GBP:"¬£", JPY:"¬•", AUD:"A$", CAD:"C$", CHF:"CHF",
      CNY:"¬•", HKD:"HK$", NZD:"NZ$"
    };
    if(sym[code.toUpperCase()]) return sym[code.toUpperCase()];
    return code + " ";
  }

  function escapeHTML(str){
    if(!str) return "";
    return str.replace(/[<>"'&]/g, function(c){
      switch(c){
        case '<': return '&lt;';
        case '>': return '&gt;';
        case '"': return '&quot;';
        case "'": return '&#39;';
        case '&': return '&amp;';
      }
    });
  }

  function updateManagementLists(){
    const cont = document.getElementById('managementContainer');
    if(!cont) return;
    cont.innerHTML = "";

    if(products.length > 0){
      const pDiv = document.createElement('div');
      pDiv.innerHTML = "<h3>Products in Website</h3>";
      products.forEach((prod, idx) => {
        const row = document.createElement('div');
        row.classList.add('builder-item-row');
        row.innerHTML = `<span>${escapeHTML(prod.title || "Untitled")}</span>`;
        const delBtn = document.createElement('button');
        delBtn.classList.add('delete-btn');
        delBtn.textContent = "√ó";
        delBtn.onclick = function(){
          products.splice(idx, 1);
          updatePreview();
          updateManagementLists();
        };
        row.appendChild(delBtn);
        pDiv.appendChild(row);
      });
      cont.appendChild(pDiv);
    }

    if(reviews.length > 0){
      const rDiv = document.createElement('div');
      rDiv.innerHTML = "<h3>Reviews in Website</h3>";
      reviews.forEach((rev, idx) => {
        const row = document.createElement('div');
        row.classList.add('builder-item-row');
        row.innerHTML = `<span>${escapeHTML(rev.name || "Unnamed")}</span>`;
        const delBtn = document.createElement('button');
        delBtn.classList.add('delete-btn');
        delBtn.textContent = "√ó";
        delBtn.onclick = function(){
          reviews.splice(idx, 1);
          updatePreview();
          updateManagementLists();
        };
        row.appendChild(delBtn);
        rDiv.appendChild(row);
      });
      cont.appendChild(rDiv);
    }

    if(contactData.formEmbed){
      const cfDiv = document.createElement('div');
      cfDiv.innerHTML = "<h3>Contact Form</h3><span>Contact Form</span>";
      const delBtn = document.createElement('button');
      delBtn.classList.add('delete-btn');
      delBtn.textContent = "√ó";
      delBtn.onclick = function(){
        contactData.formEmbed = "";
        const addBtn = document.getElementById('addContactFormButton');
        if(addBtn){
          addBtn.classList.remove('success');
          addBtn.textContent = "Add Form";
        }
        updatePreview();
        updateManagementLists();
      };
      cfDiv.appendChild(delBtn);
      cont.appendChild(cfDiv);
    }
  }

  // ---- Payment Button Logic ----
  document.getElementById('payBtn').onclick = function(){
    if(!checkMandatory()){
      alert("Please fill in all mandatory fields before proceeding with payment.");
      return;
    }
    var paypalPopup = window.open(
      "https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&business=workpoost%40gmail.com&item_name=Website+Builder+Download&amount=12&currency_code=EUR",
      "_blank",
      "width=500,height=700"
    );
    var startTime = Date.now();
    var thresholdTime = 10000; // 10 seconds
    var popupTimer = setInterval(function(){
      if(paypalPopup && paypalPopup.closed){
        clearInterval(popupTimer);
        var elapsedTime = Date.now() - startTime;
        if(elapsedTime >= thresholdTime){
          document.getElementById('emailVerificationRow').style.display = 'flex';
        } else {
          alert("Payment was not completed. Please try again.");
        }
      }
    }, 500);
  };

  document.getElementById('verifyEmailBtn').onclick = function(){
    var email = document.getElementById('verificationEmail').value.trim();
    if(email === ""){
      alert("Please enter your email for verification.");
      return;
    }
    var payBtn = document.getElementById('payBtn');
    payBtn.innerHTML = "Payment Successful";
    payBtn.style.background = "green";
    payBtn.disabled = true;
    document.getElementById('downloadRow').style.display = 'flex';
    document.getElementById('emailVerificationRow').style.display = 'none';
  };

  // Code Modal
  function openCodeModal(){
    if(!finalHTML.trim()){
      finalHTML = buildFinalHTML();
    }
    var codeOutput = document.getElementById('codeOutput');
    codeOutput.value = finalHTML;
    document.getElementById('codeModal').style.display = 'flex';
  }
  window.openCodeModal = openCodeModal;

  document.getElementById('copyCodeButton').onclick = function(){
    var codeOutput = document.getElementById('codeOutput');
    codeOutput.select();
    document.execCommand('copy');
    this.textContent = "Copied!";
    setTimeout(() => {
      this.textContent = "Copy Code";
    }, 2000);
  };
  document.getElementById('closeCodeModal').onclick = function(){
    document.getElementById('codeModal').style.display = 'none';
  };

  // Exit Confirmation
  document.addEventListener('DOMContentLoaded', function(){
    const exitModalOverlay = document.getElementById('exitConfirm-modalOverlay');
    const exitModal = document.getElementById('exitConfirm-modal');
    if(!exitModalOverlay || !exitModal) return;

    const stayButton = document.getElementById('exitConfirm-stayButton');
    const leaveButton = document.getElementById('exitConfirm-leaveButton');
    let intendedAction = null;

    function showExitModal(action){
      intendedAction = action;
      exitModalOverlay.style.display = 'flex';
    }
    function hideExitModal(){
      exitModalOverlay.style.display = 'none';
      intendedAction = null;
    }
    stayButton.addEventListener('click', function(){
      hideExitModal();
    });
    leaveButton.addEventListener('click', function(){
      hideExitModal();
      if(typeof intendedAction === 'function'){
        intendedAction();
      } else if(typeof intendedAction === 'string'){
        window.location.href = intendedAction;
      }
    });

    const links = document.querySelectorAll('a');
    links.forEach(function(link){
      link.addEventListener('click', function(e){
        if(this.hasAttribute('data-ignore-exit-confirm')) return;
        e.preventDefault();
        const href = this.getAttribute('href');
        showExitModal(function(){ window.location.href = href; });
      });
    });
    const forms = document.querySelectorAll('form');
    forms.forEach(function(form){
      form.addEventListener('submit', function(e){
        if(this.hasAttribute('data-ignore-exit-confirm')) return;
        e.preventDefault();
        showExitModal(function(){ form.submit(); });
      });
    });
    window.addEventListener('beforeunload', function(e){
      if(exitModalOverlay.style.display === 'flex'){
        return;
      }
      e.preventDefault();
      e.returnValue = '';
    });
  });

  // Contact Form Modal
  function setupContactFormModal(){
    var modal = document.getElementById('contactFormModal');
    var openBtn = document.getElementById('addContactFormButton');
    var closeBtn = document.getElementById('closeContactFormModal');
    var confirmBtn = document.getElementById('confirmAddContactFormButton');
    var textarea = document.getElementById('contactFormIframe');

    if(!modal || !openBtn) return;

    openBtn.onclick = function(){
      if(contactData.formEmbed){
        alert("A contact form is already added. You can delete it before adding a new one.");
        return;
      }
      modal.style.display = 'flex';
    };
    closeBtn.onclick = function(){
      modal.style.display = 'none';
    };
    confirmBtn.onclick = function(){
      const embedCode = textarea.value.trim();
      if(embedCode){
        contactData.formEmbed = embedCode;
        modal.style.display = 'none';
        textarea.value = '';
        openBtn.classList.add('success');
        openBtn.textContent = 'Form Added';
        const statusDiv = document.getElementById('contactFormStatus');
        statusDiv.innerHTML = '';
        const delFormBtn = document.createElement('button');
        delFormBtn.textContent = 'Delete Form';
        delFormBtn.style.background = 'red';
        delFormBtn.style.color = '#fff';
        delFormBtn.style.border = 'none';
        delFormBtn.style.cursor = 'pointer';
        delFormBtn.style.borderRadius = '4px';
        delFormBtn.style.padding = '5px 10px';
        delFormBtn.onclick = function(){
          contactData.formEmbed = '';
          openBtn.classList.remove('success');
          openBtn.textContent = 'Add Form';
          statusDiv.innerHTML = '';
          updatePreview();
        };
        statusDiv.appendChild(delFormBtn);
        updatePreview();
        updateManagementLists();
      } else {
        alert("Please paste your contact form embed code.");
      }
    };
    window.onclick = function(event){
      if(event.target === modal){
        modal.style.display = 'none';
      }
    };
  }

    document.getElementById('productCurrency').addEventListener('change', function() {
  defaultCurrency = this.value;
  defaultCurrencyCode = this.getAttribute('data-code') || '';
});
    
    document.getElementById('cornerPickerWrapper').addEventListener('click', function(e) {
  // Set the slider to the current border radius value
  document.getElementById('borderRadiusSlider').value = productBuyNowBorderRadius;
  // Set the preview box‚Äôs border radius to match
  document.getElementById('borderPreview').style.borderRadius = productBuyNowBorderRadius + "px";
  // Open the modal
  document.getElementById('borderRadiusModal').style.display = 'flex';
});


document.getElementById('saveBorderRadiusBtn').addEventListener('click', function() {
  // Update the global variable with the slider's value
  productBuyNowBorderRadius = document.getElementById('borderRadiusSlider').value;
  // Call the update function to refresh the preview (this function should rebuild your final HTML preview)
  updateProductBuyNowStyles();
  // Close the modal
  document.getElementById('borderRadiusModal').style.display = 'none';
});

    document.getElementById('borderRadiusSlider').addEventListener('input', function(){
  document.getElementById('borderPreview').style.borderRadius = this.value + "px";
});


// For the Logo field
document.getElementById('logo').addEventListener('input', function() {
  if (this.value.trim() !== "") {
    // If a Base64 image exists, back it up and remove it so the URL takes precedence.
    if (uploadedImages['uploadLogoBtn']) {
      backupImages['uploadLogoBtn'] = uploadedImages['uploadLogoBtn'];
      delete uploadedImages['uploadLogoBtn'];
      // Reset button icon to cloud upload (since the URL is now active)
      document.getElementById('uploadLogoBtn').innerHTML = '<i class="fas fa-cloud-upload-alt"></i>';
    }
  } else {
    // If the user clears the URL, restore the previously uploaded image (if available)
    if (backupImages['uploadLogoBtn']) {
      uploadedImages['uploadLogoBtn'] = backupImages['uploadLogoBtn'];
      // Update button icon to green check since a Base64 image is now active
      document.getElementById('uploadLogoBtn').innerHTML = '<i class="fas fa-check" style="color: green;"></i>';
      delete backupImages['uploadLogoBtn'];
    }
  }
  updatePreview();
});

// For the Banner field
document.getElementById('banner').addEventListener('input', function() {
  if (this.value.trim() !== "") {
    if (uploadedImages['uploadBannerBtn']) {
      backupImages['uploadBannerBtn'] = uploadedImages['uploadBannerBtn'];
      delete uploadedImages['uploadBannerBtn'];
      document.getElementById('uploadBannerBtn').innerHTML = '<i class="fas fa-cloud-upload-alt"></i>';
    }
  } else {
    if (backupImages['uploadBannerBtn']) {
      uploadedImages['uploadBannerBtn'] = backupImages['uploadBannerBtn'];
      document.getElementById('uploadBannerBtn').innerHTML = '<i class="fas fa-check" style="color: green;"></i>';
      delete backupImages['uploadBannerBtn'];
    }
  }
  updatePreview();
});

// For the 1st Product Image field
document.getElementById('image1').addEventListener('input', function() {
  if (this.value.trim() !== "") {
    if (uploadedImages['uploadImage1Btn']) {
      backupImages['uploadImage1Btn'] = uploadedImages['uploadImage1Btn'];
      delete uploadedImages['uploadImage1Btn'];
      document.getElementById('uploadImage1Btn').innerHTML = '<i class="fas fa-cloud-upload-alt"></i>';
    }
  } else {
    if (backupImages['uploadImage1Btn']) {
      uploadedImages['uploadImage1Btn'] = backupImages['uploadImage1Btn'];
      document.getElementById('uploadImage1Btn').innerHTML = '<i class="fas fa-check" style="color: green;"></i>';
      delete backupImages['uploadImage1Btn'];
    }
  }
  updatePreview();
});

// For the 2nd Product Image field
document.getElementById('image2').addEventListener('input', function() {
  if (this.value.trim() !== "") {
    if (uploadedImages['uploadImage2Btn']) {
      backupImages['uploadImage2Btn'] = uploadedImages['uploadImage2Btn'];
      delete uploadedImages['uploadImage2Btn'];
      document.getElementById('uploadImage2Btn').innerHTML = '<i class="fas fa-cloud-upload-alt"></i>';
    }
  } else {
    if (backupImages['uploadImage2Btn']) {
      uploadedImages['uploadImage2Btn'] = backupImages['uploadImage2Btn'];
      document.getElementById('uploadImage2Btn').innerHTML = '<i class="fas fa-check" style="color: green;"></i>';
      delete backupImages['uploadImage2Btn'];
    }
  }
  updatePreview();
});

// For the 3rd Product Image field
document.getElementById('image3').addEventListener('input', function() {
  if (this.value.trim() !== "") {
    if (uploadedImages['uploadImage3Btn']) {
      backupImages['uploadImage3Btn'] = uploadedImages['uploadImage3Btn'];
      delete uploadedImages['uploadImage3Btn'];
      document.getElementById('uploadImage3Btn').innerHTML = '<i class="fas fa-cloud-upload-alt"></i>';
    }
  } else {
    if (backupImages['uploadImage3Btn']) {
      uploadedImages['uploadImage3Btn'] = backupImages['uploadImage3Btn'];
      document.getElementById('uploadImage3Btn').innerHTML = '<i class="fas fa-check" style="color: green;"></i>';
      delete backupImages['uploadImage3Btn'];
    }
  }
  updatePreview();
});

// For the About Image field (unchanged since it's not mandatory)
document.getElementById('aboutImage').addEventListener('input', function() {
  if (this.value.trim() !== "") {
    if (uploadedImages['uploadAboutImgBtn']) {
      backupImages['uploadAboutImgBtn'] = uploadedImages['uploadAboutImgBtn'];
      delete uploadedImages['uploadAboutImgBtn'];
      document.getElementById('uploadAboutImgBtn').innerHTML = '<i class="fas fa-cloud-upload-alt"></i>';
    }
  } else {
    if (backupImages['uploadAboutImgBtn']) {
      uploadedImages['uploadAboutImgBtn'] = backupImages['uploadAboutImgBtn'];
      document.getElementById('uploadAboutImgBtn').innerHTML = '<i class="fas fa-check" style="color: green;"></i>';
      delete backupImages['uploadAboutImgBtn'];
    }
  }
  updatePreview();
});


document.getElementById('paymentMethodBtn').addEventListener('click', function() {
  document.getElementById('paymentMethodModal').style.display = 'block';
});

document.getElementById('closePaymentMethodModal').addEventListener('click', function() {
  document.getElementById('paymentMethodModal').style.display = 'none';
});

document.querySelectorAll('#paymentMethodModal ul li').forEach(function(item) {
  item.addEventListener('click', function() {
    var value = this.getAttribute('data-value');
    document.getElementById('productPaymentMethod').value = value;
    // Do not update the button text‚Äîkeep it static as "Select Payment Method"
    document.getElementById('paymentMethodModal').style.display = 'none';
    
    // Trigger any change event if needed:
    var event = new Event('change');
    document.getElementById('productPaymentMethod').dispatchEvent(event);
  });
});
    
    document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('#paymentMethodModal ul li').forEach(function(item) {
    item.addEventListener('click', function() {
      var value = this.getAttribute('data-value');
      document.getElementById('productPaymentMethod').value = value;
      
      // Update the button appearance and text
      var paymentBtn = document.getElementById('paymentMethodBtn');
      paymentBtn.classList.add('selected');
      paymentBtn.innerHTML = 'Payment method selected  <i class="fas fa-check"></i>';
      
      document.getElementById('paymentMethodModal').style.display = 'none';
      
      // Optionally, trigger a change event if needed
      var event = new Event('change');
      document.getElementById('productPaymentMethod').dispatchEvent(event);
    });
  });
});


   
</script>
  
  





<script>
// Close popup message
function closePopup(){
  var popup=document.getElementById('popupMessage');
  if(popup) popup.style.display='none';
}
window.addEventListener('load',function(){
  var popup=document.getElementById('popupMessage');
  if(popup){
    popup.style.display='block';
    setTimeout(closePopup,15000);
  }
});
document.querySelector('#popupMessage .close').addEventListener('click',closePopup);
</script>
  
  
  <script>
window.addEventListener('beforeunload', function(e) {
  e.preventDefault();
  e.returnValue = '';
});
</script>

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FJEE98DCQM"></script>
  
  
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-FJEE98DCQM');
</script>

  
  
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Global variables (set only once)
  window.currentUploadField = null;
  window.uploadedImages = {};
  window.backupImages = {};
  window.uploadedFiles = {};

  // Expose the upload modal function globally
  window.openUploadModal = function(fieldId) {
    console.log("openUploadModal called for " + fieldId);
    // If an image is already uploaded for this field, confirm deletion
    if (window.uploadedImages[fieldId]) {
      if (confirm("Do you want to delete the uploaded image?")) {
        delete window.uploadedImages[fieldId];
        if (window.backupImages[fieldId]) {
          delete window.backupImages[fieldId];
        }
        document.getElementById(fieldId).innerHTML = '<i class="fas fa-cloud-upload-alt"></i>';
        updatePreview();
        return;
      } else {
        return;
      }
    }
    window.currentUploadField = fieldId;
    document.getElementById('uploadModal').style.display = 'flex';
  };

  // Helper: Get final image URL for download (if file was uploaded)
  function getFinalImageURL(fieldId, currentURL) {
    if (window.uploadedFiles && window.uploadedFiles[fieldId]) {
      // Convert the file name to a safe version
      return "Images/" + generateSafeFileName(window.uploadedFiles[fieldId].name);
    }
    return currentURL;
  }

  // File input handling (for browsing files)
  var uploadFileInput = document.getElementById('uploadFileInput');
  if (uploadFileInput) {
    uploadFileInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;
      if (!window.currentUploadField) {
        console.error("No upload field is set!");
        return;
      }
      // Generate and store the unique safe filename if not already set
      if (!file.safeName) {
        file.safeName = generateUniqueSafeFileName(file.name);
      }
      const objectURL = URL.createObjectURL(file);
      window.uploadedFiles[window.currentUploadField] = file;
      window.uploadedImages[window.currentUploadField] = objectURL;
      updatePreviewForField(window.currentUploadField, objectURL);
      const btn = document.getElementById(window.currentUploadField);
      if (btn) {
        btn.innerHTML = '<i class="fas fa-check" style="color: white;"></i>';
      }
      e.target.value = "";
      closeUploadModal();
    });
  }

  // Drag & Drop handling
  var dropArea = document.getElementById('uploadDropArea');
  if (dropArea) {
    dropArea.addEventListener('dragover', function(e) {
      e.preventDefault();
      e.stopPropagation();
      e.dataTransfer.dropEffect = 'copy';
      dropArea.style.borderColor = '#2196F3';
      console.log("Dragover event fired.");
    });

    dropArea.addEventListener('dragleave', function(e) {
      e.preventDefault();
      e.stopPropagation();
      dropArea.style.borderColor = '#ccc';
      console.log("Dragleave event fired.");
    });

    dropArea.addEventListener('drop', function(e) {
      e.preventDefault();
      e.stopPropagation();
      dropArea.style.borderColor = '#ccc';

      const file = e.dataTransfer.files[0];
      console.log("Drop event fired, file:", file);

      if (file && window.currentUploadField) {
        // ‚¨áÔ∏è Add this line so the file always gets a unique, extension-preserving safeName
        if (!file.safeName) {
          file.safeName = generateUniqueSafeFileName(file.name);
        }

        const objectURL = URL.createObjectURL(file);
        console.log("Dropped file:", file.name, objectURL);

        window.uploadedFiles[window.currentUploadField] = file;
        window.uploadedImages[window.currentUploadField] = objectURL;
        updatePreviewForField(window.currentUploadField, objectURL);

        const btn = document.getElementById(window.currentUploadField);
        if (btn) {
          btn.innerHTML = '<i class="fas fa-check" style="color: white;"></i>';
        }
        closeUploadModal();
      }
    });
  } else {
    console.error("Drop area element not found.");
  }

  // Updates the preview for the given upload field (for preview purposes only)
  function updatePreviewForField(fieldId, objectURL) {
    console.log("Updating preview for", fieldId, "with URL", objectURL);
    switch(fieldId) {
      case 'uploadLogoBtn':
        heroData.logoPreview = objectURL;
        break;
      case 'uploadBannerBtn':
        heroData.bannerPreview = objectURL;
        break;
      case 'uploadAboutImgBtn':
        aboutData.imagePreview = objectURL;
        break;
      // For product images‚Äîmake sure these elements exist or update accordingly:
      case 'uploadImage1Btn':
        var p1 = document.getElementById('productPreview1');
        if (p1) { p1.src = objectURL; }
        break;
      case 'uploadImage2Btn':
        var p2 = document.getElementById('productPreview2');
        if (p2) { p2.src = objectURL; }
        break;
      case 'uploadImage3Btn':
        var p3 = document.getElementById('productPreview3');
        if (p3) { p3.src = objectURL; }
        break;
      default:
        break;
    }
    updatePreview();
  }

  // Closes the upload modal
  function closeUploadModal() {
    document.getElementById('uploadModal').style.display = 'none';
    window.currentUploadField = null;
  }

  // Attach the browse button event
  var browseButton = document.getElementById('browseButton');
  if (browseButton) {
    browseButton.addEventListener('click', function() {
      document.getElementById('uploadFileInput').click();
    });
  }

  // (Make sure updatePreview() is defined elsewhere.)

  // ‚¨áÔ∏è Add the close ‚ÄúX‚Äù snippet here, inside the DOMContentLoaded block
  const closeButton = document.getElementById('uploadModalClose');
  if (closeButton) {
    closeButton.addEventListener('click', function() {
      closeUploadModal(); // calls your existing function
    });
  }
});
</script>





  
</body>
</html>
